################################################################################
#                                                                              #
#    Micro Series 8051 Assembler V2.02/DOS              20/Dec/19  17:34:29    #
#                                                                              #
#       Source   =   gmon2.s03                                                 #
#       List     =   gmon2.lst                                                 #
#       Object   =   gmon2.r03                                                 #
#       Options  =                                                             #
#                                                                              #
#                                               (c) Copyright IAR Systems 1990 #
################################################################################


    1                 ;=============================================================================
    2                 ; Module        : GMON2 - GMON51 version 2
    3                 ; Version       : v2.0b2 - 11-Apr-2010 
    4                 ; Author        : Michel Bernard - mailto:michel.bernard@advalvas.be
    5                 ; Object        : 8051 Family Monitor/Debugger/Disassembler
    6                 ; Requires      : -
    7                 ; Target        : 8051 family
    8                 ; Assembler     : Micro Series 8051 Assembler 2.02/DOS - IAR 1990
    9                 ; Copyright (c) 2010 GmE Belgium - All Rights Reserved
   10                 ;               : Redistribution and use in source and binary forms, with or 
   11                 ;               : without modification, are permitted provided that the 
   12                 ;               : following conditions are met:
   13                 ;               : 1. Redistributions of source code must retain the above 
   14                 ;               : copyright notice, this list of conditions and the following 
   15                 ;               : disclaimer.
   16                 ;               : 2. Redistributions in binary form must reproduce the above 
   17                 ;               : copyright notice, this list of conditions and the following 
   18                 ;               : disclaimer in the documentation and/or other materials 
   19                 ;               : provided with the distribution.
   20                 ;               : 3. The name of the author may not be used to endorse or 
   21                 ;               : promote products derived from this software without specific 
   22                 ;               : prior written permission.
   23                 ; Disclaimer    : This software is in its early alpha stage.  It's not meant 
   24                 ;               : to be used for production code, and the API might change in 
   25                 ;               : the future.  Despite this, it might be useful in some 
   26                 ;               : situations and you are encouraged to try it by yourself. 
   27                 ;               : Suggestions, bug-reports and even better patches are welcome.
   28                 ;               : THIS SOFTWARE IS BEING PROVIDED "AS IS", WITHOUT ANY EXPRESS 
   29                 ;               : OR IMPLIED WARRANTY.  IN PARTICULAR, NEITHER THE AUTHOR NOR 
   30                 ;               : GmE MAKES ANY REPRESENTATION OR WARRANTY OF ANY KIND 
   31                 ;               : CONCERNING THE MERCHANTABILITY OF THIS SOFTWARE OR ITS 
   32                 ;               : FITNESS FOR ANY PARTICULAR PURPOSE.
   33                 ;=============================================================================
   34                 
   35                 $sfr552.inc
   36                 ;MCS-80552 SFR file
   37                 ;Written by O Meurice
   38                 ;(*) denotes bit addressable registers
   39                 ;(#) denotes read only registers
   40                 ;(&) modified 04-jan-96 for I2C by Jean Morren
   41                 ;
   42  00FF           t3      define  0ffh    ;Timer 3
   43  00FE           pwmp    define  0feh    ;Pulse Width Modulation Prescaler
   44  00FD           pwm1    define  0fdh    ;Pulse Width Modulation register 1
   45  00FC           pwm0    define  0fch    ;Pulse width Modulation register 1
   46                 ;
   47  00B8           ip0     define  0b8h    ;Interrupt Priority 0  (* b8h --> bfH)
   48                 ;px0     define  ip0.0
   49                 ;pt0     define  ip0.1
   50                 ;px1     define  ip0.2
   51                 ;pt1     define  ip0.3
   52  00BC           ps0     define  ip0.4
   53  00BD           ps1     define  ip0.5
   54  00BE           pad     define  ip0.6
   55                 ;
   56  00F8           ip1     define  0f8h    ;Interrupt Priority 1  (* f8h --> ffH)
   57  00F8           pct0    define  ip1.0
   58  00F9           pct1    define  ip1.1
   59  00FA           pct2    define  ip1.2
   60  00FB           pct3    define  ip1.3
   61  00FC           pcm0    define  ip1.4
   62  00FD           pcm1    define  ip1.5
   63  00FE           pcm2    define  ip1.6
   64  00FF           pt2     define  ip1.7
   65                 ;
   66  00EF           rte     define  0efh    ;Reset/Toggle Enable
   67                 ;tp47,tp46,rp45,rp44,rp43,rp42,rp41,rp40
   68                 ;
   69  00EE           ste     define  0eeh    ;SeT Enable
   70                 ;tg47,tg46,sp45,sp44,sp43,sp42,sp41,sp40
   71                 ;
   72  00ED           tmh2    define  0edh    ;TiMer High 2  (#)
   73  00EC           tml2    define  0ech    ;TiMer Low 2   (#)
   74  00EB           ctcon   define  0ebh    ;CapTure CONtrol
   75                 ;ctn3,ctp3,ctn2,ctp2,ctn1,ctp1,ctn0,ctp0
   76                 ;
   77  00EA           tm2con  define  0eah    ;TiMer 2 CONtrol
   78                 ;t2is1,t2is0,t2er,t2b0,t2p1,t2p0,t2ms1,t2ms0
   79                 ;
   80  00A8           ien0    define  0a8h
   81                 ;
   82                 ;ie (8052) labels redefinition to ien0 (80552)
   83                 ;
   84  00AE           ead     define  ien0.6   ;(&)
   85  00AD           es1     define  ien0.5   ;(&)
   86  00AC           es0     define  ien0.4   ;(&)
   87                 ;
   88  00E8           ien1    define  0e8h    ;Interrupt ENable 1  (* e8h --> efh)
   89  00E8           ect0    define  ien1.0
   90  00E9           ect1    define  ien1.1
   91  00EA           ect2    define  ien1.2
   92  00EB           ect3    define  ien1.3
   93  00EC           ecm0    define  ien1.4
   94  00ED           ecm1    define  ien1.5
   95  00EE           ecm2    define  ien1.6
   96  00EF           et2     define  ien1.7
   97                 ;
   98  00DB           s1adr   define  0dbh    ;Serial 1 ADRess  (*)
   99  00DB           gc      define  s1adr.0 ; |<-- slave address -->|gc|
  100                 ;
  101  00DA           s1dat   define  0dah    ;Serial 1 DATa
  102  00D9           s1sta   define  0d9h    ;Serial 1 STAtus  (#)
  103                 ;sc4,sc3,sc2,sc1,sc0,0,0,0
  104                 ;
  105  00D8           s1con   define  0d8h    ;Serial 1 CONtrol  (* d8h --> dfh)
  106  00D8           cr0     define  s1con.0
  107  00D9           cr1     define  s1con.1
  108  00DA           aa      define  s1con.2
  109  00DB           si      define  s1con.3
  110  00DC           sto     define  s1con.4
  111  00DD           sta     define  s1con.5
  112  00DE           ens1    define  s1con.6
  113                 ;
  114  00CF           cth3    define  0cfh    ;CapTure High 3  (#)
  115  00CE           cth2    define  0ceh    ;CapTure High 2  (#)
  116  00CD           cth1    define  0cdh     ;CapTure High 1  (#)
  117  00CC           cth0    define  0cch    ;CapTure High 0  (#)
  118  00CB           cmh2    define  0cbh    ;CoMpare High 2
  119  00CA           cmh1    define  0cah    ;CoMpare High 3
  120  00C9           cmh0    define  0c9h    ;CoMpare High 0
  121  00C8           tm2ir   define  0c8h    ;TiMer 2 Interrupt flag Register  (* c8h --> cfh)
  122  00C8           cti0    define  tm2ir.0
  123  00C9           cti1    define  tm2ir.1
  124  00CA           cti2    define  tm2ir.2
  125  00CB           cti3    define  tm2ir.3
  126  00CC           cmi0    define  tm2ir.4
  127  00CD           cmi1    define  tm2ir.5
  128  00CE           cmi2    define  tm2ir.6
  129  00CF           t2ov    define  tm2ir.7
  130                 ;
  131  00C6           adch    define  0c6h    ;Analog to Digital Converter High  (#)
  132  00C5           adcon   define  0c5h    ;ADc CONtrol  not bit adressable !!!
  133                 ;adc.1,adc.0,adex,adci,adcs,aadr2,aadr1,aadr0
  134                 ;
  135  00C4           p5      define  0c4h    ;Port 5 (#)
  136                 ;adc7,adc6,adc5,adc4,adc3,adc2,adc1,adc0
  137                 ;
  138  00C0           p4      define  0c0h    ;Port 4  (* c0h --> c7h)
  139  00C0           cmsr0   define  p4.0
  140  00C1           cmsr1   define  p4.1
  141  00C2           cmsr2   define  p4.2
  142  00C3           cmsr3   define  p4.3
  143  00C4           cmsr4   define  p4.4
  144  00C5           cmsr5   define  p4.5
  145  00C6           cmt0    define  p4.6
  146  00C7           cmt1    define  p4.7
  147                 ;
  148  00AF           ctl3    define  0afh    ;CapTure Low 3  (#)
  149  00AE           ctl2    define  0aeh    ;CapTure Low 2  (#)
  150  00AD           ctl1    define  0adh    ;CapTure Low 1  (#)
  151  00AC           ctl0    define  0ach    ;CapTure LOw 0  (#)
  152  00AB           cml2    define  0abh    ;CoMpare Low 2
  153  00AA           cml1    define  0aah    ;CoMpare Low 1
  154  00A9           cml0    define  0a9h    ;CoMpare Low 0
  155                 ;
  156  0099           s0buf   define  99h     ;Serial 0 data BUFfer
  157                 ;
  158  0090           ct0i    define  p1.0
  159  0091           ct1i    define  p1.1
  160  0092           ct2i    define  p1.2
  161  0093           ct3i    define  p1.3
  162  0094           t2      define  p1.4
  163  0095           rt2     define  p1.5
  164  0096           scl     define  p1.6
  165  0097           sda     define  p1.7
  166                 ;
  167  0087           pcon    define  87h     ;Power CONtrol
  168                 
  169                 
  170                 
  171                 
  172                 
  173                 
  174                 ;
  175                 ; Segmentation :    name      type      offset for simcad   usage
  176                 ; ==============    ----      ----      -----------------   -----
  177                 ;                   datasim   stack     7FH                 var and stack emon
  178                 ;                   ramcoda   rseg      2000H               users vectors
  179                 ;                                                           and user code
  180                 ;                   code      rseg      0                   code of monitor
  181                 ;                   const     rseg      0                   ASCII const emon
  182                 ;
  183                 ;
  184  0000                     lstxrf
  185  0000                     locsym+
  186                 
  187                 
  188                 ;=====  CONFIGURATION  =====      
  189                 ;
  190                 ;configurable defaults for debugger
  191  0001           VEC     equ     1       ;default interrupt vectors in object file
  192  0001           DBGINT  equ     1       ;int for debugger: 0 (INT0) or 1 (INT1)
  193  0091           PAUTO   equ     P1.1    ;usercode is run if given bit is low
  194  0000           SERINT  equ     0       ;enable invocation of debugger via serial interrupt when Ctrl-D typed
  195  0001           P80C552 equ     1       ;processor is Philips 80C552
  196                 
  197                 
  198                 ;=====  DEFINES  =====
  199                 
  200  0087           PCON    equ     087H
  201  00CD           TH2     equ     cth1
  202  00CC           TL2     equ     cth0
  203  00CB           RCAP2H  equ     cmh2
  204  00CA           RCAP2L  equ     cmh1
  205  00C8           T2CON   equ     tm2ir
  206                 
  207                 ;bits for debugger
  208  001C           RETIFLG equ     28      ;set when INT active => if set use RETI else use RET
  209  001D           SINTDBG equ     29      ;SERINT intercepted when this bit set
  210  001E           INT0DBG equ     30      ;INT0 intercepted when this bit set
  211  001F           INT1DBG equ     31      ;INT1 interrupt intercepted when this bit set
  212                 
  213                 ;indirect data addresses for debugger 
  214  00C0           DEBUGSP equ     0C0h    ;debugger stack                 16 bytes
  215  00D0           SAVERAM equ     0D0H    ;backup Reg banks 1-3           24 bytes
  216  00E8           MODE    equ     0E8H    ;Debug mode                     1 byte
  217  00ED           SAVESP  equ     0EDH    ;SP value for call step         1 byte
  218  00EE           SAVERET equ     0EEH    ;Ret address for call step      2 bytes
  219  00F0           SAVEREG equ     0F0H    ;backup for R0-R7               8 bytes
  220  00F8           SAVESFR equ     0F8H    ;backup for PC and SFRs         8 bytes
  221                 
  222                 
  223  001F           INTBIT  equ     INT0DBG+DBGINT
  224                 
  225                 
  226                 ;______________________________________
  227  0000                     rseg      ramcoda
  228  0000           if VEC
  229                 
  230  0000           ramcodastart:
  231  0000 020100    rstvec: ljmp    usercode
  232  0003 02010C    int0vec:ljmp    inte0
  233  0006                   ds      5
  234  000B 020130    tmr0vec:ljmp    intf0
  235  000E                   ds      5
  236  0013 02011E    int1vec:ljmp    inte1
  237  0016                   ds      5
  238  001B 020142    tmr1vec:ljmp    intf1
  239  001E                   ds      5
  240  0023 020154    serintvec:ljmp  intrt
  241  0026                   ds      5
  242  002B           if P80C552
  243  002B 020166    sio1vec:ljmp    intrt1
  244  002E                   ds      5       ;liaison I²C
  245  0033 020178    t2cap0vec:ljmp  intc0
  246  0036                   ds      5       ;capture 0 timer 2
  247  003B 02018A    t2cap1vec:ljmp  intc1
  248  003E                   ds      5       ;        1
  249  0043 02019C    t2cap2vec:ljmp  intc2
  250  0046                   ds      5       ;        2
  251  004B 0201AE    t2cap3vec:ljmp  intc3
  252  004E                   ds      5       ;        3
  253  0053 0201C0    adccomvec:ljmp  intadc
  254  0056                   ds      5       ;fin de conversion
  255  005B 0201D2    t2com0vec:ljmp  intcm0
  256  005E                   ds      5       ;comparaison 0 timer 2
  257  0063 0201E4    t2com1vec:ljmp  intcm1
  258  0066                   ds      5       ;            1
  259  006B 0201F6    t2com2vec:ljmp  intcm2
  260  006E                   ds      5       ;            2
  261  0073           endif
  262  0073 020208    tmr2vec:ljmp    intf2
  263  0076                   ds      5       ;timer 2 overflow du 552
  264                 
  265                 else
  266                 
  267                 ramcodastart:
  268                 rstvec    ds        3
  269                 int0vec   ds        8
  270                 tmr0vec   ds        8
  271                 int1vec   ds        8
  272                 tmr1vec   ds        8
  273                 serintvec ds        8
  274                 if P80C552
  275                 sio1vec   ds        8       ;liaison I²C
  276                 t2cap0vec ds        8       ;capture 0 timer 2
  277                 t2cap1vec ds        8       ;        1
  278                 t2cap2vec ds        8       ;        2
  279                 t2cap3vec ds        8       ;        3
  280                 adccomvec ds        8       ;fin de conversion
  281                 t2com0vec ds        8       ;comparaison 0 timer 2
  282                 t2com1vec ds        8       ;            1
  283                 t2com2vec ds        8       ;            2
  284                 endif
  285                 tmr2vec   ds        8       ;timer 2 overflow du 552
  286                 
  287  007B           endif
  288                 
  289  00FE                     org       ramcodastart+0FEh
  290  00FE           chksig:   ds        2       ;signature for autorun: check for AA5A
  291  0100                     org       ramcodastart+100h
  292  0100           usercode  equ       $
  293                 
  294                 
  295                 ;______________________________________
  296  0000                     rseg      code
  297  0000 0202DF              ljmp      START
  298                 ;
  299                 ; all interrupt linked via LJMP table at begin of segment ramcoda 
  300                 ; 2000H for ELEKTOR 80C552
  301                 ;
  302  0003 201E08    vecint0 jb      INT0DBG,veci00
  303  0006 020003            ljmp    int0vec
  304  0009                   ds      2
  305                 
  306  000B 02000B    vectmr0 ljmp    tmr0vec
  307  000E 0206BC    veci00: ljmp    XINT0
  308  0011                   ds      2
  309                 
  310  0013 201F08    vecint1 jb      INT1DBG,veci10
  311  0016 020013            ljmp    int1vec
  312  0019                   ds      2
  313                 
  314  001B 02001B    vectmr1 ljmp    tmr1vec
  315  001E 0206BC    veci10: ljmp    XINT0
  316  0021                   ds      2
  317                 
  318  0023           vecserint:
  319  0023 201D08            jb      SINTDBG,vecs00
  320  0026 020023            ljmp    serintvec 
  321  0029                   ds      2
  322                 
  323  002B           if P80C552
  324                 
  325  002B           vecint2 equ     $
  326  002B           veci2cint:
  327  002B 02002B            ljmp    sio1vec 
  328  002E 02063B    vecs00: ljmp    XSERINT
  329  0031                   ds      2
  330                 
  331  0033 020033    cap0int ljmp    t2cap0vec
  332  0036                   ds      5
  333                 
  334  003B 02003B    cap1int ljmp    t2cap1vec
  335  003E                   ds      5
  336                 
  337  0043 020043    cap2int ljmp    t2cap2vec 
  338  0046                   ds      5
  339                 
  340  004B 02004B    cap3int ljmp    t2cap3vec 
  341  004E                   ds      5
  342                 
  343  0053 020053    adcint  ljmp    adccomvec
  344  0056                   ds      5
  345                 
  346  005B 02005B    com0int ljmp    t2com0vec
  347  005E                   ds      5
  348                 
  349  0063 020063    com1int ljmp    t2com1vec
  350  0066                   ds      5
  351                 
  352  006B 02006B    com2int ljmp    t2com2vec
  353  006E                   ds      5
  354  0073 020073    vectmr2 ljmp    tmr2vec
  355                 
  356                 else
  357                 
  358                 vectmr2 ljmp    tmr2vec
  359                 vecs00: ljmp    XSERINT
  360                         ds      2
  361                 
  362  0076           endif
  363                 
  364                 
  365                 
  366                 ;=====  VECTORS  =====
  367                 ;       <VEC>
  368  0076 0217EA            ljmp    stime           ;write time to RTC OKI MSM6242
  369  0079 021802            ljmp    ltime           ;read time from RTC OKI MSM6242
  370  007C 0219E7            ljmp    snap            ;snap registers
  371  007F 021826            ljmp    add16           ;op1(16b) = word@r0 + word@r1 ; r0 = #op1
  372  0082 021833            ljmp    sub16           ;op1(16b) = word@r0 - word@r1 ; r0 = #op1
  373  0085 021841            ljmp    mul16           ;prod(16b) = word@r0 * word@r1 ; r0 = #prod
  374  0088 021890            ljmp    div16           ;word@r0 = dword@r0 / word@r1 ; word@r1 = dword@r0 mod word@r1 
  375  008B 021901            ljmp    abs16           ;word@r0 = abs( word@r0 )
  376  008E 02190B            ljmp    neg16           ;word@r0 = -word@r0
  377  0091 021916            ljmp    hex16           ;hex disp dptr
  378  0094 021921            ljmp    dsp32d          ;dec disp dword@r0
  379  0097 021938            ljmp    dsp32h          ;hex disp dword@r0
  380  009A 02195A            ljmp    dsp16d          ;dec disp word@r0
  381  009D 02194F            ljmp    dsp16h          ;hex disp word@r0
  382  00A0 02196B            ljmp    iniacc          ;init buffer for bin to bcd conversion
  383  00A3 021983            ljmp    bindec          ;convert byte@r0 to bcd in buffer; ++r0
  384  00A6 0219DE            ljmp    dspx            ;disp bcd value in buffer
  385  00A9 0215FD            ljmp    link            ;link interrupt vector
  386  00AC 021624            ljmp    add16s          ;add word @r1 to word @r0
  387  00AF 02162F            ljmp    clr16           ;clear word@r0
  388  00B2 021636            ljmp    shl16           ;left shift word@r0
  389  00B5 02163F            ljmp    get16           ;hex read word@r0 without echo until non-hex char
  390  00B8 02165E            ljmp    get2h           ;hex read byte@r0 without echo until non-hex char
  391  00BB 021674            ljmp    get2he          ;hex read byte@r0 with echo until non-hex char
  392  00BE 02168A            ljmp    echo            ;echo byte, add <lf> to <cr>
  393  00C1 021695            ljmp    get16i          ;hex read word@r0 with prompt 'H>' and echo until non-hex char
  394  00C4 0216C1            ljmp    get10i          ;dec read word@r0 with prompt 'D>' and echo until non-hex char
  395  00C7 021700            ljmp    get1d           ;dec read 1 digit without echo
  396  00CA 021705            ljmp    get1de          ;dec read 1 digit with echo
  397  00CD 02171A            ljmp    get1h           ;hex read 1 digit without echo
  398  00D0 02171F            ljmp    get1he          ;hex read 1 digit with echo
  399  00D3 02174C            ljmp    stxt            ;disp null terminated text @dptr
  400  00D6 021758            ljmp    blank           ;disp blank
  401  00D9 02175C            ljmp    byte            ;hex disp byte in A
  402  00DC 021772            ljmp    crlf            ;disp CR/LF
  403  00DF 02177D            ljmp    getupc          ;read char to A and convert to upper case
  404  00E2 021784            ljmp    upcase          ;convert char in A to upper case
  405  00E5 021796            ljmp    snd             ;disp char in A
  406  00E8 0217A9            ljmp    getchr          ;read char to A; Ctrl-D invokes debugger
  407  00EB 021A6A            ljmp    testc           ;test if char received (A != 0 if true)
  408  00EE 02068B            ljmp    dbgbrk          ;break into debugger
  409  00F1 020667            ljmp    dbgsnap         ;snapshot SFRs via debugger
  410  00F4 020654            ljmp    dbgcont         ;continue from debugger
  411  00F7 02100B            ljmp    DASM1           ;disasemble code from 18:19 to 1A:1B
  412  00FA 02024E            ljmp    DDISA           ;disp char in A
  413  00FD 02026F            ljmp    DDISNL          ;disp new line (A saved)
  414  0100 0202B0            ljmp    DHEXB           ;hex disp byte in A
  415  0103 02028E            ljmp    DHEXW           ;hex disp word in R2:R3
  416  0106 020236            ljmp    WAITKI          ;wait char from serial line; Ctrl-C aborts
  417  0109 02021D            ljmp    DHITKI          ;get char from serial line with XON/XOFF; Ctrl-C aborts
  418                 ;       </VEC>
  419                 
  420                 ;______________________________________
  421                 ;      default interrupt handlers
  422                 ;
  423  010C 75A800    inte0  MOV   ien0,#0           ; disable all interrups
  424  010F 900017           MOV   DPTR,#ITXT
  425  0112 12174C           LCALL stxt
  426  0115 900023           MOV   DPTR,#ITXT1
  427  0118 12174C           LCALL stxt
  428  011B 02021A           LJMP  STOP1
  429  011E 75A800    inte1  MOV   ien0,#0           ; disable all interrups
  430  0121 900017           MOV   DPTR,#ITXT
  431  0124 12174C           LCALL stxt
  432  0127 900029           MOV   DPTR,#ITXT2
  433  012A 12174C           LCALL stxt
  434  012D 02021A           LJMP  STOP1
  435  0130 75A800    intf0  MOV   ien0,#0           ; disable all interrups
  436  0133 900017           MOV   DPTR,#ITXT
  437  0136 12174C           LCALL stxt
  438  0139 90002F           MOV   DPTR,#ITXT3
  439  013C 12174C           LCALL stxt
  440  013F 02021A           LJMP  STOP1
  441  0142 75A800    intf1  MOV   ien0,#0           ; disable all interrups
  442  0145 900017           MOV   DPTR,#ITXT
  443  0148 12174C           LCALL stxt
  444  014B 900035           MOV   DPTR,#ITXT4
  445  014E 12174C           LCALL stxt
  446  0151 02021A           LJMP  STOP1
  447  0154 75A800    intrt  MOV   ien0,#0           ; disable all interrups
  448  0157 900017           MOV   DPTR,#ITXT
  449  015A 12174C           LCALL stxt
  450  015D 90003B           MOV   DPTR,#ITXT5
  451  0160 12174C           LCALL stxt
  452  0163 02021A           LJMP  STOP1
  453                 
  454  0166           if P80C552      
  455                 
  456  0166 75A800    intrt1 MOV   ien0,#0
  457  0169 900017           MOV   DPTR,#ITXT
  458  016C 12174C           LCALL stxt
  459  016F 900043           MOV   DPTR,#ITXT6
  460  0172 12174C           LCALL stxt
  461  0175 02021A           LJMP  STOP1
  462  0178 75E800    intc0  MOV   ien1,#0
  463  017B 900017           MOV   DPTR,#ITXT
  464  017E 12174C           LCALL stxt
  465  0181 900048           MOV   DPTR,#ITXT7
  466  0184 12174C           LCALL stxt
  467  0187 02021A           LJMP  STOP1
  468  018A 75E800    intc1  MOV   ien1,#0
  469  018D 900017           MOV   DPTR,#ITXT
  470  0190 12174C           LCALL stxt
  471  0193 90004E           MOV   DPTR,#ITXT8
  472  0196 12174C           LCALL stxt
  473  0199 02021A           LJMP  STOP1
  474  019C 75E800    intc2  MOV   ien1,#0
  475  019F 900017           MOV   DPTR,#ITXT
  476  01A2 12174C           LCALL stxt
  477  01A5 900054           MOV   DPTR,#ITXT9
  478  01A8 12174C           LCALL stxt
  479  01AB 02021A           LJMP  STOP1
  480  01AE 75E800    intc3  MOV   ien1,#0
  481  01B1 900017           MOV   DPTR,#ITXT
  482  01B4 12174C           LCALL stxt
  483  01B7 90005A           MOV   DPTR,#ITXT10
  484  01BA 12174C           LCALL stxt
  485  01BD 02021A           LJMP  STOP1
  486  01C0 75A800    intadc MOV   ien0,#0
  487  01C3 900017           MOV   DPTR,#ITXT
  488  01C6 12174C           LCALL stxt
  489  01C9 900060           MOV   DPTR,#ITXT11
  490  01CC 12174C           LCALL stxt
  491  01CF 02021A           LJMP  STOP1
  492  01D2 75E800    intcm0 MOV   ien1,#0
  493  01D5 900017           MOV   DPTR,#ITXT
  494  01D8 12174C           LCALL stxt
  495  01DB 900067           MOV   DPTR,#ITXT12
  496  01DE 12174C           LCALL stxt
  497  01E1 02021A           LJMP  STOP1
  498  01E4 75E800    intcm1 MOV   ien1,#0
  499  01E7 900017           MOV   DPTR,#ITXT
  500  01EA 12174C           LCALL stxt
  501  01ED 90006D           MOV   DPTR,#ITXT13
  502  01F0 12174C           LCALL stxt
  503  01F3 02021A           LJMP  STOP1
  504  01F6 75E800    intcm2 MOV   ien1,#0
  505  01F9 900017           MOV   DPTR,#ITXT
  506  01FC 12174C           LCALL stxt
  507  01FF 900073           MOV   DPTR,#ITXT14
  508  0202 12174C           LCALL stxt
  509  0205 02021A           LJMP  STOP1
  510                 
  511  0208           endif
  512                 
  513  0208 75E800    intf2  MOV   ien1,#0           ; disable all interrups
  514  020B 900017           MOV   DPTR,#ITXT
  515  020E 12174C           LCALL stxt
  516  0211 900079           MOV   DPTR,#ITXT15
  517  0214 12174C           LCALL stxt
  518  0217 02021A           LJMP  STOP1
  519                 ;
  520                 
  521                 ;
  522  021A 0202DF    STOP1  LJMP START
  523                 
  524                 
  525                 
  526                 ;=====  LOW LEVEL I/O ROUTINES  =====
  527                 
  528                 ;-----  Get keystroke if any
  529  021D           DHITKI:
  530  021D E4                clr     a
  531  021E 309814            jnb     RI,DHITKI0
  532  0221 E599              mov     a,SBUF
  533  0223 C298              clr     RI
  534  0225 B40304            cjne    a,#03H,DHITKI1
  535                 
  536  0228 E4                clr     a
  537  0229 0203CE            ljmp    INIT
  538                 
  539  022C           DHITKI1:
  540  022C B41306            cjne    a,#13H,DHITKI0
  541                 
  542  022F           DHITKI2:
  543  022F 120236            lcall   WAITKI
  544  0232 B411FA            cjne    a,#11H,DHITKI2
  545                 
  546  0235           DHITKI0:
  547  0235 22                ret
  548                 
  549                 ;-----  Wait keystroke
  550  0236           WAITKI:
  551  0236 C0A8              push    IE
  552  0238 C2AC              clr     ES
  553  023A C2AA              clr     EX0+DBGINT+DBGINT
  554  023C 3098FD            jnb     RI,$
  555  023F E599              mov     a,SBUF
  556  0241 C298              clr     RI
  557  0243 D0A8              pop     IE
  558  0245 C2E7              clr     acc.7
  559  0247 B403EB            cjne    a,#03H,DHITKI0
  560  024A E4                clr     a
  561  024B 0203CE            ljmp    INIT
  562                 
  563                 ;----- Display character in A
  564  024E           DDISA:
  565  024E C0A8              push    IE
  566  0250 C2AC              clr     ES
  567  0252 C2AA              clr     EX0+DBGINT+DBGINT
  568  0254 3099FD            jnb     TI,$
  569  0257 C299              clr     TI
  570  0259 F599              mov     SBUF,a
  571  025B D0A8              pop     IE
  572  025D 22                ret
  573                 
  574                 ;-----  Display space
  575  025E 7420      DDISSP: mov     a,#20H          ;' '
  576  0260 80EC              sjmp    DDISA
  577                 
  578                 ;-----  Display 'H'
  579  0262 7448      DDISH:  mov     a,#48H          ;'H'
  580  0264 80E8              sjmp    DDISA
  581                 
  582                 ;-----  Tab A chars
  583  0266 C3        DTABS:  clr     C
  584  0267 98                subb    a,R0
  585  0268 F8                mov     R0,a
  586  0269 12025E    DTABS0: lcall   DDISSP
  587  026C D8FB              djnz    R0,DTABS0
  588  026E 22                ret
  589                 
  590                 ;-----  Display new line
  591  026F C0E0      DDISNL: push    acc
  592  0271 740D              mov     a,#0DH          ;<cr>
  593  0273 12024E            lcall   DDISA
  594  0276 740A              mov     a,#0AH          ;<nl>
  595  0278 12024E            lcall   DDISA
  596  027B D0E0              pop     acc
  597  027D 22                ret
  598                 
  599                 ;-----  Display text @ DPTR in code memory, terminated by "
  600  027E C0E0      DTEXT:  push    acc
  601  0280 E4        DTEXT0: clr     a
  602  0281 93                movc    a,@A+dptr
  603  0282 B42203            cjne    a,#22H,DTEXT1
  604  0285 D0E0              pop     acc
  605  0287 22                ret
  606  0288 A3        DTEXT1: inc     dptr
  607  0289 12024E            lcall   DDISA
  608  028C 80F2              sjmp    DTEXT0
  609                 
  610                 
  611                 
  612                 ;-----  Hex Output word in R2:R3
  613                 ; in:   bit 36h: 0=dump
  614                 ;       R0: digit counter
  615                 ; out   R0: digit counter (updated)
  616                 
  617  028E C236      DHEXW:  clr     36H
  618  0290 EA                mov     a,R2
  619  0291 1202B0            lcall   DHEXB
  620  0294 EB                mov     a,R3
  621  0295 8019              sjmp    DHEXB
  622                 
  623                 ;-----  Hex Output word in DPTR and 0 if null
  624                 ; in:   bit 36h: output mode: 1=assembler, 0=dump
  625                 ;       R0: digit counter
  626                 ; out   R0: digit counter (updated)
  627                 
  628  0297           DHEXDP: 
  629  0297 7800              mov     R0,#0
  630  0299 E583              mov     a,DPH
  631  029B 1202B0            lcall   DHEXB
  632  029E E582              mov     a,DPL
  633  02A0 1202B0    DHEXD0: lcall   DHEXB
  634  02A3 B80005            cjne    R0,#0,DHEXW1
  635  02A6 7430              mov     a,#30H          ;send 0 if no digit sent
  636  02A8 12024E            lcall   DDISA
  637                 
  638  02AB           DHEXW1:
  639  02AB 22                ret
  640                 
  641                 
  642                 ;-----  Hex Output byte in ACC and 0 if null
  643                 ; in:   bit 36h: output mode: 1=assembler, 0=dump
  644                 ;       R0: digit counter
  645                 ; out   R0: digit counter (updated)
  646  02AC           DHEXA:
  647  02AC 7800              mov     R0,#0
  648  02AE 80F0              sjmp    DHEXD0
  649                 
  650                 ;-----  Hex Output byte in ACC
  651                 ; in:   bit 36h: output mode: 1=assembler, 0=dump
  652                 ;       R0: digit counter
  653                 ; out   R0: digit counter (updated)
  654  02B0           DHEXB:
  655  02B0 C0E0              push    ACC
  656  02B2 C4                swap    a
  657  02B3 1202B8            lcall   DHEXN
  658  02B6 D0E0              pop     ACC
  659                 
  660                 ;-----  Hex Output low nibble in ACC
  661                 ; in:   bit 36h: output mode: 1=assembler, 0=dump
  662                 ;       R0: digit counter (updated)
  663                 ;       bit 36h == 1 and R0 == 0: don't output digit
  664                 ;       bit 36h == 1 and R0 == 0 and nibble >= 0AH: precede digit with 0
  665                 ; out:  ++R0 if digit has been sent
  666  02B8           DHEXN:
  667  02B8 540F              anl     a,#0FH
  668  02BA 7007              jnz     DHEXN0
  669  02BC B80004            cjne    R0,#0,DHEXN0
  670  02BF 303601            jnb     36H,DHEXN0
  671  02C2 22                ret
  672                 
  673  02C3           DHEXN0:
  674  02C3 C3                clr     C
  675  02C4 940A              subb    a,#0AH
  676  02C6 4011              jc      DHEXN1          ;jump if 0-9
  677  02C8 2407              add     a,#7
  678  02CA B8000C            cjne    R0,#0,DHEXN1    ;R0 != 0: don't output 0
  679  02CD 303609            jnb     36H,DHEXN1      ;bit 36H == 0: don't output 0
  680  02D0 C0E0              push    ACC
  681  02D2 7430              mov     a,#30H          ;output 0 before A-F
  682  02D4 12024E            lcall   DDISA
  683  02D7 D0E0              pop     ACC
  684                 
  685  02D9           DHEXN1:
  686  02D9 243A              add     a,#3AH          ;output digit
  687  02DB 08                inc     R0
  688  02DC 02024E            ljmp    DDISA
  689                 
  690                 
  691                 
  692                 
  693                 ;=====  MAIN PROGRAM  =====
  694                 
  695                 
  696                 ;______________________________________
  697                 ; main program starts here
  698                 ;
  699  02DF           START:
  700  02DF 758112            mov     sp,#stk
  701  02E2 75D000            mov     PSW,#0          ; reset register banks
  702  02E5 758780            mov     PCON,#080H      ; SMOD=1
  703  02E8 758922            mov     TMOD,#22H       ; modes are timer
  704  02EB 758DFA            mov     TH1,#(256-6)    ; preload value
  705  02EE 758BFA            mov     TL1,#(256-6)
  706  02F1 D28E              setb    TR1             ; start counter
  707  02F3 759852            mov     SCON,#052H      ; mode 1 , Enable receiver=10H
  708                         
  709                 ;______________________________________
  710                 ; test    PAUTO (port bit)
  711                 ;       
  712  02F6 209116           JB    PAUTO,lnk          ; PAUTO  connected to ground ? if so go UP
  713  02F9 9000FE           MOV   DPTR,#chksig       ; check signature AA5A
  714  02FC E0               MOVX  A,@DPTR
  715  02FD B4AA0F           CJNE  A,#0AAH,lnk
  716  0300 A3               INC   DPTR
  717  0301 E0               MOVX  A,@DPTR
  718  0302 B45A0A           CJNE  A,#05AH,lnk
  719  0305 A3               INC   DPTR
  720  0306 900000           MOV   DPTR,#UPTXT
  721  0309 12174C           LCALL stxt
  722  030C 020000           LJMP  rstvec
  723                 ;______________________________________
  724                 ; link interrupt procedures
  725                 ;
  726  030F 7400      lnk    MOV   A,#0
  727  0311 900100           MOV   DPTR,#usercode
  728  0314 1215FD           LCALL link
  729  0317 7401             MOV   A,#1
  730  0319 90010C           MOV   DPTR,#inte0
  731  031C 1215FD           LCALL link
  732  031F 7402             MOV   A,#2
  733  0321 900130           MOV   DPTR,#intf0
  734  0324 1215FD           LCALL link
  735  0327 7403             MOV   A,#3
  736  0329 90011E           MOV   DPTR,#inte1
  737  032C 1215FD           LCALL link
  738  032F 7404             MOV   A,#4
  739  0331 900142           MOV   DPTR,#intf1
  740  0334 1215FD           LCALL link
  741  0337 7405             MOV   A,#5
  742  0339 900154           MOV   DPTR,#intrt
  743  033C 1215FD           LCALL link
  744                 
  745  033F           if P80C552       
  746                 
  747                 ;Interruptions propres au 80C552       
  748                 ;
  749  033F 7406             MOV   A,#6
  750  0341 900166           MOV   DPTR,#intrt1
  751  0344 1215FD           LCALL link
  752  0347 7407             MOV   A,#7
  753  0349 900178           MOV   DPTR,#intc0
  754  034C 1215FD           LCALL link
  755  034F 7408             MOV   A,#8
  756  0351 90018A           MOV   DPTR,#intc1
  757  0354 1215FD           LCALL link
  758  0357 7409             MOV   A,#9
  759  0359 90019C           MOV   DPTR,#intc2
  760  035C 1215FD           LCALL link
  761  035F 740A             MOV   A,#10
  762  0361 9001AE           MOV   DPTR,#intc3
  763  0364 1215FD           LCALL link
  764  0367 740B             MOV   A,#11
  765  0369 9001C0           MOV   DPTR,#intadc
  766  036C 1215FD           LCALL link
  767  036F 740C             MOV   A,#12
  768  0371 9001D2           MOV   DPTR,#intcm0
  769  0374 1215FD           LCALL link
  770  0377 740D             MOV   A,#13
  771  0379 9001E4           MOV   DPTR,#intcm1
  772  037C 1215FD           LCALL link
  773  037F 740E             MOV   A,#14
  774  0381 9001F6           MOV   DPTR,#intcm2
  775  0384 1215FD           LCALL link
  776  0387 740F             MOV   A,#15
  777  0389 900208           MOV   DPTR,#intf2
  778  038C 1215FD           LCALL link
  779                 
  780                 else
  781                 
  782                 ;       
  783                 ;Timer2 (INTF2) vectorise apres les interruptions propres au 80C552
  784                        MOV   A,#6
  785                        MOV   DPTR,#intf2
  786                        LCALL link
  787                 
  788  038F           endif
  789                 
  790                 ;
  791                 ;______________________________________
  792                 ; interactive command interpreter
  793                 ;
  794                         
  795  038F 9000B7            mov     dptr,#TITLE
  796  0392 12027E            lcall   DTEXT
  797  0395 9000E9            mov     dptr,#MSYSTEM
  798  0398 12027E            lcall   DTEXT
  799                 
  800  039B           if P80C552
  801                 
  802  039B 9000FB            mov     dptr,#M80C552
  803                 
  804                 else
  805                 
  806                         mov     dptr,#M8052
  807                 
  808  039E           endif
  809                 
  810  039E 12027E            lcall   DTEXT
  811  03A1 900102            mov     dptr,#MUSING
  812  03A4 12027E            lcall   DTEXT
  813  03A7 7431              mov     a,#30H+DBGINT
  814  03A9 12024E            lcall   DDISA
  815                 
  816                 if SERINT
  817                 
  818                         mov     dptr,#MSERINT
  819                         lcall   DTEXT
  820                 
  821  03AC           endif
  822                 
  823  03AC 12026F            lcall   DDISNL
  824  03AF 78F8              mov     R0,#SAVESFR
  825  03B1 900100            mov     dptr,#usercode  ;User code entry point
  826  03B4 A683              mov     @R0,DPH
  827  03B6 08                inc     R0
  828  03B7 A682              mov     @R0,DPL
  829                 
  830                 ;-----  DEBUG command entry point
  831  03B9           RDEBUG:
  832  03B9 E4                clr     a
  833  03BA 78E8              mov     R0,#MODE
  834  03BC F6                mov     @R0,a
  835                 
  836  03BD C2AF              clr     EA
  837  03BF D21F              setb    INTBIT
  838  03C1 C28A              clr     IT0+DBGINT+DBGINT
  839  03C3 D2AA              setb    EX0+DBGINT+DBGINT
  840                 
  841                 if SERINT
  842                 
  843                         setb    ES
  844                 
  845  03C5           else
  846                 
  847  03C5 C2AC              clr     ES
  848                 
  849  03C7           endif
  850                 
  851  03C7 C2B3              clr     INT0+DBGINT
  852  03C9 D2AF              setb    EA
  853  03CB 020100            ljmp    usercode
  854                 
  855  03CE           INIT:
  856  03CE C2AF              clr     EA              ;disable all interrupts
  857  03D0 758112            mov     sp,#stk
  858  03D3 78FB              mov     R0,#SAVESFR+3
  859  03D5 A681              mov     @R0,sp
  860  03D7 E4                clr     a
  861  03D8 78E8              mov     R0,#MODE
  862  03DA F6                mov     @R0,a
  863                 
  864                 ;----- display SFRs and wait debug command      
  865  03DB           COMMAND:
  866  03DB 7581C0            mov     SP,#DEBUGSP
  867  03DE 12026F            lcall   DDISNL
  868                 ;       mov     R1,#SAVESFR+3
  869                 ;       mov     a,@R1
  870                 ;       mov     SP,a
  871  03E1 90054B            mov     dptr,#MSFR
  872  03E4 12027E            lcall   DTEXT           ;DISP MSG @ DPTR
  873  03E7 12026F            lcall   DDISNL          ;<CR>-<LF>
  874  03EA C026              push    26H
  875  03EC C236              clr     36H
  876  03EE 79F8              mov     R1,#SAVESFR     ;DISP -PC-
  877  03F0 E7                mov     a,@R1
  878  03F1 FA                mov     R2,a
  879  03F2 09                inc     R1
  880  03F3 E7                mov     a,@R1
  881  03F4 FB                mov     R3,a
  882  03F5 09                inc     R1
  883  03F6 12028E            lcall   DHEXW
  884  03F9 1207DB            lcall   DSPC
  885  03FC E7                mov     a,@R1           ;DISP PSW
  886  03FD 09                inc     R1
  887  03FE 1202B0            lcall   DHEXB
  888  0401 1207DB            lcall   DSPC
  889  0404 E7                mov     a,@R1           ;DISP SP
  890  0405 09                inc     R1
  891  0406 1202B0            lcall   DHEXB
  892  0409 1207DB            lcall   DSPC
  893  040C E7                mov     a,@R1           ;DISP ACC
  894  040D 09                inc     R1
  895  040E 1202B0            lcall   DHEXB
  896  0411 1207DB            lcall   DSPC
  897  0414 E7                mov     a,@R1           ;DISP B
  898  0415 09                inc     R1
  899  0416 1202B0            lcall   DHEXB
  900  0419 1207DB            lcall   DSPC
  901  041C E7                mov     a,@R1           ;DISP DPTR
  902  041D 09                inc     R1
  903  041E FA                mov     R2,a
  904  041F E7                mov     a,@R1           
  905  0420 09                inc     R1
  906  0421 FB                mov     R3,a
  907  0422 12028E            lcall   DHEXW
  908  0425 1207DB            lcall   DSPC
  909  0428 E590              mov     a,P1
  910  042A 1202B0            lcall   DHEXB
  911  042D 1207DB            lcall   DSPC
  912  0430 AA8C              mov     R2,TH0
  913  0432 AB8A              mov     R3,TL0
  914  0434 12028E            lcall   DHEXW
  915  0437 1207DB            lcall   DSPC
  916  043A AA8D              mov     R2,TH1
  917  043C AB8B              mov     R3,TL1
  918  043E 12028E            lcall   DHEXW
  919  0441 1207DB            lcall   DSPC
  920  0444 AACD              mov     R2,TH2
  921  0446 ABCC              mov     R3,TL2
  922  0448 12028E            lcall   DHEXW
  923  044B 1207DB            lcall   DSPC
  924  044E AACB              mov     R2,RCAP2H
  925  0450 ABCA              mov     R3,RCAP2L
  926  0452 12028E            lcall   DHEXW
  927  0455 1207DB            lcall   DSPC
  928  0458 E588              mov     a,TCON
  929  045A 1202B0            lcall   DHEXB
  930  045D 1207DB            lcall   DSPC
  931  0460 E589              mov     a,TMOD
  932  0462 1202B0            lcall   DHEXB
  933  0465 1207DB            lcall   DSPC
  934  0468 E5C8              mov     a,T2CON
  935  046A 1202B0            lcall   DHEXB
  936  046D 1207DB            lcall   DSPC
  937  0470 E5A8              mov     a,IE
  938  0472 1202B0            lcall   DHEXB
  939  0475 1207DB            lcall   DSPC
  940  0478 E5B8              mov     a,IP
  941  047A 1202B0            lcall   DHEXB
  942  047D 1207DB            lcall   DSPC
  943  0480 E523              mov     a,23H           ;flags
  944  0482 1202B0            lcall   DHEXB
  945  0485 D026              pop     26H
  946                 
  947                 ;----- Entry: Disassemble and Display "Cmd:" prompt     
  948  0487           COMMAND2:
  949  0487 12026F            lcall   DDISNL          ;<CR>-<LF>
  950                         
  951                         ;save DATA work area
  952  048A C026              push    26H
  953  048C 79D0              mov     R1,#SAVERAM
  954  048E 7810              mov     R0,#10H
  955  0490 75F018            mov     B,#18H
  956  0493           SAVERAM1:
  957  0493 E6                mov     a,@R0
  958  0494 F7                mov     @R1,a
  959  0495 08                inc     R0
  960  0496 09                inc     R1
  961  0497 D5F0F9            djnz    B,SAVERAM1
  962                         
  963                         ;disassemble single instruction
  964  049A 78F8              mov     R0,#SAVESFR
  965  049C E6                mov     a,@R0
  966  049D 08                inc     R0
  967  049E F518              mov     18H,a
  968  04A0 F51A              mov     1AH,a
  969  04A2 E6                mov     a,@R0           
  970  04A3 F519              mov     19H,a
  971  04A5 F51B              mov     1BH,a
  972  04A7 12100B            lcall   DASM1           
  973                         
  974                         ;restore DATA work area
  975  04AA 79D0              mov     R1,#SAVERAM
  976  04AC 75F018            mov     B,#18H
  977  04AF 7810              mov     R0,#10H
  978  04B1           SAVERAM2:
  979  04B1 E7                mov     a,@R1
  980  04B2 F6                mov     @R0,a
  981  04B3 08                inc     R0
  982  04B4 09                inc     R1
  983  04B5 D5F0F9            djnz    B,SAVERAM2
  984                         
  985  04B8 D026              pop     26H
  986                         
  987  04BA 78E8              mov     R0,#MODE
  988  04BC E6                mov     a,@R0
  989  04BD 30E525            jnb     ACC.5,COMMAND3          ;jump if not in trace mode (c/i)
  990  04C0 30980A            jnb     RI,TRACE1
  991  04C3 E599              mov     a,SBUF
  992  04C5 B41B05            cjne    a,#1BH,TRACE1           ;ESC pressed
  993  04C8 C298              clr     RI
  994  04CA F6                mov     @R0,a
  995  04CB 8018              sjmp    COMMAND3
  996                         
  997  04CD           TRACE1:
  998  04CD E6                mov     a,@R0
  999  04CE B46E02            cjne    a,#6EH,TRACE2
 1000  04D1 7463              mov     a,#63H                  ;n -> c
 1001  04D3           TRACE2:
 1002  04D3 B46303            cjne    a,#63H,TRACE3
 1003  04D6 0205AA            ljmp    COMC                    ;c => Trace call
 1004  04D9           TRACE3:
 1005  04D9 B46703            cjne    a,#67H,TRACE4
 1006  04DC 0205D7            ljmp    COMG                    ;g => Continue
 1007  04DF           TRACE4:
 1008  04DF B46903            cjne    a,#69H,COMMAND3
 1009  04E2 0205D5            ljmp    COMI                    ;i => Trace instr
 1010                         
 1011                         
 1012                 ;----- Entry: Display "Cmd:" prompt only
 1013  04E5           COMMAND3:
 1014  04E5 90058A            mov     dptr,#MCOMMAND
 1015  04E8 12027E            lcall   DTEXT                   ;disp msg C@ dptr
 1016  04EB 120236            lcall   WAITKI                  ;wait keystroke
 1017  04EE 30E602            jnb     ACC.6,COMM30
 1018  04F1 C2E5              clr     ACC.5                   ;to uppercase
 1019  04F3           COMM30:
 1020  04F3 12024E            lcall   DDISA                   ;display pressed key
 1021                         
 1022  04F6 B45A03            cjne    a,#5AH,COMNOZ
 1023  04F9 020A36            ljmp    ZAP                     ;(Z)ap: dump/modify Xmemory
 1024  04FC           COMNOZ:
 1025  04FC B42F03            cjne    a,#2FH,COMNOSLASH
 1026  04FF 0207E0            ljmp    COMSLASH                ;(/): change register/sfr
 1027  0502           COMNOSLASH:
 1028  0502 B44903            cjne    a,#49H,COMNOI
 1029  0505 0205D5            ljmp    COMI                    ;(I)nstruction step
 1030  0508           COMNOI:
 1031  0508 B44303            cjne    a,#43H,COMNOC
 1032  050B 0205AA            ljmp    COMC                    ;(C)all step
 1033  050E           COMNOC:
 1034  050E B45402            cjne    a,#54H,COMNOT
 1035  0511 807C              sjmp    COMT                    ;(T)race mode
 1036  0513           COMNOT:
 1037  0513 B45803            cjne    a,#58H,COMNOX
 1038  0516 0203DB            ljmp    COMMAND                 ;(X): display sfrs
 1039  0519           COMNOX:
 1040  0519 B45203            cjne    a,#52H,COMNOR
 1041  051C 020867            ljmp    COMR                    ;(R)egisters display
 1042  051F           COMNOR:
 1043  051F B44703            cjne    a,#47H,COMNOG
 1044  0522 0205D7            ljmp    COMG                    ;(G)o
 1045  0525           COMNOG:
 1046  0525 B44803            cjne    a,#48H,COMNOH
 1047  0528 020899            ljmp    COMH                    ;(H)ex load
 1048  052B           COMNOH:
 1049  052B B45303            cjne    a,#53H,COMNOS
 1050  052E 0208B4            ljmp    COMS                    ;(S)ource
 1051  0531           COMNOS:
 1052  0531 B44403            cjne    a,#44H,COMNOD
 1053  0534 0208FA            ljmp    COMD                    ;(D)ata display
 1054  0537           COMNOD:
 1055  0537 B45603            cjne    a,#56H,COMNOV
 1056  053A 020944            ljmp    COMV                    ;(V)erify RAM
 1057  053D           COMNOV:
 1058  053D B43F03            cjne    a,#3FH,ERRCOM           ;?=help
 1059  0540 020D9F            ljmp    DBGHLP
 1060                         ;for extensions ...
 1061  0543           ERRCOM:
 1062  0543 743F              mov     a,#3Fh                  ;'?'
 1063  0545 12024E            lcall   DDISA
 1064  0548 020487            ljmp    COMMAND2
 1065                         
 1066  054B           MSFR:
 1067  054B 2D50432D          db '-PC- PS SP  A  B DPTR P1 -T0- -T1- -T2- -RC- TC TM TT IE IP ??"'
       054F 20505320
       0553 53502020
       0557 41202042
       055B 20445054
       055F 52205031
       0563 202D5430
       0567 2D202D54
       056B 312D202D
       056F 54322D20
       0573 2D52432D
       0577 20544320
       057B 544D2054
       057F 54204945
       0583 20495020
       0587 3F3F22
 1068                         
 1069  058A           MCOMMAND:
 1070  058A 436D643A          db 'Cmd:"'
       058E 22
 1071                 
 1072                 ;-----  Trace mode
 1073  058F           COMT:
 1074  058F 120236            lcall   WAITKI                  ;wait key C/I
 1075  0592 12024E            lcall   DDISA
 1076  0595 D2E5              setb    ACC.5                   ;to lowercase
 1077  0597 C0E0              push    ACC
 1078  0599 120236            lcall   WAITKI                  ;wait CR
 1079  059C F8                mov     R0,a
 1080  059D D0E0              pop     ACC
 1081  059F B80DA1            cjne    R0,#0DH,ERRCOM          ;not CR => error
 1082  05A2 B46902            cjne    a,#69H,COMT1
 1083  05A5 802E              sjmp    COMI
 1084  05A7           COMT1:
 1085  05A7 B46399            cjne    a,#63H,ERRCOM
 1086                 
 1087                 ;-----  Call step/trace (UC=step, LC=trace)
 1088  05AA           COMC:
 1089  05AA 12026F            lcall   DDISNL
 1090  05AD 78E8              mov     R0,#MODE
 1091  05AF F6                mov     @R0,a                   ;save mode = C (step) or c (trace)
 1092  05B0 C2B3              clr     INT0+DBGINT
 1093  05B2 78F8              mov     R0,#SAVESFR             ;load PC
 1094  05B4 E6                mov     a,@R0
 1095  05B5 08                inc     R0
 1096  05B6 F583              mov     DPH,a
 1097  05B8 E6                mov     a,@R0
 1098  05B9 F582              mov     DPL,a
 1099  05BB E4                clr     a
 1100  05BC 93                movc    a,@A+dptr
 1101  05BD B41202            cjne    a,#12H,COMC0            ;LCALL ?
 1102  05C0 8005              sjmp    COMC1
 1103  05C2           COMC0:
 1104  05C2 541F              anl     a,#1FH
 1105  05C4 B41102            cjne    a,#11H,COMC2            ;ACALL ?
 1106  05C7           COMC1:
 1107  05C7 8014              sjmp    RESUME
 1108  05C9           COMC2:
 1109  05C9 78E8              mov     R0,#MODE
 1110  05CB E6                mov     a,@R0
 1111  05CC A2E5              mov     C,ACC.5
 1112  05CE 744E              mov     a,#4EH                  ;'N'
 1113  05D0 92E5              mov     ACC.5,C
 1114  05D2 F6                mov     @R0,a
 1115  05D3 8008              sjmp    RESUME
 1116                 
 1117                 
 1118  05D5           COMI:
 1119  05D5 C2B3              clr     INT0+DBGINT
 1120  05D7           COMG:
 1121  05D7 12026F            lcall   DDISNL
 1122  05DA 78E8              mov     R0,#MODE
 1123  05DC F6                mov     @R0,a
 1124  05DD           RESUME:
 1125  05DD 78FB              mov     R0,#SAVESFR+3   ;restore SP
 1126  05DF 8681              mov     sp,@R0          
 1127                 
 1128  05E1 78F8              mov     R0,#SAVESFR     
 1129  05E3 86F0              mov     b,@R0           ;PCH
 1130  05E5 08                inc     R0
 1131  05E6 E6                mov     a,@R0           ;PCL
 1132  05E7 08                inc     R0
 1133  05E8 C0E0              push    ACC             ;push ret address
 1134  05EA C0F0              push    B
 1135  05EC E6                mov     a,@R0           ;PSW
 1136  05ED 08                inc     R0
 1137  05EE C0E0              push    ACC             ;push PSW
 1138  05F0 08                inc     R0              ;BYPASS SP
 1139  05F1 E6                mov     a,@R0           ;ACC
 1140  05F2 08                inc     R0
 1141  05F3 C0E0              push    ACC             ;push ACC
 1142  05F5 86F0              mov     b,@R0           ;B
 1143  05F7 08                inc     R0
 1144  05F8 E6                mov     a,@R0           ;DPH
 1145  05F9 08                inc     R0
 1146  05FA C0E0              push    ACC             ;push DPH
 1147  05FC E6                mov     a,@R0           ;DPL
 1148  05FD 08                inc     R0
 1149  05FE C0E0              push    ACC             ;push DPL
 1150                 
 1151  0600 78F1              mov     R0,#SAVEREG+1   ;bypass r0
 1152  0602 E6                mov     a,@R0           ;R1
 1153  0603 08                inc     R0
 1154  0604 F9                mov     R1,a
 1155  0605 E6                mov     a,@R0           ;R2
 1156  0606 08                inc     R0
 1157  0607 FA                mov     R2,a
 1158  0608 E6                mov     a,@R0           ;R3
 1159  0609 08                inc     R0
 1160  060A FB                mov     R3,a
 1161  060B E6                mov     a,@R0           ;R4
 1162  060C 08                inc     R0
 1163  060D FC                mov     R4,a
 1164  060E E6                mov     a,@R0           ;R5
 1165  060F 08                inc     R0
 1166  0610 FD                mov     R5,a
 1167  0611 E6                mov     a,@R0           ;R6
 1168  0612 08                inc     R0
 1169  0613 FE                mov     R6,a
 1170  0614 E6                mov     a,@R0           ;R7
 1171  0615 08                inc     R0
 1172  0616 FF                mov     R7,a
 1173                 
 1174  0617 78F0              mov     R0,#SAVEREG
 1175  0619 E6                mov     a,@R0           ;R0
 1176  061A F8                mov     R0,a
 1177                 
 1178  061B 7400              mov     a,#SERINT
 1179  061D 13                rrc     a
 1180  061E 921D              mov     SINTDBG,c
 1181                 
 1182  0620 D082              pop     DPL
 1183  0622 D083              pop     DPH
 1184  0624 D0E0              pop     ACC
 1185  0626 D0D0              pop     PSW
 1186                 
 1187  0628 D21F              setb    INTBIT
 1188  062A C28A              clr     IT0+DBGINT+DBGINT
 1189  062C D2AA              setb    EX0+DBGINT+DBGINT
 1190                 
 1191                 if SERINT
 1192                 
 1193                         setb    ES
 1194                 
 1195  062E           else
 1196                 
 1197  062E C2AC              clr     ES
 1198                 
 1199  0630           endif
 1200                 
 1201  0630 301C05            jnb     RETIFLG,RESUMEX
 1202  0633 C21C              clr     RETIFLG
 1203  0635 D2AF              setb    EA
 1204  0637 32                reti
 1205  0638           RESUMEX:
 1206  0638 D2AF              setb    EA
 1207  063A 32                reti
 1208                 
 1209  063B           XSERINT:
 1210  063B 309815            jnb     RI,NORI
 1211  063E C2AC              clr     ES
 1212  0640 C0E0              push    ACC
 1213  0642 E599              mov     a,SBUF
 1214  0644 B40408            cjne    a,#04,NOSERINT  ;CTRL-D
 1215  0647 D0E0              pop     ACC
 1216  0649 C298              clr     RI
 1217  064B D21C              setb    RETIFLG
 1218  064D 8071              sjmp    INT
 1219  064F           NOSERINT:
 1220  064F D0E0              pop     ACC
 1221  0651 D2AC              setb    ES
 1222  0653           NORI:
 1223  0653 32                reti
 1224                 
 1225  0654           dbgcont:
 1226  0654 C0D0              PUSH    PSW
 1227  0656 C0E0              PUSH    ACC
 1228  0658 E8                MOV     A,R0
 1229  0659 C0E0              PUSH    ACC
 1230  065B 78E8              MOV     R0,#MODE
 1231  065D E6                MOV     A,@R0
 1232  065E 7667              MOV     @R0,#'g'        ; go
 1233  0660 C2E5              CLR     ACC.5           ; to upper case
 1234  0662 B4434C            CJNE    A,#'C',dbg1
 1235  0665 8035              SJMP    dbg0
 1236                 
 1237  0667           dbgsnap:
 1238  0667 C0D0              PUSH    PSW
 1239  0669 C0E0              PUSH    ACC
 1240  066B E8                MOV     A,R0
 1241  066C C0E0              PUSH    ACC
 1242  066E 78E8              MOV     R0,#MODE
 1243  0670 E6                MOV     A,@R0
 1244  0671 C2E5              CLR     ACC.5           ; to upper case
 1245  0673 B44702            CJNE    A,#'G',dbgs0
 1246  0676 800F              SJMP    dbgs1
 1247  0678           dbgs0:  ;SJMP   dbg0
 1248  0678 D21C              setb    RETIFLG         ; force RETI
 1249  067A B44334            CJNE    A,#'C',dbg1
 1250  067D E6                MOV     A,@R0
 1251  067E A2E5              MOV     C,ACC.5
 1252  0680 744E              MOV     A,#'N'          ; break
 1253  0682 92E5              MOV     ACC.5,C
 1254  0684 F6                MOV     @R0,A           
 1255  0685 8015              SJMP    dbg0
 1256  0687 7667      dbgs1:  MOV     @R0,#'g'        ; go
 1257  0689 8026              SJMP    dbg1
 1258                 
 1259  068B           dbgbrk:
 1260  068B C0D0              PUSH    PSW
 1261  068D C0E0              PUSH    ACC
 1262  068F E8                MOV     A,R0
 1263  0690 C0E0              PUSH    ACC
 1264  0692 78E8              MOV     R0,#MODE
 1265  0694 E6                MOV     A,@R0
 1266  0695 764E              MOV     @R0,#'N'        ; break
 1267  0697 C2E5              CLR     ACC.5           ; to upper case
 1268  0699 B44315            CJNE    A,#'C',dbg1
 1269  069C 78EE      dbg0:   MOV     R0,#SAVERET
 1270  069E E6                MOV     A,@R0
 1271  069F C0E0              PUSH    ACC
 1272  06A1 08                INC     R0
 1273  06A2 E6                MOV     A,@R0
 1274  06A3 C0E0              PUSH    ACC
 1275  06A5 78ED              MOV     R0,#SAVESP
 1276  06A7 E6                MOV     A,@R0
 1277  06A8 14                DEC     A
 1278  06A9 F8                MOV     R0,A
 1279  06AA D0E0              POP     ACC
 1280  06AC F6                MOV     @R0,A
 1281  06AD 08                INC     R0
 1282  06AE D0E0              POP     ACC
 1283  06B0 F6                MOV     @R0,A
 1284  06B1 D0E0      dbg1:   POP     ACC
 1285  06B3 F8                MOV     R0,A
 1286  06B4 D0E0              POP     ACC
 1287  06B6 D0D0              POP     PSW
 1288  06B8 D21C              setb    RETIFLG         ; force RETI
 1289  06BA 8004              SJMP    INT
 1290                         
 1291  06BC           XINT0:
 1292  06BC D21C              setb    RETIFLG
 1293  06BE D2B3              setb    INT0+DBGINT
 1294  06C0           INT:
 1295  06C0 C2AF              clr     EA
 1296  06C2 C2AA              clr     EX0+DBGINT+DBGINT
 1297  06C4 C2AC              clr     ES
 1298  06C6 C21F              clr     INTBIT
 1299  06C8 C21D              clr     SINTDBG
 1300  06CA C082              push    DPL
 1301  06CC C083              push    DPH
 1302  06CE C0E0              push    ACC
 1303                 
 1304                         ; save R0-R7
 1305  06D0 E8                mov     a,R0            ;SAVE R0
 1306  06D1 78F0              mov     R0,#SAVEREG
 1307  06D3 F6                mov     @R0,a
 1308  06D4 08                inc     R0
 1309  06D5 E9                mov     a,R1
 1310  06D6 F6                mov     @R0,a
 1311  06D7 08                inc     R0
 1312  06D8 EA                mov     a,R2
 1313  06D9 F6                mov     @R0,a
 1314  06DA 08                inc     R0
 1315  06DB EB                mov     a,R3
 1316  06DC F6                mov     @R0,a
 1317  06DD 08                inc     R0
 1318  06DE EC                mov     a,R4
 1319  06DF F6                mov     @R0,a
 1320  06E0 08                inc     R0
 1321  06E1 ED                mov     a,R5
 1322  06E2 F6                mov     @R0,a
 1323  06E3 08                inc     R0
 1324  06E4 EE                mov     a,R6
 1325  06E5 F6                mov     @R0,a
 1326  06E6 08                inc     R0
 1327  06E7 EF                mov     a,R7
 1328  06E8 F6                mov     @R0,a
 1329                 
 1330                         ; save SFRs
 1331  06E9 78FA              mov     R0,#SAVESFR+2
 1332  06EB A6D0              mov     @R0,psw         ;Save PSW
 1333  06ED 08                inc     R0
 1334  06EE 08                inc     R0              ;BYPASS SP
 1335  06EF D0E0              pop     ACC             ;GET a
 1336  06F1 F6                mov     @R0,a
 1337  06F2 08                inc     R0
 1338  06F3 A6F0              mov     @R0,B           ;SAVE B
 1339  06F5 08                inc     R0
 1340  06F6 D0E0              pop     ACC             ;SAVE DPH
 1341  06F8 F6                mov     @R0,a
 1342  06F9 08                inc     R0
 1343  06FA D0E0              pop     ACC             ;SAVE DPL
 1344  06FC F6                mov     @R0,a
 1345  06FD 08                inc     R0
 1346                 
 1347  06FE 76F8              mov     @R0,#SAVESFR
 1348  0700 D0E0              pop     ACC             ;SAVE PCH
 1349  0702 F6                mov     @R0,a
 1350  0703 08                inc     R0
 1351  0704 D0E0              pop     ACC             ;SAVE PCL
 1352  0706 F6                mov     @R0,a
 1353  0707 08                inc     R0
 1354  0708 08                inc     R0              ;BYPASS PSW
 1355  0709 A681              mov     @R0,sp          ;SAVE SP
 1356                 
 1357  070B 78E8              mov     R0,#MODE
 1358  070D E6                mov     a,@R0
 1359  070E 545F              anl     a,#5FH
 1360  0710 B4431B            cjne    a,#43H,XINT0NOC ;'C'
 1361  0713 78ED              mov     R0,#SAVESP      ;if Call step,
 1362  0715 A681              mov     @R0,sp          ;    save stack pointer
 1363  0717 78EE              mov     R0,#SAVERET
 1364  0719 D0E0              pop     ACC             ;    pop and save return address
 1365  071B F6                mov     @R0,a
 1366  071C 08                inc     R0
 1367  071D D0E0              pop     ACC
 1368  071F F6                mov     @R0,a
 1369  0720 900731            mov     dptr,#RETURN    ;    push alternate ret address
 1370  0723 E582              mov     a,DPL
 1371  0725 C0E0              push    ACC
 1372  0727 E583              mov     a,DPH
 1373  0729 C0E0              push    ACC
 1374  072B 0205DD            ljmp    RESUME          ;    resume execution of routine without interruption
 1375                 
 1376  072E           XINT0NOC:
 1377  072E 0203DB            ljmp    COMMAND
 1378                 
 1379  0731           RETURN:
 1380  0731 C0E0              push    ACC
 1381  0733 E8                mov     a,R0
 1382  0734 78F0              mov     R0,#SAVEREG
 1383  0736 F6                mov     @R0,a
 1384  0737 D0E0              pop     ACC
 1385                 
 1386  0739 78FC              mov     R0,#SAVESFR+4
 1387  073B F6                mov     @R0,a                   ;save ACC
 1388                 ;       inc     R0
 1389                 ;       inc     R0                      ;skip B
 1390                 ;       mov     @R0,dph                 ;save DPH
 1391                 ;       inc     R0
 1392                 ;       mov     @R0,dpl                 ;save DPL
 1393                 
 1394  073C 78EE              mov     R0,#SAVERET
 1395  073E E6                mov     a,@R0
 1396  073F 08                inc     R0
 1397  0740 C0E0              push    ACC
 1398  0742 E6                mov     a,@R0
 1399  0743 A881              mov     r0,sp
 1400  0745 C6                xch     a,@r0
 1401  0746 C0E0              push    ACC
 1402                 ;       mov     a,@R0
 1403                 ;       pop     DPH
 1404                 ;       push    ACC
 1405                 ;       push    DPH
 1406                 
 1407  0748 78E8              mov     R0,#MODE
 1408  074A E6                mov     a,@R0
 1409  074B C0D0              push    PSW
 1410  074D A2E5              mov     C,ACC.5
 1411  074F 744E              mov     a,#4EH
 1412  0751 92E5              mov     ACC.5,C
 1413  0753 D0D0              pop     PSW
 1414  0755 F6                mov     @R0,a
 1415                 
 1416  0756 78FC              mov     R0,#SAVESFR+4           ;ACC/B/DPH/DPL
 1417  0758 E6                mov     a,@R0                   ;get A
 1418                 ;       inc     R0
 1419                 ;       inc     R0                      ;skip B
 1420                 ;       mov     dph,@R0                 ;get DPH
 1421                 ;       inc     R0
 1422                 ;       mov     dpl,@R0                 ;get DPL
 1423                 
 1424  0759 C0E0              push    ACC
 1425  075B 78F0              mov     R0,#SAVEREG
 1426  075D E6                mov     a,@R0
 1427  075E F8                mov     R0,a
 1428  075F D0E0              pop     ACC
 1429                 
 1430                 ;       push    PSW
 1431  0761 D21C              setb    RETIFLG
 1432  0763 0206C0            ljmp    INT
 1433                 
 1434  0766           RHEXW:
 1435  0766 E9                mov     a,R1
 1436  0767 C0E0              push    ACC
 1437  0769 E4                clr     a
 1438  076A F8                mov     R0,a
 1439  076B FA                mov     R2,a
 1440  076C FB                mov     R3,a
 1441  076D           RHEXW0:
 1442  076D 120236            lcall   WAITKI
 1443  0770 12024E            lcall   DDISA
 1444  0773 B45803            cjne    a,#58H,RHEXW1           ;exit if 'X'
 1445  0776 0203DB            ljmp    COMMAND
 1446  0779           RHEXW1:
 1447  0779 B47F1A            cjne    a,#7FH,RHEXW2           ;backspace
 1448  077C E8                mov     a,R0
 1449  077D 60EE              jz      RHEXW0
 1450  077F 7408              mov     a,#8
 1451  0781 12024E            lcall   DDISA
 1452  0784 18                dec     R0
 1453  0785 E5D0              mov     a,PSW
 1454  0787 5418              anl     a,#18h
 1455  0789 4402              orl     a,#2
 1456  078B F9                mov     R1,a
 1457  078C E4                clr     a
 1458  078D C7                xch     a,@R1
 1459  078E C4                swap    a
 1460  078F D7                xchd    a,@R1
 1461  0790 09                inc     R1
 1462  0791 C7                xch     a,@R1
 1463  0792 C4                swap    a
 1464  0793 D7                xchd    a,@R1
 1465  0794 80D7              sjmp    RHEXW0
 1466  0796           RHEXW2:
 1467  0796 B40D04            cjne    a,#0DH,RHEXW4           ;<CR>
 1468  0799 D0E0      RHEXWX: pop     ACC
 1469  079B F9                mov     R1,a
 1470  079C 22                ret
 1471  079D           RHEXW4:
 1472  079D B42C02            cjne    a,#2CH,RHEXW5           ;','
 1473  07A0 80F7              sjmp    RHEXWX
 1474  07A2           RHEXW5:
 1475  07A2 B42002            cjne    a,#20H,RHEXW6           ;' '
 1476  07A5 80F2              sjmp    RHEXWX
 1477  07A7           RHEXW6:
 1478  07A7 B44802            cjne    a,#48H,RHEXW8           ;'H'
 1479  07AA 80C1              sjmp    RHEXW0
 1480  07AC           RHEXW8:
 1481  07AC C3                clr     C
 1482  07AD 943A              subb    a,#3AH
 1483  07AF 4003              jc      RHEXW7
 1484  07B1 C3                clr     C
 1485  07B2 9407              subb    a,#7
 1486  07B4           RHEXW7:
 1487  07B4 240A              add     a,#0AH
 1488  07B6 C4                swap    a
 1489                 
 1490  07B7 C9                xch     a,R1
 1491  07B8 E5D0              mov     a,PSW
 1492  07BA 5418              anl     a,#18h
 1493  07BC 4403              orl     a,#3
 1494  07BE C9                xch     a,R1
 1495                 
 1496  07BF D7                xchd    a,@R1
 1497  07C0 C4                swap    a
 1498  07C1 C7                xch     a,@R1
 1499  07C2 19                dec     R1
 1500  07C3 D7                xchd    a,@R1
 1501  07C4 C4                swap    a
 1502  07C5 C7                xch     a,@R1
 1503  07C6 08                inc     R0
 1504  07C7 80A4              sjmp    RHEXW0
 1505                 
 1506                 ;-----  Wait char from kbrd
 1507  07C9           WAITCHR:
 1508  07C9 F5F0              mov     B,a
 1509  07CB           WAITCHR0:
 1510  07CB 120236            lcall   WAITKI
 1511  07CE 12024E            lcall   DDISA
 1512  07D1 B40303            cjne    a,#03H,WAITCHR1
 1513  07D4 0203DB            ljmp    COMMAND
 1514  07D7           WAITCHR1:
 1515  07D7 B5F0F1            cjne    a,B,WAITCHR0
 1516  07DA 22                ret
 1517                 
 1518                 ;-----  Disp space
 1519  07DB           DSPC:
 1520  07DB 7420              mov     a,#20H
 1521  07DD 02024E            ljmp    DDISA
 1522                 
 1523                 ;-----  command: /reg=value
 1524  07E0           COMSLASH:
 1525  07E0 120236            lcall   WAITKI
 1526  07E3 12024E            lcall   DDISA
 1527  07E6 B4410F            cjne    a,#41H,SFRNOTA
 1528  07E9 79FC              mov     R1,#SAVESFR+4
 1529  07EB           UPDATEB:
 1530  07EB 743D              mov     a,#3DH
 1531  07ED 1207C9            lcall   WAITCHR
 1532  07F0 120766            lcall   RHEXW
 1533  07F3 EB                mov     a,R3
 1534  07F4 F7                mov     @R1,a
 1535  07F5 0203DB            ljmp    COMMAND
 1536  07F8           SFRNOTA:
 1537  07F8 B44204            cjne    a,#42H,SFRNOTB
 1538  07FB 79FD              mov     R1,#SAVESFR+5
 1539  07FD 80EC              sjmp    UPDATEB
 1540  07FF           SFRNOTB:
 1541  07FF B44413            cjne    a,#44H,SFRNOTD
 1542  0802 79FE              mov     R1,#SAVESFR+6
 1543  0804           UPDATEW:
 1544  0804 743D              mov     a,#3DH
 1545  0806 1207C9            lcall   WAITCHR
 1546  0809 120766            lcall   RHEXW
 1547  080C EA                mov     a,R2
 1548  080D F7                mov     @R1,a
 1549  080E 09                inc     R1
 1550  080F EB                mov     a,R3
 1551  0810 F7                mov     @R1,a
 1552  0811 09                inc     R1
 1553  0812 0203DB            ljmp    COMMAND
 1554  0815           SFRNOTD:
 1555  0815 B45027            cjne    a,#50H,SFRNOTP
 1556  0818 120236            lcall   WAITKI
 1557  081B 12024E            lcall   DDISA
 1558  081E B4310E            cjne    a,#31H,SFRNOTP1
 1559  0821 743D              mov     a,#3DH
 1560  0823 1207C9            lcall   WAITCHR
 1561  0826 120766            lcall   RHEXW
 1562  0829 EB                mov     a,R3
 1563  082A F590              mov     P1,a
 1564  082C 0203DB            ljmp    COMMAND
 1565  082F           SFRNOTP1:
 1566  082F B44304            cjne    a,#43H,SFRNOTPC
 1567  0832 79F8              mov     R1,#SAVESFR
 1568  0834 80CE              sjmp    UPDATEW
 1569  0836           SFRNOTPC:
 1570  0836 B45304            cjne    a,#53H,SFRNOTPS
 1571  0839 79FA              mov     R1,#SAVESFR+2
 1572  083B 80C7              sjmp    UPDATEW
 1573  083D           SFRNOTPS:
 1574  083D 8025              sjmp    SFRNOTX
 1575  083F           SFRNOTP:
 1576  083F B45222            cjne    a,#52H,SFRNOTR
 1577  0842 120236            lcall   WAITKI
 1578  0845 12024E            lcall   DDISA
 1579  0848 C3                clr     C
 1580  0849 9430              subb    a,#30H
 1581  084B 4017              jc      SFRNOTX
 1582  084D 9408              subb    a,#8
 1583  084F 5013              jnc     SFRNOTX
 1584  0851 2408              add     a,#8
 1585  0853 79F0              mov     R1,#SAVEREG
 1586  0855 29                add     a,R1
 1587  0856 F9                mov     R1,a
 1588  0857 743D              mov     a,#3DH
 1589  0859 1207C9            lcall   WAITCHR
 1590  085C 120766            lcall   RHEXW
 1591  085F EB                mov     a,R3
 1592  0860 F7                mov     @R1,a
 1593  0861 0203DB            ljmp    COMMAND
 1594  0864           SFRNOTR:
 1595  0864           SFRNOTX:
 1596  0864 020487            ljmp    COMMAND2
 1597                 
 1598                 ;-----  Command: r=display R0-R7
 1599  0867           COMR:
 1600  0867 12026F            lcall   DDISNL
 1601  086A 75F008            mov     B,#8
 1602  086D 7930              mov     R1,#30H
 1603  086F           COMR1:
 1604  086F 7452              mov     a,#52H
 1605  0871 12024E            lcall   DDISA
 1606  0874 E9                mov     a,R1
 1607  0875 12024E            lcall   DDISA
 1608  0878 7420              mov     a,#20H
 1609  087A 12024E            lcall   DDISA
 1610  087D 09                inc     R1
 1611  087E D5F0EE            djnz    B,COMR1
 1612  0881 12026F            lcall   DDISNL
 1613  0884 75F008            mov     B,#8
 1614  0887 79F0              mov     R1,#SAVEREG
 1615  0889           COMR2:
 1616  0889 E7                mov     a,@R1
 1617  088A 09                inc     R1
 1618  088B 1202B0            lcall   DHEXB
 1619  088E 7420              mov     a,#20H
 1620  0890 12024E            lcall   DDISA
 1621  0893 D5F0F3            djnz    B,COMR2
 1622  0896 0203DB            ljmp    COMMAND
 1623                 
 1624                 ;-----  Command: load hex file
 1625  0899 900F39    COMH:   mov     dptr,#MREADY
 1626  089C 12027E            call    DTEXT
 1627  089F 120F74            call    recvhex
 1628  08A2 700D              jnz     COMHX
 1629  08A4 E583              mov     a,dph
 1630  08A6 4582              orl     a,dpl
 1631  08A8 6007              jz      COMHX                   ;jump if no entry point
 1632  08AA 78F8              mov     r0,#SAVESFR
 1633  08AC A683              mov     @r0,dph
 1634  08AE 08                inc     r0
 1635  08AF A682              mov     @r0,dpl
 1636  08B1 020487    COMHX:  ljmp    COMMAND2
 1637                 
 1638                 ;-----  Command: Disassemble (source)
 1639  08B4 C018      COMS:   push    18h
 1640  08B6 C019              push    19h
 1641  08B8 C01A              push    1Ah
 1642  08BA C01B              push    1Bh
 1643  08BC 120766            call    RHEXW
 1644  08BF 12026F            call    DDISNL
 1645  08C2 E8                mov     a,r0
 1646  08C3 6010              jz      COMS1                   ;no value => disp page of instr
 1647  08C5 8A18              mov     18h,r2
 1648  08C7 8B19              mov     19h,r3
 1649  08C9 120766            call    RHEXW
 1650  08CC 8A1A              mov     1Ah,r2
 1651  08CE 8B1B              mov     1Bh,r3
 1652  08D0 12100B            call    DASM1
 1653  08D3 801A              sjmp    COMSX
 1654  08D5           COMS1:
 1655  08D5 78F8              mov     R0,#SAVESFR
 1656  08D7 E6                mov     a,@R0
 1657  08D8 08                inc     R0
 1658  08D9 F518              mov     18H,a
 1659  08DB F51A              mov     1AH,a
 1660  08DD E6                mov     a,@R0           
 1661  08DE F519              mov     19H,a
 1662  08E0 F51B              mov     1BH,a
 1663  08E2 75F016            mov     b,#22
 1664  08E5           COMS2:
 1665  08E5 C0F0              push    b
 1666  08E7 12100B            lcall   DASM1
 1667  08EA D0F0              pop     b
 1668  08EC D5F0F6            djnz    b,COMS2
 1669  08EF           COMSX:
 1670  08EF D01B              pop     1Bh
 1671  08F1 D01A              pop     1Ah
 1672  08F3 D019              pop     19h
 1673  08F5 D018              pop     18h
 1674  08F7 0204E5            ljmp    COMMAND3
 1675                 
 1676                 ;-----  Command: Display Data memory
 1677  08FA 7900      COMD:   mov     r1,#0
 1678  08FC C236              clr     36h
 1679  08FE E9        COMD0:  mov     a,r1
 1680  08FF 540F              anl     a,#0Fh
 1681  0901 700D              jnz     COMD1
 1682  0903 12026F            call    DDISNL
 1683  0906 E9                mov     a,r1
 1684  0907 1202B0            call    DHEXB
 1685  090A 12025E            call    DDISSP
 1686  090D 12025E            call    DDISSP
 1687  0910 E7        COMD1:  mov     a,@r1
 1688  0911 09                inc     r1
 1689  0912 1202B0            call    DHEXB
 1690  0915 E7                mov     a,@r1
 1691  0916 09                inc     r1
 1692  0917 1202B0            call    DHEXB
 1693  091A 12025E            call    DDISSP
 1694  091D E9                mov     a,r1
 1695  091E 540F              anl     a,#0Fh
 1696  0920 70EE              jnz     COMD1
 1697  0922 74F0              mov     a,#0F0h
 1698  0924 29                add     a,r1
 1699  0925 F9                mov     r1,a
 1700  0926 E7        COMD2:  mov     a,@r1
 1701  0927 09                inc     r1
 1702  0928 24E0              add     a,#0E0h
 1703  092A 5008              jnc     COMD3
 1704  092C 24A0              add     a,#0A0h
 1705  092E 4004              jc      COMD3
 1706  0930 2480              add     a,#80h
 1707  0932 8002              sjmp    COMD4
 1708  0934 742E      COMD3:  mov     a,#'.'
 1709  0936 12024E    COMD4:  call    DDISA
 1710  0939 E9                mov     a,r1
 1711  093A 540F              anl     a,#0Fh
 1712  093C 70E8              jnz     COMD2
 1713  093E E9                mov     a,r1
 1714  093F 70BD              jnz     COMD0
 1715  0941 020487            ljmp    COMMAND2
 1716                 
 1717                 ;-----  Command: Verify RAM
 1718  0944           COMV:
 1719  0944 12026F            lcall   DDISNL
 1720  0947 7B00              mov     r3,#0
 1721  0949 900000            mov     dptr,#0
 1722  094C 7C01      COMV0:  mov     r4,#1
 1723  094E E0                movx    a,@dptr
 1724  094F F9                mov     r1,a
 1725  0950 F4                cpl     a
 1726  0951 FA                mov     r2,a
 1727  0952 F0                movx    @dptr,a
 1728  0953 E0                movx    a,@dptr
 1729  0954 89F0              mov     b,r1
 1730  0956 B5F002            cjne    a,b,COMV1
 1731  0959 8016              sjmp    COMVX           ;no RAM
 1732  095B 0C        COMV1:  inc     r4
 1733  095C 8AF0              mov     b,r2
 1734  095E B5F010            cjne    a,b,COMVX       ;bad RAM
 1735  0961 0C                inc     r4
 1736  0962 E4                clr     a
 1737  0963 93                movc    a,@a+dptr
 1738  0964 B5F00A            cjne    a,b,COMVX       ;RAM Data
 1739  0967 E9                mov     a,r1
 1740  0968 F0                movx    @dptr,a
 1741  0969 E4                clr     a
 1742  096A 93                movc    a,@a+dptr
 1743  096B 89F0              mov     b,r1
 1744  096D B5F001            cjne    a,b,COMVX
 1745  0970 0C                inc     r4
 1746  0971 E9        COMVX:  mov     a,r1
 1747  0972 F0                movx    @dptr,a
 1748  0973 EC                mov     a,r4
 1749  0974 8BF0              mov     b,r3
 1750  0976 B5F00A            cjne    a,b,COMVZ
 1751  0979 A3        COMVY:  inc     dptr
 1752  097A E583              mov     a,dph
 1753  097C 4582              orl     a,dpl
 1754  097E 70CC              jnz     COMV0
 1755  0980 0204E5            ljmp    COMMAND3
 1756  0983 FB        COMVZ:  mov     r3,a
 1757  0984 C236              clr     36h
 1758  0986 120297            lcall   DHEXDP
 1759  0989 12025E            lcall   DDISSP
 1760  098C C083              push    dph
 1761  098E C082              push    dpl
 1762  0990 EB                mov     a,r3
 1763  0991 9009B2            mov     dptr,#MNORAM
 1764  0994 14                dec     a
 1765  0995 600F              jz      COMVD
 1766  0997 9009B9            mov     dptr,#MBADRAM
 1767  099A 14                dec     a
 1768  099B 6009              jz      COMVD
 1769  099D 9009C1            mov     dptr,#MRAMDATA
 1770  09A0 14                dec     a
 1771  09A1 6003              jz      COMVD
 1772  09A3 9009C7            mov     dptr,#MRAMCODA
 1773  09A6 12027E    COMVD:  lcall   DTEXT
 1774  09A9 D082              pop     dpl
 1775  09AB D083              pop     dph
 1776  09AD 12026F            lcall   DDISNL
 1777  09B0 80C7              sjmp    COMVY
 1778                         
 1779  09B2           MNORAM:
 1780  09B2 4E6F2052          db      'No RAM"'
       09B6 414D22
 1781  09B9           MBADRAM:
 1782  09B9 42616420          db      'Bad RAM"'
       09BD 52414D22
 1783  09C1           MRAMDATA:
 1784  09C1 58444154          db      'XDATA"'
       09C5 4122
 1785  09C7           MRAMCODA:
 1786  09C7 58444154          db      'XDATA+CODE"'
       09CB 412B434F
       09CF 444522
 1787                 
 1788                 ;-----  Char constants
 1789  001B           ESC     equ     1BH
 1790  005B           LEFTBRA equ     5BH
 1791  003B           SEMICOL equ     3BH
 1792  002E           POINT   equ     2EH
 1793  002D           MINUS   equ     2DH
 1794  0001           BREAK   equ     01H
 1795  000D           ENTER   equ     0DH
 1796                 
 1797                 ;-----  Disp <ESC>[
 1798  09D2           ESCANSI:
 1799  09D2 741B              mov     a,#ESC
 1800  09D4 12024E            lcall   DDISA
 1801  09D7 745B              mov     a,#LEFTBRA
 1802  09D9 12024E            lcall   DDISA
 1803  09DC 22                ret
 1804                 
 1805                 ;-----  Disp hex or dcb byte
 1806  09DD           OUTHEX:
 1807  09DD           OUTBCD:
 1808  09DD C0E0              push    ACC
 1809  09DF C4                swap    a
 1810  09E0 1209E5            lcall   OUTBCD2
 1811  09E3 D0E0              pop     ACC
 1812  09E5           OUTBCD2:
 1813  09E5 540F              anl     a,#0FH
 1814  09E7 B40A00            cjne    a,#0AH,OUTBCD3
 1815  09EA           OUTBCD3:
 1816  09EA 4002              jc      OUTBCD4
 1817  09EC 2407              add     a,#07H
 1818  09EE           OUTBCD4:
 1819  09EE 2430              add     a,#30H
 1820  09F0 12024E            lcall   DDISA
 1821  09F3 22                ret
 1822                 
 1823                 ;-----  ANSI gotoxy() = Send <ESC>[x;yH
 1824  09F4           GOTOXY:
 1825  09F4 1209D2            lcall   ESCANSI
 1826  09F7 EA                mov     a,R2
 1827  09F8 1209DD            lcall   OUTBCD
 1828  09FB 743B              mov     a,#SEMICOL      ;';'
 1829  09FD 12024E            lcall   DDISA
 1830  0A00 E8                mov     a,R0
 1831  0A01 1209DD            lcall   OUTBCD
 1832  0A04 7448              mov     a,#48H          ;'H'
 1833  0A06 12024E            lcall   DDISA
 1834  0A09 22                ret
 1835                 
 1836                 ;-----  ANSI textattr() = Send <ESC>[xm
 1837  0A0A           TEXTATTR:
 1838  0A0A 1209D2            lcall   ESCANSI
 1839  0A0D E8                mov     a,R0
 1840  0A0E 1209DD            lcall   OUTBCD
 1841  0A11 746D              mov     a,#6DH          ;'m'
 1842  0A13 12024E            lcall   DDISA
 1843  0A16 22                ret
 1844                 
 1845                 ;-----  ANSI clrscr() = home cursor, reset text attr, Send <ESC>[0J
 1846  0A17           CLRSCR:
 1847  0A17 7A01              mov     R2,#1
 1848  0A19 7801              mov     R0,#1
 1849  0A1B 1209F4            lcall   GOTOXY
 1850  0A1E 7800              mov     R0,#0
 1851  0A20 120A0A            lcall   TEXTATTR
 1852  0A23 7801              mov     R0,#1
 1853  0A25 120A0A            lcall   TEXTATTR
 1854  0A28 1209D2            lcall   ESCANSI
 1855  0A2B 7430              mov     a,#30H          ;'0'
 1856  0A2D 12024E            lcall   DDISA
 1857  0A30 744A              mov     a,#4AH          ;'J'
 1858  0A32 12024E            lcall   DDISA
 1859  0A35 22                ret
 1860                 
 1861                 
 1862                 ;-----  Command: Z=ZAP
 1863  0A36           ZAP:
 1864  0A36 7B58              mov     r3,#'X'
 1865  0A38 120A17            lcall   CLRSCR
 1866  0A3B 758300            mov     DPH,#0
 1867  0A3E           ZAP0:
 1868  0A3E 758200            mov     DPL,#0
 1869  0A41 120AD4            lcall   VIEWPAGE
 1870  0A44 C082              push    DPL
 1871  0A46 C083              push    DPH
 1872  0A48 900D8B            mov     dptr,#MVMODE
 1873  0A4B 12027E            call    DTEXT
 1874  0A4E D083              pop     DPH
 1875  0A50 D082              pop     DPL
 1876  0A52 EB                mov     a,R3
 1877  0A53 12024E            call    DDISA
 1878  0A56 7A16              mov     R2,#16H
 1879  0A58 7801              mov     R0,#1
 1880  0A5A 1209F4            lcall   GOTOXY
 1881  0A5D           ZAP1:
 1882  0A5D 120236            lcall   WAITKI
 1883  0A60 B45803            cjne    a,#'X',CNOTX            ;'X'
 1884  0A63 FB        ZMODE:  mov     r3,a
 1885  0A64 80D8              sjmp    ZAP0
 1886                 
 1887  0A66           CNOTX:
 1888  0A66 B44402            cjne    a,#'D',CNOTD
 1889  0A69 80F8              sjmp    ZMODE
 1890                 
 1891  0A6B           CNOTD:
 1892  0A6B B44302            cjne    a,#'C',CNOTC
 1893  0A6E 80F3              sjmp    ZMODE
 1894                 
 1895  0A70           CNOTC:
 1896  0A70 B41B23            cjne    a,#ESC,CNOTESC
 1897  0A73 120236            lcall   WAITKI
 1898  0A76 B41B03            cjne    a,#ESC,CNOTESC2
 1899  0A79 0203CE            ljmp    INIT
 1900                 
 1901  0A7C           CNOTESC2:
 1902  0A7C B45BBF            cjne    a,#5BH,ZAP0
 1903  0A7F 120236            lcall   WAITKI
 1904  0A82 B44302            cjne    a,#43H,CNOTESC3
 1905  0A85 801D              sjmp    CNEXT1
 1906                 
 1907  0A87           CNOTESC3:
 1908  0A87 B44402            cjne    a,#44H,CNOTESC4
 1909  0A8A 801F              sjmp    CPREV1
 1910                 
 1911  0A8C           CNOTESC4:
 1912  0A8C B44202            cjne    a,#42H,CNOTESC5
 1913  0A8F 8021              sjmp    CNEXT16
 1914                 
 1915  0A91           CNOTESC5:
 1916  0A91 B441AA            cjne    a,#41H,ZAP0
 1917  0A94 8027              sjmp    CPREV16
 1918                 
 1919  0A96           CNOTESC:
 1920  0A96 B40103            cjne    a,#1,CNOTBREAK
 1921  0A99 0203CE            ljmp    INIT
 1922                 
 1923  0A9C           CNOTBREAK:
 1924  0A9C 7028              jnz     CNOTUS
 1925  0A9E 120236            lcall   WAITKI
 1926  0AA1 B45104            cjne    a,#51H,CNOTSEMICOL      ;';'
 1927  0AA4           CNEXT1:
 1928  0AA4 0583              inc     DPH
 1929  0AA6 8096              sjmp    ZAP0
 1930                 
 1931  0AA8           CNOTSEMICOL:
 1932  0AA8 B44904            cjne    a,#49H,CNOTMINUS        ;'-'
 1933  0AAB           CPREV1:
 1934  0AAB 1583              dec     DPH
 1935  0AAD 808F              sjmp    ZAP0
 1936                 
 1937  0AAF           CNOTMINUS:
 1938  0AAF B47608            cjne    a,#76H,CNOTPOINT        ;'.'
 1939  0AB2           CNEXT16:
 1940  0AB2 E583              mov     a,DPH
 1941  0AB4 2410              add     a,#10H
 1942  0AB6 F583              mov     DPH,a
 1943  0AB8 8084              sjmp    ZAP0
 1944                 
 1945  0ABA           CNOTPOINT:
 1946  0ABA B40481            cjne    a,#04H,ZAP0
 1947  0ABD           CPREV16:
 1948  0ABD E583              mov     a,DPH
 1949  0ABF 24F0              add     a,#0F0H
 1950  0AC1 F583              mov     DPH,a
 1951  0AC3 020A3E            jmp     ZAP0
 1952                 
 1953  0AC6           CNOTUS:
 1954  0AC6 B44D02            cjne    a,#4DH,CNOTM            ;'H'
 1955  0AC9 807B              sjmp    ZAPHEX
 1956                 
 1957  0ACB           CNOTM:
 1958  0ACB B44E03            cjne    a,#4EH,CNOTA            ;'a'
 1959  0ACE 020D30            ljmp    ZAPASC
 1960                 
 1961  0AD1           CNOTA:
 1962  0AD1 020A3E            jmp     ZAP0
 1963                 
 1964                 ;-----  ZAP: view 256-byte page
 1965  0AD4           VIEWPAGE:
 1966  0AD4 E4                clr     a
 1967  0AD5 FA                mov     R2,a
 1968  0AD6 F8                mov     R0,a
 1969  0AD7 1209F4            lcall   GOTOXY
 1970  0ADA           VLOOPL:
 1971  0ADA 7420              mov     a,#20H
 1972  0ADC 12024E            lcall   DDISA
 1973  0ADF 12024E            lcall   DDISA
 1974  0AE2 BB4408            cjne    r3,#'D',VLNOTD
 1975  0AE5 12024E            lcall   DDISA
 1976  0AE8 12024E            lcall   DDISA
 1977  0AEB 8005              sjmp    VLOOP1
 1978  0AED           VLNOTD:
 1979  0AED E583              mov     a,DPH
 1980  0AEF 1209DD            lcall   OUTHEX
 1981  0AF2           VLOOP1:
 1982  0AF2 E582              mov     a,DPL
 1983  0AF4 1209DD            lcall   OUTHEX
 1984  0AF7 7420              mov     a,#20H
 1985  0AF9 12024E            lcall   DDISA
 1986  0AFC 12024E            lcall   DDISA
 1987  0AFF 75F008            mov     B,#08H
 1988  0B02           VLOOPH:
 1989  0B02 120D6F            call    ZREAD
 1990  0B05 1209DD            lcall   OUTHEX
 1991  0B08 0582              inc     DPL
 1992  0B0A 120D6F            call    ZREAD
 1993  0B0D 1209DD            lcall   OUTHEX
 1994  0B10 0582              inc     DPL
 1995  0B12 7420              mov     a,#20H
 1996  0B14 12024E            lcall   DDISA
 1997  0B17 D5F0E8            djnz    B,VLOOPH
 1998  0B1A E582              mov     a,DPL
 1999  0B1C 24F0              add     a,#0F0H
 2000  0B1E F582              mov     DPL,a
 2001  0B20 75F010            mov     B,#10H
 2002  0B23           VLOOPA:
 2003  0B23 120D6F            call    ZREAD
 2004  0B26 0582              inc     DPL
 2005  0B28 B42000            cjne    a,#20H,VLOOPA0
 2006  0B2B           VLOOPA0:
 2007  0B2B 5004              jnc     VLOOPA2
 2008  0B2D           VLOOPA1:
 2009  0B2D 742E              mov     a,#POINT
 2010  0B2F 8005              sjmp    VLOOPA4
 2011                 
 2012  0B31           VLOOPA2:
 2013  0B31 B48000            cjne    a,#80H,VLOOPA3
 2014  0B34           VLOOPA3:
 2015  0B34 50F7              jnc     VLOOPA1
 2016  0B36           VLOOPA4:
 2017  0B36 12024E            lcall   DDISA
 2018  0B39 D5F0E7            djnz    B,VLOOPA
 2019  0B3C E582              mov     a,DPL
 2020  0B3E 6005              jz      VIEWHEXEND
 2021  0B40 12026F            lcall   DDISNL
 2022  0B43 8095              sjmp    VLOOPL
 2023                 
 2024  0B45           VIEWHEXEND:
 2025  0B45 22                ret
 2026                 
 2027                 ;-----  ZAP Hex editor
 2028  0B46           ZAPHEX:
 2029  0B46 C082              push    DPL
 2030  0B48 C083              push    DPH
 2031  0B4A 900D95            mov     dptr,#MEMODE
 2032  0B4D 12027E            call    DTEXT
 2033  0B50 D083              pop     DPH
 2034  0B52 D082              pop     DPL
 2035  0B54 EB                mov     a,R3
 2036  0B55 12024E            call    DDISA
 2037  0B58 7D01              mov     R5,#1
 2038  0B5A 7C09              mov     R4,#9
 2039  0B5C 7F01              mov     R7,#1
 2040  0B5E 7E49              mov     R6,#49H
 2041  0B60           ZAPHEXH:
 2042  0B60 7807              mov     R0,#7
 2043  0B62 120A0A            lcall   TEXTATTR
 2044  0B65 120D33            lcall   ZAPHEXHDIS
 2045  0B68 7A16              mov     R2,#16H
 2046  0B6A 7801              mov     R0,#1
 2047  0B6C 1209F4            lcall   GOTOXY
 2048  0B6F 120236            lcall   WAITKI
 2049  0B72 B41B03            cjne    a,#ESC,ZHNOTESC0
 2050  0B75 120236            lcall   WAITKI
 2051  0B78           ZHNOTESC0:
 2052  0B78 C0E0              push    ACC
 2053  0B7A 7800              mov     R0,#0
 2054  0B7C 120A0A            lcall   TEXTATTR
 2055  0B7F 7801              mov     R0,#1
 2056  0B81 120A0A            lcall   TEXTATTR
 2057  0B84 120D33            lcall   ZAPHEXHDIS
 2058  0B87 D0E0              pop     ACC
 2059  0B89 B41B03            cjne    a,#ESC,ZHNOTESC1
 2060  0B8C 020A3E            ljmp    ZAP0
 2061  0B8F           ZHNOTESC1:
 2062  0B8F B45B1B            cjne    a,#5BH,ZHNOTESC
 2063  0B92 120236            lcall   WAITKI
 2064  0B95 B44402            cjne    a,#44H,ZHNOTD
 2065  0B98 8051              sjmp    ZHLEFT
 2066  0B9A B44302    ZHNOTD: cjne    a,#43H,ZHNOTC
 2067  0B9D 8041              sjmp    ZHRIGHT
 2068  0B9F B44103    ZHNOTC: cjne    a,#41H,ZHNOTA
 2069  0BA2 020BB0            ljmp    ZHUP
 2070  0BA5 B44202    ZHNOTA: cjne    a,#42H,ZHNOTB
 2071  0BA8 801E              sjmp    ZHDOWN
 2072  0BAA           ZHNOTB: 
 2073  0BAA 020B60    ZHH1:   ljmp    ZAPHEXH
 2074  0BAD           ZHNOTESC:
 2075  0BAD B44815            cjne    a,#48H,ZHNOTUP          ;UP
 2076  0BB0           ZHUP:
 2077  0BB0 E582              mov     a,DPL
 2078  0BB2 24F0              add     a,#0F0H
 2079  0BB4 F582              mov     DPL,a
 2080  0BB6 ED                mov     a,R5
 2081  0BB7 2499              add     a,#99H
 2082  0BB9 D4                da      a
 2083  0BBA FD                mov     R5,a
 2084  0BBB FF                mov     R7,a
 2085  0BBC B400A1            cjne    a,#0,ZAPHEXH
 2086  0BBF 7416              mov     a,#16H
 2087  0BC1 FD                mov     R5,a
 2088  0BC2 FF                mov     R7,a
 2089  0BC3 809B              sjmp    ZAPHEXH
 2090  0BC5           ZHNOTUP:
 2091  0BC5 B45015            cjne    a,#50H,ZHNOTDOWN        ;DOWN
 2092  0BC8           ZHDOWN:
 2093  0BC8 E582              mov     a,DPL
 2094  0BCA 2410              add     a,#10H
 2095  0BCC F582              mov     DPL,a
 2096  0BCE ED                mov     a,R5
 2097  0BCF 2401              add     a,#01H
 2098  0BD1 D4                da      a
 2099  0BD2 FD                mov     R5,a
 2100  0BD3 FF                mov     R7,a
 2101  0BD4 B41789            cjne    a,#17H,ZAPHEXH
 2102  0BD7 7401              mov     a,#1
 2103  0BD9 FD                mov     R5,a
 2104  0BDA FF                mov     R7,a
 2105  0BDB           ZAPHEXH1:
 2106  0BDB 8083              sjmp    ZAPHEXH
 2107  0BDD           ZHNOTDOWN:
 2108  0BDD B44D08            cjne    a,#4DH,ZHNOTRIGHT       ;RIGHT
 2109  0BE0           ZHRIGHT:
 2110  0BE0 EC                mov     a,R4
 2111  0BE1 2401              add     a,#1
 2112  0BE3 D4                da      a
 2113  0BE4 FC                mov     R4,a
 2114  0BE5 020C46            ljmp    ZAPHEXL
 2115  0BE8           ZHNOTRIGHT:
 2116  0BE8 B44B27            cjne    a,#4BH,ZHNOTLEFT        ;LEFT
 2117  0BEB           ZHLEFT:
 2118  0BEB 1582              dec     DPL
 2119  0BED EC                mov     a,R4
 2120  0BEE 2499              add     a,#99H
 2121  0BF0 D4                da      a
 2122  0BF1 8582F0            mov     B,DPL
 2123  0BF4 30F003            jnb     B.0,ZHLEFT0
 2124  0BF7 2499              add     a,#99H
 2125  0BF9 D4                da      a
 2126  0BFA           ZHLEFT0:
 2127  0BFA FC                mov     R4,a
 2128  0BFB EE                mov     a,R6
 2129  0BFC 2499              add     a,#99H
 2130  0BFE D4                da      a
 2131  0BFF FE                mov     R6,a
 2132  0C00 B44843            cjne    a,#48H,ZAPHEXL
 2133  0C03 7447              mov     a,#47H
 2134  0C05 FC                mov     R4,a
 2135  0C06 7464              mov     a,#64H
 2136  0C08 FE                mov     R6,a
 2137  0C09 E582              mov     a,DPL
 2138  0C0B 2410              add     a,#10H
 2139  0C0D F582              mov     DPL,a
 2140  0C0F 020C99            ljmp    ZLUP
 2141  0C12           ZHNOTLEFT:
 2142  0C12 B40103            cjne    a,#BREAK,ZHNOTBREAK
 2143  0C15 020A3E            ljmp    ZAP0
 2144  0C18           ZHNOTBREAK:
 2145  0C18 B40D03            cjne    a,#ENTER,ZHNOTENTER
 2146  0C1B 020A3E            ljmp    ZAP0
 2147  0C1E           ZHNOTENTER:
 2148  0C1E C3                clr     C
 2149  0C1F 9430              subb    a,#30H
 2150  0C21 40B8              jc      ZAPHEXH1
 2151  0C23 940A              subb    a,#0AH
 2152  0C25 4004              jc      ZHHEX0
 2153  0C27 9407              subb    a,#07H
 2154  0C29 40B0              jc      ZAPHEXH1
 2155  0C2B           ZHHEX0:
 2156  0C2B C3                clr     C
 2157  0C2C 9406              subb    a,#06H
 2158  0C2E 30E7AA            jnb     ACC.7,ZAPHEXH1
 2159  0C31 2410              add     a,#10H
 2160  0C33 C4                swap    a
 2161  0C34 F5F0              mov     B,a
 2162  0C36 120D6F            call    ZREAD
 2163  0C39 540F              anl     a,#0FH
 2164  0C3B 45F0              orl     a,B
 2165  0C3D 120D7E            call    ZWRITE
 2166  0C40 120D33            lcall   ZAPHEXHDIS
 2167  0C43 020BE0            ljmp    ZHRIGHT
 2168                 
 2169  0C46           ZAPHEXL:
 2170  0C46 7807              mov     R0,#7
 2171  0C48 120A0A            lcall   TEXTATTR
 2172  0C4B 120D61            lcall   ZAPHEXLDIS
 2173  0C4E 7A16              mov     R2,#16H
 2174  0C50 7801              mov     R0,#1
 2175  0C52 1209F4            lcall   GOTOXY
 2176  0C55 120236            lcall   WAITKI
 2177  0C58 B41B03            cjne    a,#ESC,ZLNOTESC0
 2178  0C5B 120236            lcall   WAITKI
 2179  0C5E           ZLNOTESC0:
 2180  0C5E C0E0              push    ACC
 2181  0C60 7800              mov     R0,#0
 2182  0C62 120A0A            lcall   TEXTATTR
 2183  0C65 7801              mov     R0,#1
 2184  0C67 120A0A            lcall   TEXTATTR
 2185  0C6A 120D61            lcall   ZAPHEXLDIS
 2186  0C6D D0E0              pop     ACC
 2187  0C6F B41B03            cjne    a,#ESC,ZLNOTESC1
 2188  0C72 020A3E            ljmp    ZAP0
 2189  0C75           ZLNOTESC1:
 2190  0C75 B45B1E            cjne    a,#5BH,ZLNOTESC
 2191  0C78 120236            lcall   WAITKI
 2192  0C7B B44402            cjne    a,#44H,ZLNOTD
 2193  0C7E 8072              sjmp    ZLLEFT
 2194  0C80 B44302    ZLNOTD: cjne    a,#43H,ZLNOTC
 2195  0C83 8044              sjmp    ZLRIGHT
 2196  0C85 B44103    ZLNOTC: cjne    a,#41H,ZLNOTA
 2197  0C88 020C99            ljmp    ZLUP
 2198  0C8B B44202    ZLNOTA: cjne    a,#42H,ZLNOTB
 2199  0C8E 8021              sjmp    ZLDOWN
 2200  0C90           ZLNOTB: 
 2201  0C90 020C46    ZLH1:   ljmp    ZAPHEXL
 2202  0C93 020A3E            ljmp    ZAP0
 2203  0C96           ZLNOTESC:
 2204  0C96 B44815            cjne    a,#48H,ZLNOTUP
 2205  0C99           ZLUP:
 2206  0C99 E582              mov     a,DPL
 2207  0C9B 24F0              add     a,#0F0H
 2208  0C9D F582              mov     DPL,a
 2209  0C9F ED                mov     a,R5
 2210  0CA0 2499              add     a,#99H
 2211  0CA2 D4                da      a
 2212  0CA3 FD                mov     R5,a
 2213  0CA4 FF                mov     R7,a
 2214  0CA5 B4009E            cjne    a,#0,ZAPHEXL
 2215  0CA8 7416              mov     a,#16H
 2216  0CAA FF                mov     R7,a
 2217  0CAB FD                mov     R5,a
 2218  0CAC 8098              sjmp    ZAPHEXL
 2219  0CAE           ZLNOTUP:
 2220  0CAE B45015            cjne    a,#50H,ZLNOTDOWN
 2221  0CB1           ZLDOWN:
 2222  0CB1 E582              mov     a,DPL
 2223  0CB3 2410              add     a,#10H
 2224  0CB5 F582              mov     DPL,a
 2225  0CB7 ED                mov     a,R5
 2226  0CB8 2401              add     a,#1
 2227  0CBA D4                da      a
 2228  0CBB FD                mov     R5,a
 2229  0CBC FF                mov     R7,a
 2230  0CBD B41786            cjne    a,#17H,ZAPHEXL
 2231  0CC0 7401              mov     a,#1
 2232  0CC2 FF                mov     R7,a
 2233  0CC3 FD                mov     R5,a
 2234  0CC4           ZAPHEXL1:
 2235  0CC4 8080              sjmp    ZAPHEXL
 2236  0CC6           ZLNOTDOWN:
 2237  0CC6 B44D26            cjne    a,#4DH,ZLNOTRIGHT
 2238  0CC9           ZLRIGHT:
 2239  0CC9 0582              inc     DPL
 2240  0CCB EC                mov     a,R4
 2241  0CCC 2401              add     a,#1
 2242  0CCE 8582F0            mov     B,DPL
 2243  0CD1 20F002            jb      B.0,ZLRIGHT0
 2244  0CD4 2401              add     a,#1
 2245  0CD6           ZLRIGHT0:
 2246  0CD6 D4                da      a
 2247  0CD7 FC                mov     R4,a
 2248  0CD8 EE                mov     a,R6
 2249  0CD9 2401              add     a,#1
 2250  0CDB D4                da      a
 2251  0CDC FE                mov     R6,a
 2252  0CDD B46517            cjne    a,#65H,ZAPHEXH0
 2253  0CE0 E582              mov     a,DPL
 2254  0CE2 24F0              add     a,#0F0H
 2255  0CE4 F582              mov     DPL,a
 2256  0CE6 7449              mov     a,#49H
 2257  0CE8 FE                mov     R6,a
 2258  0CE9 7409              mov     a,#09H
 2259  0CEB FC                mov     R4,a
 2260  0CEC 020BC8            ljmp    ZHDOWN
 2261  0CEF           ZLNOTRIGHT:
 2262  0CEF B44B08            cjne    a,#4BH,ZLNOTLEFT
 2263  0CF2           ZLLEFT:
 2264  0CF2 EC                mov     a,R4
 2265  0CF3 2499              add     a,#99H
 2266  0CF5 D4                da      a
 2267  0CF6 FC                mov     R4,a
 2268  0CF7           ZAPHEXH0:
 2269  0CF7 020B60            ljmp    ZAPHEXH
 2270  0CFA           ZLNOTLEFT:
 2271  0CFA B40103            cjne    a,#BREAK,ZLNOTBREAK
 2272  0CFD 020A3E            ljmp    ZAP0
 2273  0D00           ZLNOTBREAK:
 2274  0D00 B40D03            cjne    a,#ENTER,ZLNOTENTER
 2275  0D03 020A3E            ljmp    ZAP0
 2276  0D06           ZLNOTENTER:
 2277  0D06 C3                clr     C
 2278  0D07 9430              subb    a,#30H
 2279  0D09 40B9              jc      ZAPHEXL1
 2280  0D0B 940A              subb    a,#0AH
 2281  0D0D 4004              jc      ZLHEX0
 2282  0D0F 9407              subb    a,#07H
 2283  0D11 40B1              jc      ZAPHEXL1
 2284  0D13           ZLHEX0:
 2285  0D13 C3                clr     C
 2286  0D14 9406              subb    a,#06H
 2287  0D16 20E703            jb      ACC.7,ZLHEX1
 2288  0D19 020CC4            ljmp    ZAPHEXL1
 2289  0D1C 2410      ZLHEX1: add     a,#10H
 2290  0D1E F5F0              mov     B,a
 2291  0D20 120D6F            call    ZREAD
 2292  0D23 54F0              anl     a,#0F0H
 2293  0D25 45F0              orl     a,B
 2294  0D27 120D7E            call    ZWRITE
 2295  0D2A 120D61            lcall   ZAPHEXLDIS
 2296  0D2D 020CC9            ljmp    ZLRIGHT
 2297                 
 2298                 ;-----  ZAP ASCII editor: not implemented
 2299  0D30           ZAPASC:
 2300  0D30 020A3E            ljmp    ZAP0
 2301                         
 2302  0D33           ZAPHEXHDIS:
 2303  0D33 850502            mov     2,5
 2304  0D36 850400            mov     0,4
 2305  0D39 1209F4            lcall   GOTOXY
 2306  0D3C 120D6F            call    ZREAD
 2307  0D3F C4                swap    a
 2308  0D40           ZHD0:
 2309  0D40 1209E5            lcall   OUTBCD2
 2310  0D43 850702            mov     2,7
 2311  0D46 850600            mov     0,6
 2312  0D49 1209F4            lcall   GOTOXY
 2313  0D4C 120D6F            call    ZREAD
 2314  0D4F B42000            cjne    a,#20H,ZHD1
 2315  0D52           ZHD1:
 2316  0D52 5004              jnc     ZHD3
 2317  0D54           ZHD2:
 2318  0D54 742E              mov     a,#POINT
 2319  0D56 8005              sjmp    ZHD5
 2320  0D58           ZHD3:
 2321  0D58 B48000            cjne    a,#80H,ZHD4
 2322  0D5B           ZHD4:
 2323  0D5B 50F7              jnc     ZHD2
 2324  0D5D           ZHD5:
 2325  0D5D 12024E            lcall   DDISA
 2326  0D60 22                ret
 2327                 
 2328  0D61           ZAPHEXLDIS:
 2329  0D61 850502            mov     2,5
 2330  0D64 850400            mov     0,4
 2331  0D67 1209F4            lcall   GOTOXY
 2332  0D6A 120D6F            call    ZREAD
 2333  0D6D 80D1              sjmp    ZHD0
 2334                 
 2335  0D6F BB4303    ZREAD:  cjne    R3,#'C',ZRNOTX
 2336  0D72 E4                clr     a
 2337  0D73 93                movc    a,@a+dptr
 2338  0D74 22                ret
 2339  0D75 BB4404    ZRNOTX: cjne    R3,#'D',ZRNOTD
 2340  0D78 A882              mov     r0,dpl
 2341  0D7A E6                mov     a,@r0
 2342  0D7B 22                ret
 2343  0D7C E0        ZRNOTD: movx    a,@dptr
 2344  0D7D 22                ret
 2345                 
 2346  0D7E BB4301    ZWRITE: cjne    R3,#'C',ZWNOTX
 2347  0D81 22                ret
 2348  0D82 BB4404    ZWNOTX: cjne    R3,#'D',ZWNOTD
 2349  0D85 A882              mov     r0,dpl
 2350  0D87 F6                mov     @r0,a
 2351  0D88 22                ret
 2352  0D89 F0        ZWNOTD: movx    @dptr,a
 2353  0D8A 22                ret
 2354                 
 2355  0D8B 0D0A5669  MVMODE: db      0Dh,0Ah,'View: "',0
       0D8F 65773A20
       0D93 2200
 2356                 
 2357  0D95 0D0A4564  MEMODE: db      0Dh,0Ah,'Edit: "',0
       0D99 69743A20
       0D9D 2200
 2358                 
 2359                 ;=====  DEBUG HELP
 2360  0D9F 900DA8    DBGHLP: mov     dptr,#HLPDBG
 2361  0DA2 12027E            lcall   DTEXT
 2362  0DA5 020487            ljmp    COMMAND2
 2363                 
 2364  0DA8 0D0A      HLPDBG: db      0DH,0AH
 2365  0DAA 3D3D2047          db      '== GMon51 Help =='
       0DAE 4D6F6E35
       0DB2 31204865
       0DB6 6C70203D
       0DBA 3D
 2366  0DBB 0D0A              db      0DH,0AH
 2367  0DBD 20204920          db      '  I            Instruction Step'
       0DC1 20202020
       0DC5 20202020
       0DC9 20202049
       0DCD 6E737472
       0DD1 75637469
       0DD5 6F6E2053
       0DD9 746570
 2368  0DDC 0D0A              db      0DH,0AH
 2369  0DDE 20204320          db      '  C            Call Step'
       0DE2 20202020
       0DE6 20202020
       0DEA 20202043
       0DEE 616C6C20
       0DF2 53746570
 2370  0DF6 0D0A              db      0DH,0AH
 2371  0DF8 20204720          db      '  G            Go'
       0DFC 20202020
       0E00 20202020
       0E04 20202047
       0E08 6F
 2372  0E09 0D0A              db      0DH,0AH
 2373  0E0B 20204420          db      '  D            Display Data Memory'
       0E0F 20202020
       0E13 20202020
       0E17 20202044
       0E1B 6973706C
       0E1F 61792044
       0E23 61746120
       0E27 4D656D6F
       0E2B 7279
 2374  0E2D 0D0A              db      0DH,0AH
 2375  0E2F 20205220          db      '  R            Display R0-R7'
       0E33 20202020
       0E37 20202020
       0E3B 20202044
       0E3F 6973706C
       0E43 61792052
       0E47 302D5237
 2376  0E4B 0D0A              db      0DH,0AH
 2377  0E4D 20205820          db      '  X            Display SFRs'
       0E51 20202020
       0E55 20202020
       0E59 20202044
       0E5D 6973706C
       0E61 61792053
       0E65 465273
 2378  0E68 0D0A              db      0DH,0AH
 2379  0E6A 20205449          db      '  TI           Instruction Trace'
       0E6E 20202020
       0E72 20202020
       0E76 20202049
       0E7A 6E737472
       0E7E 75637469
       0E82 6F6E2054
       0E86 72616365
 2380  0E8A 0D0A              db      0DH,0AH
 2381  0E8C 20205443          db      '  TC           Call Trace'
       0E90 20202020
       0E94 20202020
       0E98 20202043
       0E9C 616C6C20
       0EA0 54726163
       0EA4 65
 2382  0EA5 0D0A              db      0DH,0AH
 2383  0EA7 20205362          db      '  Sbeg,end     Disassemble'
       0EAB 65672C65
       0EAF 6E642020
       0EB3 20202044
       0EB7 69736173
       0EBB 73656D62
       0EBF 6C65
 2384  0EC1 0D0A              db      0DH,0AH
 2385  0EC3 20202F73          db      '  /sfr=n       Alter SFR value'
       0EC7 66723D6E
       0ECB 20202020
       0ECF 20202041
       0ED3 6C746572
       0ED7 20534652
       0EDB 2076616C
       0EDF 7565
 2386  0EE1 0D0A              db      0DH,0AH
 2387  0EE3 20204820          db      '  H            Load Hex File'
       0EE7 20202020
       0EEB 20202020
       0EEF 2020204C
       0EF3 6F616420
       0EF7 48657820
       0EFB 46696C65
 2388  0EFF 0D0A              db      0DH,0AH
 2389  0F01 20205620          db      '  V            Verify Memory'
       0F05 20202020
       0F09 20202020
       0F0D 20202056
       0F11 65726966
       0F15 79204D65
       0F19 6D6F7279
 2390  0F1D 0D0A              db      0DH,0AH
 2391  0F1F 20205A20          db      '  Z            Zap Memory'
       0F23 20202020
       0F27 20202020
       0F2B 2020205A
       0F2F 6170204D
       0F33 656D6F72
       0F37 79
 2392  0F38 22                db      22H
 2393                 
 2394  0F39 0D0A5265  MREADY: db      0Dh,0Ah,'Ready',0Dh,0Ah,22h,0
       0F3D 6164790D
       0F41 0A2200
 2395                 
 2396                 
 2397                 ;----- Input hexadecimal digits from RI
 2398                 ;       return  a == binary value
 2399                 ;               C == ctrl-c pressed
 2400                 
 2401  0F44                   public  inhexacc
 2402  0F44           inhexacc:
 2403  0F44 7902              mov     r1,#2
 2404  0F46 E4                clr     a
 2405  0F47           inhexacc0:
 2406  0F47 540F              anl     a,#0Fh
 2407  0F49 F8                mov     r0,a
 2408  0F4A 120236            call    WAITKI
 2409  0F4D B40303            cjne    a,#03h,inhexacc00
 2410  0F50 D3                setb    c
 2411  0F51 801F              sjmp    inhexacc_end
 2412  0F53           inhexacc00:
 2413  0F53 12024E            call    DDISA
 2414  0F56 C3                clr     c
 2415  0F57 9430              subb    a,#'0'
 2416  0F59 4016              jc      inhexacc2
 2417  0F5B 940A              subb    a,#10
 2418  0F5D 400A              jc      inhexacc1
 2419  0F5F 9407              subb    a,#7
 2420  0F61 400E              jc      inhexacc2
 2421  0F63 9406              subb    a,#6
 2422  0F65 500A              jnc     inhexacc2
 2423  0F67 2406              add     a,#6
 2424  0F69           inhexacc1:
 2425  0F69 240A              add     a,#10
 2426  0F6B C4                swap    a
 2427  0F6C 48                orl     a,r0
 2428  0F6D C4                swap    a
 2429  0F6E F8                mov     r0,a
 2430  0F6F D9D6              djnz    r1,inhexacc0
 2431  0F71           inhexacc2:
 2432  0F71 C3                clr     c
 2433  0F72           inhexacc_end:
 2434  0F72 E8                mov     a,r0
 2435  0F73 22                ret
 2436                 
 2437                 
 2438                 
 2439                 ;----- Receive Hex-Intel file
 2440  0F74           recvhex:
 2441  0F74 120236            call    WAITKI                  ;wait ':'
 2442  0F77 B40303            cjne    a,#03h,recvhex0
 2443  0F7A D3                setb    c
 2444  0F7B 8058              sjmp    recvhex_end
 2445  0F7D           recvhex0:
 2446  0F7D B43AF4            cjne    a,#':',recvhex
 2447  0F80 12024E            call    DDISA
 2448  0F83 120F44            call    inhexacc                ;get block length
 2449  0F86 404D              jc      recvhex_end
 2450  0F88 F5F0              mov     b,a
 2451  0F8A FF                mov     r7,a
 2452  0F8B 120F44            call    inhexacc                ;get address high byte
 2453  0F8E 4045              jc      recvhex_end
 2454  0F90 F583              mov     dph,a
 2455  0F92 2F                add     a,r7
 2456  0F93 FF                mov     r7,a
 2457  0F94 120F44            call    inhexacc                ;get address low byte
 2458  0F97 403C              jc      recvhex_end
 2459  0F99 F582              mov     dpl,a
 2460  0F9B 2F                add     a,r7
 2461  0F9C FF                mov     r7,a
 2462  0F9D 120F44            call    inhexacc                ;get block type
 2463  0FA0 4033              jc      recvhex_end
 2464  0FA2 FE                mov     r6,a
 2465  0FA3 2F                add     a,r7
 2466  0FA4 FF                mov     r7,a
 2467  0FA5 E5F0              mov     a,b
 2468  0FA7 600A              jz      recvhex3
 2469  0FA9           recvhex2:
 2470  0FA9 120F44            call    inhexacc                ;get data byte
 2471  0FAC F0                movx    @dptr,a
 2472  0FAD A3                inc     dptr
 2473  0FAE 2F                add     a,r7
 2474  0FAF FF                mov     r7,a
 2475  0FB0 D5F0F6            djnz    b,recvhex2
 2476  0FB3           recvhex3:
 2477  0FB3 120F44            call    inhexacc                ;get checksum
 2478  0FB6 2F                add     a,r7
 2479  0FB7 7015              jnz     recvhex5
 2480  0FB9           recvhex4:
 2481  0FB9 120236            call    WAITKI                   ;wait CR
 2482  0FBC 12024E            call    DDISA
 2483  0FBF B40DF7            cjne    a,#0Dh,recvhex4
 2484  0FC2 740A              mov     a,#0Ah
 2485  0FC4 12024E            call    DDISA
 2486  0FC7 EE                mov     a,r6
 2487  0FC8 B401A9            cjne    a,#01h,recvhex
 2488  0FCB C3                clr     c
 2489  0FCC 8007              sjmp    recvhex_end
 2490  0FCE           recvhex5:
 2491  0FCE 900FD8            mov     dptr,#MCKERR
 2492  0FD1 12027E            call    DTEXT
 2493                 
 2494  0FD4 D3                setb    c
 2495  0FD5           recvhex_end:
 2496  0FD5 E4                clr     a
 2497  0FD6 33                rlc     a
 2498  0FD7 22                ret
 2499                 
 2500  0FD8 0D0A4368  MCKERR: db      0Dh,0Ah,'Checksum error',0Dh,0Ah,22h,0
       0FDC 65636B73
       0FE0 756D2065
       0FE4 72726F72
       0FE8 0D0A2200
 2501                 
 2502                 ;=====  DISASSEMBLER  =====
 2503                 
 2504  0FEC 851883    FETCH:  mov     DPH,18H
 2505  0FEF 851982            mov     DPL,19H
 2506  0FF2 E4                clr     a
 2507  0FF3 93                movc    a,@A+dptr
 2508  0FF4 A3                inc     dptr
 2509  0FF5 858318            mov     18H,DPH
 2510  0FF8 858219            mov     19H,DPL
 2511  0FFB 22                ret
 2512                 
 2513                 ;-----  DASM Main loop
 2514  0FFC           DASMLP:
 2515  0FFC C3                clr     C
 2516  0FFD E51B              mov     a,1BH
 2517  0FFF 9519              subb    a,19H
 2518  1001 E51A              mov     a,1AH
 2519  1003 9518              subb    a,18H
 2520  1005 5001              jnc     DASM0
 2521  1007 22                ret
 2522  1008           DASM0:
 2523  1008 12021D            lcall   DHITKI          ;pause or abort?
 2524  100B           DASM1:
 2525  100B 851883            mov     DPH,18H
 2526  100E 851982            mov     DPL,19H
 2527  1011 7800              mov     R0,#0
 2528  1013 C236              clr     36H
 2529  1015 120297            lcall   DHEXDP          ;disp ptr
 2530  1018 7406              mov     a,#6
 2531  101A 120266            lcall   DTABS           ;tab 6
 2532  101D 120FEC            lcall   FETCH
 2533  1020 FF                mov     R7,a            ;R7=opcode
 2534  1021 9013FD            mov     dptr,#TOPCOD
 2535  1024 C3                clr     C
 2536  1025 33                RLC     a
 2537  1026 5002              jnc     DASM2
 2538  1028 0583              inc     DPH
 2539  102A FE        DASM2:  mov     R6,a
 2540  102B 93                movc    a,@A+dptr
 2541  102C CE                xch     a,R6            ;R6=mnemo
 2542  102D 04                inc     a
 2543  102E 93                movc    a,@A+dptr
 2544  102F FD                mov     R5,a            ;R5=operands
 2545                 ;       sjmp    DASMSK          ;skip hex display
 2546  1030 7800              mov     R0,#0
 2547  1032 EF                mov     a,R7
 2548  1033 1202B0            lcall   DHEXB           ;disp opcode byte
 2549  1036 C018              push    18H
 2550  1038 C019              push    19H
 2551  103A ED                mov     a,R5
 2552  103B C4                swap    a
 2553  103C 540F              anl     a,#0FH
 2554  103E 121132            lcall   DHEXOP          ;disp operand 1 byte
 2555  1041 ED                mov     a,R5
 2556  1042 540F              anl     a,#0FH          ;2nd operand?
 2557  1044 600B              jz      DASM21
 2558  1046 121132            lcall   DHEXOP          ;disp operand 2 byte
 2559  1049 EE                mov     a,R6
 2560  104A 640A              xrl     a,#NCJNE        ;cjne?
 2561  104C 7003              jnz     DASM21
 2562  104E 12117A            lcall   DHEXOP1         ;if yes disp operand 3 byte
 2563  1051 D019      DASM21: pop     19H
 2564  1053 D018              pop     18H             ;restore ptr
 2565  1055 740A      DASMSK: mov     a,#10
 2566  1057 120266            lcall   DTABS 
 2567  105A D236              setb    36H             ;Disassembler mode for hex disp
 2568  105C EE                mov     a,R6
 2569  105D 901368            mov     dptr,#TMNEMO
 2570  1060 1210C8            lcall   DKYWRD
 2571  1063 7406              mov     a,#6
 2572  1065 120266            lcall   DTABS
 2573  1068 7408              mov     a,#NMOVM        ;MOVM ?
 2574  106A 6E                xrl     a,R6
 2575  106B 7014              jnz     DASM22
 2576  106D 120FEC            lcall   FETCH           ;if yes swap operands
 2577  1070 C0E0              push    ACC
 2578  1072 121208            lcall   DOPDATAADDR
 2579  1075 742C              mov     a,#2CH
 2580  1077 12024E            lcall   DDISA
 2581  107A D0E0              pop     ACC
 2582  107C 121101            lcall   DADDR
 2583  107F 8041              sjmp    DASM3
 2584  1081 7426      DASM22: mov     a,#NMUL         ;MUL or DIV ?
 2585  1083 6E                xrl     a,R6
 2586  1084 6005              jz      DASM23
 2587  1086 7425              mov     a,#NDIV
 2588  1088 6E                xrl     a,R6
 2589  1089 7008              jnz     DASM24
 2590  108B 9011D0    DASM23: mov     dptr,#MAB       ;if yes disp 'AB'
 2591  108E 12027E            lcall   DTEXT
 2592  1091 802F              sjmp    DASM3   
 2593  1093 7427      DASM24: mov     a,#NDB          ;db 0A5H
 2594  1095 6E                xrl     a,R6
 2595  1096 7007              jnz     DASM25
 2596  1098 EF                mov     a,R7
 2597  1099 1202AC            lcall   DHEXA           ;disp opcode
 2598  109C 120262            lcall   DDISH
 2599  109F ED        DASM25: mov     a,R5
 2600  10A0 C4                swap    a
 2601  10A1 540F              anl     a,#0FH
 2602  10A3 121181            lcall   DOPRND          ;disp 1st operand
 2603  10A6 ED                mov     a,R5
 2604  10A7 540F              anl     a,#0FH          ;2nd operand?
 2605  10A9 6017              jz      DASM3
 2606  10AB FC                mov     R4,a
 2607  10AC 742C              mov     a,#2CH
 2608  10AE 12024E            lcall   DDISA
 2609  10B1 EC                mov     a,R4
 2610  10B2 121181            lcall   DOPRND          ;disp 2nd operand
 2611  10B5 EE                mov     a,R6
 2612  10B6 640A              xrl     a,#NCJNE        ;cjne?
 2613  10B8 7008              jnz     DASM3
 2614  10BA 742C              mov     a,#2CH
 2615  10BC 12024E            lcall   DDISA
 2616  10BF 12126D            lcall   DOPSADDR        ;if yes disp 3rd operand
 2617                 
 2618  10C2 12026F    DASM3:  lcall   DDISNL
 2619  10C5 020FFC            ljmp    DASMLP
 2620                 
 2621                 ;-----  Display keyword @A from table @DPTR
 2622                 ;       UC chars are keyword 1st chars
 2623                 ;       chars < 20H count undefined keywords
 2624                 ;       LC or digits are keyword next chars
 2625  10C8 F5F0      DKYWRD: mov     B,a
 2626  10CA E4        DKYWR0: clr     a               ;check this keyword
 2627  10CB 93                movc    a,@A+dptr
 2628  10CC 30E627            jnb     ACC.6,DKYWR5    ;jump if not UC letter (<20H)
 2629  10CF E5F0              mov     a,B             ;
 2630  10D1 7019              jnz     DKYWR3          ;jump if not good keyword
 2631  10D3 E4                clr     a
 2632  10D4 93                movc    a,@A+dptr       ;UC letter => display
 2633  10D5 12024E            lcall   DDISA
 2634  10D8 08                inc     R0              ;count displayed chars
 2635  10D9 A3                inc     dptr
 2636  10DA E4        DKYWR1: clr     a               ;loop
 2637  10DB 93                movc    a,@A+dptr
 2638  10DC A3                inc     dptr
 2639  10DD C3                clr     C
 2640  10DE 30E51F            jnb     ACC.5,DKYWRX    ;Done if UC or <20H
 2641  10E1 30E602            jnb     ACC.6,DKYWR2    ;jump if not LC (digits)
 2642  10E4 24E0              add     a,#0E0H         ;LC->UC
 2643  10E6 12024E    DKYWR2: lcall   DDISA
 2644  10E9 08                inc     R0              ;count displayed chars
 2645  10EA 80EE              sjmp    DKYWR1
 2646                 
 2647  10EC A3        DKYWR3: inc     dptr            ;seek next keyword
 2648  10ED E4                clr     a
 2649  10EE 93                movc    a,@A+dptr
 2650  10EF 20E5FA            jb      ACC.5,DKYWR3    ;loop while not UC and not <20H
 2651  10F2 15F0              dec     B
 2652  10F4 80D4              sjmp    DKYWR0          ;check keyword
 2653                         
 2654  10F6 A3        DKYWR5: inc     dptr            ;skip a undefined keywords
 2655  10F7 C5F0              xch     a,B
 2656  10F9 C3                clr     C
 2657  10FA 95F0              subb    a,B
 2658  10FC F5F0              mov     B,a
 2659  10FE 50CA              jnc     DKYWR0          ;check if not last keyword
 2660                 
 2661  1100 22        DKYWRX: ret
 2662                 
 2663                 ;-----  Display DATA address or SFR name
 2664  1101 901284    DADDR:  mov     dptr,#TSFRS
 2665  1104 FC                mov     R4,a
 2666  1105 1210C8            lcall   DKYWRD
 2667  1108 50F6              jnc     DKYWRX
 2668  110A EC        DADDR0: mov     a,R4
 2669  110B 1202AC            lcall   DHEXA
 2670  110E 020262            ljmp    DDISH
 2671                 
 2672                 ;-----  Display BIT address or BIT name
 2673                 ;       1: as bit name if defined
 2674                 ;       2: as SFR.n if SFR name defined
 2675                 ;       3: as bit addr otherwise
 2676  1111 9012E8    DBITAD: mov     dptr,#TBITS     
 2677  1114 FC                mov     R4,a
 2678  1115 1210C8            lcall   DKYWRD          ;find and disp BIT name
 2679  1118 50E6              jnc     DKYWRX          ;exit if BIT name found
 2680  111A EC                mov     a,R4
 2681  111B 54F8              anl     a,#0F8H
 2682  111D 901284            mov     dptr,#TSFRS     ;find and disp SFR name
 2683  1120 1210C8            lcall   DKYWRD
 2684  1123 40E5              jc      DADDR0          ;disp bit addr if SFR name not found
 2685  1125 742E              mov     a,#2EH          ;disp '.'
 2686  1127 12024E            lcall   DDISA
 2687  112A EC                mov     a,R4
 2688  112B 5407              anl     a,#7
 2689  112D 4430              orl     a,#30H
 2690  112F 02024E            ljmp    DDISA           ;disp bit number
 2691                 
 2692                 ;-----  Display operand
 2693  1132 90113A    DHEXOP: mov     dptr,#THOVEC
 2694  1135 75F003            mov     B,#3
 2695  1138 A4                mul     AB
 2696  1139 73                jmp     @A+dptr
 2697  113A 021180    THOVEC: ljmp    DHEXOP0         ;0
 2698  113D 021180            ljmp    DHEXOP0         ;1
 2699  1140 021180            ljmp    DHEXOP0         ;2
 2700  1143 021180            ljmp    DHEXOP0         ;3
 2701  1146 02117A            ljmp    DHEXOP1         ;4
 2702  1149 02117A            ljmp    DHEXOP1         ;5
 2703  114C 02117A            ljmp    DHEXOP1         ;6
 2704  114F 021180            ljmp    DHEXOP0         ;7
 2705  1152 021180            ljmp    DHEXOP0         ;8
 2706  1155 021180            ljmp    DHEXOP0         ;9
 2707  1158 021180            ljmp    DHEXOP0         ;A
 2708  115B 02117A            ljmp    DHEXOP1         ;B
 2709  115E 021180            ljmp    DHEXOP0         ;C
 2710  1161 021174            ljmp    DHEXOP2         ;D
 2711  1164 02116A            ljmp    DHEXOP3         ;E
 2712  1167 02117A            ljmp    DHEXOP1         ;F
 2713                 
 2714  116A 740F      DHEXOP3:mov     a,#NACALL
 2715  116C 6E                xrl     a,R6
 2716  116D 600B              jz      DHEXOP1
 2717  116F 740E              mov     a,#NAJMP
 2718  1171 6E                xrl     a,R6
 2719  1172 6006              jz      DHEXOP1
 2720  1174 120FEC    DHEXOP2:lcall   FETCH
 2721  1177 1202B0            lcall   DHEXB
 2722  117A 120FEC    DHEXOP1:lcall   FETCH
 2723  117D 1202B0            lcall   DHEXB
 2724  1180 22        DHEXOP0:ret
 2725                 
 2726                 ;-----  Display operand
 2727  1181 901189    DOPRND: mov     dptr,#TOPVEC
 2728  1184 75F003            mov     B,#3
 2729  1187 A4                mul     AB
 2730  1188 73                jmp     @A+dptr
 2731  1189 0211D3    TOPVEC: ljmp    DOPNONE         ;0 no oprnd
 2732  118C 0211D4            ljmp    DOPA            ;1 A
 2733  118F 0211D9            ljmp    DOPATRX         ;2 @Rx
 2734  1192 0211E7            ljmp    DOPRX           ;3 Rx
 2735  1195 0211F4            ljmp    DOPBITADDR      ;4 bit
 2736  1198 0211FA            ljmp    DOPDATA         ;5 #byte
 2737  119B 021208            ljmp    DOPDATAADDR     ;6 data
 2738  119E 02120E            ljmp    DOPC            ;7 C
 2739  11A1 021213            ljmp    DOPATADPTR      ;8 @A+DPTR
 2740  11A4 021219            ljmp    DOPATAPC        ;9 @A+PC
 2741  11A7 02121F            ljmp    DOPDPTR         ;A DPTR
 2742  11AA 021225            ljmp    DOPNOTBITADDR   ;B /bit
 2743  11AD 021230            ljmp    DOPATDPTR       ;C @DPTR
 2744  11B0 021236            ljmp    DOPDATAW        ;D #word
 2745  11B3 02124D            ljmp    DOPADDR         ;E addr (Aop/Lop)
 2746  11B6 02126D            ljmp    DOPSADDR        ;F addr (Sop)
 2747                 
 2748  11B9 40        MATDP:  db      '@'
 2749  11BA 44505452  MDPTR:  db      'DPTR"'
       11BE 22
 2750  11BF 405222    MATRX:  db      '@R"'
 2751  11C2 40412B44  MATADP: db      '@A+DPTR"'
       11C6 50545222
 2752  11CA 40412B50  MATAPC: db      '@A+PC"'
       11CE 4322
 2753  11D0 414222    MAB:    db      'AB"'
 2754                 
 2755                 ;-----  No operand
 2756  11D3           DOPNONE:
 2757  11D3 22                ret
 2758                 
 2759                 ;-----  Operand A
 2760  11D4           DOPA:
 2761  11D4 7441              mov     a,#41H          ;'A'
 2762  11D6 02024E            ljmp    DDISA
 2763                 
 2764                 ;-----  Operand @Rx
 2765  11D9           DOPATRX:
 2766  11D9 9011BF            mov     dptr,#MATRX
 2767  11DC 12027E            lcall   DTEXT
 2768  11DF EF                mov     a,R7            ;opcode
 2769  11E0 5401              anl     a,#1
 2770  11E2 4430              orl     a,#30H          ;'0'
 2771  11E4 02024E            ljmp    DDISA
 2772                 
 2773                 ;-----  Operand Rx
 2774  11E7           DOPRX:
 2775  11E7 7452              mov     a,#52H          ;'R'
 2776  11E9 12024E            lcall   DDISA
 2777  11EC EF                mov     a,R7            ;opcode
 2778  11ED 5407              anl     a,#7
 2779  11EF 4430              orl     a,#30H          ;'0'
 2780  11F1 02024E            ljmp    DDISA
 2781                 
 2782                 ;-----  Operand bit
 2783  11F4           DOPBITADDR:
 2784  11F4 120FEC            lcall   FETCH
 2785  11F7 021111            ljmp    DBITAD
 2786                 
 2787                 ;-----  Operand #byte
 2788  11FA           DOPDATA:
 2789  11FA 7423              mov     a,#23H          ;'#'
 2790  11FC 12024E            lcall   DDISA
 2791  11FF 120FEC            lcall   FETCH
 2792  1202 1202AC            lcall   DHEXA
 2793  1205 020262            ljmp    DDISH
 2794                 
 2795                 ;-----  Operand data
 2796  1208           DOPDATAADDR:
 2797  1208 120FEC            lcall   FETCH
 2798  120B 021101            ljmp    DADDR
 2799                         
 2800                 ;-----  Operand C
 2801  120E 7443      DOPC:   mov     a,#43H          ;'C'
 2802  1210 02024E            ljmp    DDISA
 2803                 
 2804                 ;-----  Operand @A+DPTR
 2805  1213           DOPATADPTR:
 2806  1213 9011C2            mov     dptr,#MATADP
 2807  1216 02027E            ljmp    DTEXT
 2808                 
 2809                 ;-----  Operand @A+PC
 2810  1219           DOPATAPC:
 2811  1219 9011CA            mov     dptr,#MATAPC
 2812  121C 02027E            ljmp    DTEXT
 2813                         
 2814                 ;-----  Operand dptr
 2815  121F           DOPDPTR:
 2816  121F 9011BA            mov     dptr,#MDPTR
 2817  1222 02027E            ljmp    DTEXT
 2818                 
 2819                 ;-----  Operand /bit
 2820  1225           DOPNOTBITADDR:
 2821  1225 742F              mov     a,#2FH          ;'/'
 2822  1227 12024E            lcall   DDISA
 2823  122A 120FEC            lcall   FETCH
 2824  122D 021111            ljmp    DBITAD
 2825                         
 2826                 ;-----  Operand @DPTR
 2827  1230           DOPATDPTR:
 2828  1230 9011B9            mov     dptr,#MATDP
 2829  1233 02027E            ljmp    DTEXT
 2830                 
 2831                 ;-----  Operand #word
 2832  1236           DOPDATAW:
 2833  1236 7423              mov     a,#23H          ;'#'
 2834  1238 12024E            lcall   DDISA
 2835  123B 120FEC    DOPAD0: lcall   FETCH
 2836  123E C0E0              push    ACC
 2837  1240 120FEC            lcall   FETCH
 2838  1243 F582              mov     DPL,a
 2839  1245 D083              pop     DPH
 2840  1247 120297            lcall   DHEXDP
 2841  124A 020262            ljmp    DDISH
 2842                 
 2843                 ;-----  Operand addr (A/L+CALL/JMP)
 2844  124D           DOPADDR:
 2845  124D 7411              mov     a,#NLCALL
 2846  124F 6E                xrl     a,R6
 2847  1250 60E9              jz      DOPAD0
 2848  1252 7410              mov     a,#NLJMP
 2849  1254 6E                xrl     a,R6
 2850  1255 60E4              jz      DOPAD0
 2851  1257 120FEC            lcall   FETCH
 2852  125A F582              mov     DPL,a
 2853  125C 5383F8            anl     DPH,#0F8H
 2854  125F EF                mov     a,R7
 2855  1260 54E0              anl     a,#0E0H
 2856  1262 23                rl      a
 2857  1263 23                rl      a
 2858  1264 23                rl      a
 2859  1265 4283              orl     DPH,a
 2860  1267 120297            lcall   DHEXDP
 2861  126A 020262            ljmp    DDISH
 2862                         
 2863                 ;-----  Operand addr (sjmp)
 2864  126D           DOPSADDR:
 2865  126D 120FEC            lcall   FETCH
 2866  1270 30E702            jnb     ACC.7,DOPSA1    ;dec dph if offset < 0
 2867  1273 1583              dec     DPH
 2868  1275 2582      DOPSA1: add     a,DPL
 2869  1277 F582              mov     DPL,a
 2870  1279 E4                clr     a
 2871  127A 3583              addc    a,DPH
 2872  127C F583              mov     DPH,a
 2873  127E 120297            lcall   DHEXDP
 2874  1281 020262            ljmp    DDISH
 2875                 
 2876                 
 2877                 ;=====  KEYWORDS TABLES  =====
 2878                 
 2879                 ;-----  SFR names
 2880  1284           TSFRS:
 2881  1284 1F1F1F1F          db      1FH,1FH,1FH,1FH,4H
       1288 04
 2882  1289 50305370          db      'P0SpDplDph'
       128D 44706C44
       1291 7068
 2883  1293 03                db      3
 2884  1294 50636F6E          db      'Pcon'
 2885  1298 54636F6E          db      'TconTmodTl0Tl1Th0Th1'
       129C 546D6F64
       12A0 546C3054
       12A4 6C315468
       12A8 30546831
 2886  12AC 02                db      2
 2887  12AD 5031              db      'P1'
 2888  12AF 07                db      7
 2889  12B0 53636F6E          db      'SconSbuf'
       12B4 53627566
 2890  12B8 06                db      6
 2891  12B9 5032              db      'P2'
 2892  12BB 07                db      7
 2893  12BC 4965              db      'Ie'
 2894  12BE 07                db      7
 2895  12BF 5033              db      'P3'
 2896  12C1 07                db      7
 2897  12C2 4970              db      'Ip'
 2898  12C4 0F                db      15
 2899  12C5 5432636F          db      'T2con'
       12C9 6E
 2900  12CA 01                db      1
 2901  12CB 52636170          db      'Rcap2lRcap2hTl2Th2'
       12CF 326C5263
       12D3 61703268
       12D7 546C3254
       12DB 6832
 2902  12DD 02                db      2
 2903  12DE 507377            db      'Psw'
 2904  12E1 0F                db      15
 2905  12E2 416363            db      'Acc'
 2906  12E5 0F                db      15
 2907  12E6 42                db      'B'
 2908  12E7 0F                db      15
 2909                 
 2910                 ;-----  BIT names
 2911  12E8           TBITS:
 2912  12E8 1F1F1F1F          db      1FH,1FH,1FH,1FH,4H
       12EC 04
 2913  12ED 08                db      8
 2914  12EE 49743049          db      'It0Ie0It1Ie1Tr0Tf0Tr1Tf1'
       12F2 65304974
       12F6 31496531
       12FA 54723054
       12FE 66305472
       1302 31546631
 2915  1306 08                db      8
 2916  1307 52695469          db      'RiTiRb8Tb8RenSm2Sm1Sm0'
       130B 52623854
       130F 62385265
       1313 6E536D32
       1317 536D3153
       131B 6D30
 2917  131D 08                db      8
 2918  131E 45783045          db      'Ex0Et0Ex1Et1Es'
       1322 74304578
       1326 31457431
       132A 4573
 2919  132C 02                db              2
 2920  132D 4561              db              'Ea'
 2921  132F 52786454          db      'RxdTxdInt0Int1T0T1WrRd'
       1333 7864496E
       1337 7430496E
       133B 74315430
       133F 54315772
       1343 5264
 2922  1345 50783050          db      'Px0Pt0Px1Pt1Ps'
       1349 74305078
       134D 31507431
       1351 5073
 2923  1353 03                db              3
 2924  1354 10                db      16
 2925  1355 50                db      'P'
 2926  1356 01                db              1
 2927  1357 4F765273          db              'OvRs0Rs1F0AcCy'
       135B 30527331
       135F 46304163
       1363 4379
 2928  1365 101008            db      16,16,8
 2929                 
 2930                 
 2931                 ;-----  Mnemonics names
 2932  1368           TMNEMO:
 2933  1368 496E6344          db      'IncDecAddAddcOrlAnlXrlMovMovSubbCjneXchDjnz'
       136C 65634164
       1370 64416464
       1374 634F726C
       1378 416E6C58
       137C 726C4D6F
       1380 764D6F76
       1384 53756262
       1388 436A6E65
       138C 58636844
       1390 6A6E7A
 2934  0000           NINC    equ     0
 2935  0001           NDEC    equ     1
 2936  0002           NADD    equ     2
 2937  0003           NADDC   equ     3
 2938  0004           NORL    equ     4
 2939  0005           NANL    equ     5
 2940  0006           NXRL    equ     6
 2941  0007           NMOV    equ     7
 2942  0008           NMOVM   equ     8
 2943  0009           NSUBB   equ     9
 2944  000A           NCJNE   equ     10
 2945  000B           NXCH    equ     11
 2946  000C           NDJNZ   equ     12
 2947  1393 4E6F7041          db      'NopAjmpAcallLjmpLcallJbcJbJnbJcJncJzJnzSjmp'
       1397 6A6D7041
       139B 63616C6C
       139F 4C6A6D70
       13A3 4C63616C
       13A7 6C4A6263
       13AB 4A624A6E
       13AF 624A634A
       13B3 6E634A7A
       13B7 4A6E7A53
       13BB 6A6D70
 2948  000D           NNOP    equ     13
 2949  000E           NAJMP   equ     14
 2950  000F           NACALL  equ     15
 2951  0010           NLJMP   equ     16
 2952  0011           NLCALL  equ     17
 2953  0012           NJBC    equ     18
 2954  0013           NJB     equ     19
 2955  0014           NJNB    equ     20
 2956  0015           NJC     equ     21
 2957  0016           NJNC    equ     22
 2958  0017           NJZ     equ     23
 2959  0018           NJNZ    equ     24
 2960  0019           NSJMP   equ     25
 2961  13BE 52725272          db      'RrRrcRlRlcMovcCplClrSetbMovxRetRetiDivMulDb'
       13C2 63526C52
       13C6 6C634D6F
       13CA 76634370
       13CE 6C436C72
       13D2 53657462
       13D6 4D6F7678
       13DA 52657452
       13DE 65746944
       13E2 69764D75
       13E6 6C4462
 2962  001A           NRR     equ     26
 2963  001B           NRRC    equ     27
 2964  001C           NRL     equ     28
 2965  001D           NRLC    equ     29
 2966  001E           NMOVC   equ     30
 2967  001F           NCPL    equ     31
 2968  0020           NCLR    equ     32
 2969  0021           NSETB   equ     33
 2970  0022           NMOVX   equ     34
 2971  0023           NRET    equ     35
 2972  0024           NRETI   equ     36
 2973  0025           NDIV    equ     37
 2974  0026           NMUL    equ     38
 2975  0027           NDB     equ     39
 2976  13E9 50757368          db      'PushSwapPopDaXchdJmp'
       13ED 53776170
       13F1 506F7044
       13F5 61586368
       13F9 644A6D70
 2977  0028           NPUSH   equ     40
 2978  0029           NSWAP   equ     41
 2979  002A           NPOP    equ     42
 2980  002B           NDA     equ     43
 2981  002C           NXCHD   equ     44
 2982  002D           NJMP    equ     45
 2983                 
 2984                        
 2985                 ;=====  OPCODES TABLE  =====
 2986                 ;byte   2*n     Mnemonic index
 2987                 ;       2*n+1   (Operand 1 index) * 16 + (Operand 2 index)
 2988                 ;where  n = opcode
 2989  13FD           TOPCOD: 
 2990  13FD 0D000EE0          db      NNOP,00H,NAJMP,0E0H,NLJMP,0E0H,NRR,10H
       1401 10E01A10
 2991  1405 00100060          db      NINC,10H,NINC,60H,NINC,20H,NINC,20H
       1409 00200020
 2992  140D 00300030          db      NINC,30H,NINC,30H,NINC,30H,NINC,30H
       1411 00300030
 2993  1415 00300030          db      NINC,30H,NINC,30H,NINC,30H,NINC,30H
       1419 00300030
 2994  141D 124F0FE0          db      NJBC,4FH,NACALL,0E0H,NLCALL,0E0H,NRRC,10H
       1421 11E01B10
 2995  1425 01100160          db      NDEC,10H,NDEC,60H,NDEC,20H,NDEC,20H
       1429 01200120
 2996  142D 01300130          db      NDEC,30H,NDEC,30H,NDEC,30H,NDEC,30H
       1431 01300130
 2997  1435 01300130          db      NDEC,30H,NDEC,30H,NDEC,30H,NDEC,30H
       1439 01300130
 2998  143D 134F0EE0          db      NJB,4FH,NAJMP,0E0H,NRET,00H,NRL,10H
       1441 23001C10
 2999  1445 02150216          db      NADD,15H,NADD,16H,NADD,12H,NADD,12H
       1449 02120212
 3000  144D 02130213          db      NADD,13H,NADD,13H,NADD,13H,NADD,13H
       1451 02130213
 3001  1455 02130213          db      NADD,13H,NADD,13H,NADD,13H,NADD,13H
       1459 02130213
 3002  145D 144F0FE0          db      NJNB,4FH,NACALL,0E0H,NRETI,00H,NRLC,10H
       1461 24001D10
 3003  1465 03150316          db      NADDC,15H,NADDC,16H,NADDC,12H,NADDC,12H
       1469 03120312
 3004  146D 03130313          db      NADDC,13H,NADDC,13H,NADDC,13H,NADDC,13H
       1471 03130313
 3005  1475 03130313          db      NADDC,13H,NADDC,13H,NADDC,13H,NADDC,13H
       1479 03130313
 3006  147D 15F00EE0          db      NJC,0F0H,NAJMP,0E0H,NORL,61H,NORL,65H
       1481 04610465
 3007  1485 04150416          db      NORL,15H,NORL,16H,NORL,12H,NORL,12H
       1489 04120412
 3008  148D 04130413          db      NORL,13H,NORL,13H,NORL,13H,NORL,13H
       1491 04130413
 3009  1495 04130413          db      NORL,13H,NORL,13H,NORL,13H,NORL,13H
       1499 04130413
 3010  149D 16F00FE0          db      NJNC,0F0H,NACALL,0E0H,NANL,61H,NANL,65H
       14A1 05610565
 3011  14A5 05150516          db      NANL,15H,NANL,16H,NANL,12H,NANL,12H
       14A9 05120512
 3012  14AD 05130513          db      NANL,13H,NANL,13H,NANL,13H,NANL,13H
       14B1 05130513
 3013  14B5 05130513          db      NANL,13H,NANL,13H,NANL,13H,NANL,13H
       14B9 05130513
 3014  14BD 17F00EE0          db      NJZ,0F0H,NAJMP,0E0H,NXRL,61H,NXRL,65H
       14C1 06610665
 3015  14C5 06150616          db      NXRL,15H,NXRL,16H,NXRL,12H,NXRL,12H
       14C9 06120612
 3016  14CD 06130613          db      NXRL,13H,NXRL,13H,NXRL,13H,NXRL,13H
       14D1 06130613
 3017  14D5 06130613          db      NXRL,13H,NXRL,13H,NXRL,13H,NXRL,13H
       14D9 06130613
 3018  14DD 18F00FE0          db      NJNZ,0F0H,NACALL,0E0H,NORL,74H,NJMP,80H
       14E1 04742D80
 3019  14E5 07150765          db      NMOV,15H,NMOV,65H,NMOV,25H,NMOV,25H
       14E9 07250725
 3020  14ED 07350735          db      NMOV,35H,NMOV,35H,NMOV,35H,NMOV,35H
       14F1 07350735
 3021  14F5 07350735          db      NMOV,35H,NMOV,35H,NMOV,35H,NMOV,35H
       14F9 07350735
 3022  14FD 19F00EE0          db      NSJMP,0F0H,NAJMP,0E0H,NANL,74H,NMOVC,19H
       1501 05741E19
 3023  1505 25000866          db      NDIV,00H,NMOVM,66H,NMOV,62H,NMOV,62H
       1509 07620762
 3024  150D 07630763          db      NMOV,63H,NMOV,63H,NMOV,63H,NMOV,63H
       1511 07630763
 3025  1515 07630763          db      NMOV,63H,NMOV,63H,NMOV,63H,NMOV,63H
       1519 07630763
 3026  151D 07AD0FE0          db      NMOV,0ADH,NACALL,0E0H,NMOV,47H,NMOVC,18H
       1521 07471E18
 3027  1525 09150916          db      NSUBB,15H,NSUBB,16H,NSUBB,12H,NSUBB,12H
       1529 09120912
 3028  152D 09130913          db      NSUBB,13H,NSUBB,13H,NSUBB,13H,NSUBB,13H
       1531 09130913
 3029  1535 09130913          db      NSUBB,13H,NSUBB,13H,NSUBB,13H,NSUBB,13H
       1539 09130913
 3030  153D 047B0EE0          db      NORL,7BH,NAJMP,0E0H,NMOV,74H,NINC,0A0H
       1541 077400A0
 3031  1545 26002700          db      NMUL,00H,NDB,00H,NMOV,26H,NMOV,26H
       1549 07260726
 3032  154D 07360736          db      NMOV,36H,NMOV,36H,NMOV,36H,NMOV,36H
       1551 07360736
 3033  1555 07360736          db      NMOV,36H,NMOV,36H,NMOV,36H,NMOV,36H
       1559 07360736
 3034  155D 057B0FE0          db      NANL,7BH,NACALL,0E0H,NCPL,40H,NCPL,70H
       1561 1F401F70
 3035  1565 0A150A16          db      NCJNE,15H,NCJNE,16H,NCJNE,25H,NCJNE,25H
       1569 0A250A25
 3036  156D 0A350A35          db      NCJNE,35H,NCJNE,35H,NCJNE,35H,NCJNE,35H
       1571 0A350A35
 3037  1575 0A350A35          db      NCJNE,35H,NCJNE,35H,NCJNE,35H,NCJNE,35H
       1579 0A350A35
 3038  157D 28600EE0          db      NPUSH,60H,NAJMP,0E0H,NCLR,40H,NCLR,70H
       1581 20402070
 3039  1585 29100B16          db      NSWAP,10H,NXCH,16H,NXCH,12H,NXCH,12H
       1589 0B120B12
 3040  158D 0B130B13          db      NXCH,13H,NXCH,13H,NXCH,13H,NXCH,13H
       1591 0B130B13
 3041  1595 0B130B13          db      NXCH,13H,NXCH,13H,NXCH,13H,NXCH,13H
       1599 0B130B13
 3042  159D 2A600FE0          db      NPOP,60H,NACALL,0E0H,NSETB,40H,NSETB,70H
       15A1 21402170
 3043  15A5 2B100C6F          db      NDA,10H,NDJNZ,6FH,NXCHD,12H,NXCHD,12H
       15A9 2C122C12
 3044  15AD 0C3F0C3F          db      NDJNZ,3FH,NDJNZ,3FH,NDJNZ,3FH,NDJNZ,3FH
       15B1 0C3F0C3F
 3045  15B5 0C3F0C3F          db      NDJNZ,3FH,NDJNZ,3FH,NDJNZ,3FH,NDJNZ,3FH
       15B9 0C3F0C3F
 3046  15BD 221C0EE0          db      NMOVX,1CH,NAJMP,0E0H,NMOVX,12H,NMOVX,12H
       15C1 22122212
 3047  15C5 20100716          db      NCLR,10H,NMOV,16H,NMOV,12H,NMOV,12H
       15C9 07120712
 3048  15CD 07130713          db      NMOV,13H,NMOV,13H,NMOV,13H,NMOV,13H
       15D1 07130713
 3049  15D5 07130713          db      NMOV,13H,NMOV,13H,NMOV,13H,NMOV,13H
       15D9 07130713
 3050  15DD 22C10FE0          db      NMOVX,0C1H,NACALL,0E0H,NMOVX,21H,NMOVX,21H
       15E1 22212221
 3051  15E5 1F100761          db      NCPL,10H,NMOV,61H,NMOV,21H,NMOV,21H
       15E9 07210721
 3052  15ED 07310731          db      NMOV,31H,NMOV,31H,NMOV,31H,NMOV,31H
       15F1 07310731
 3053  15F5 07310731          db      NMOV,31H,NMOV,31H,NMOV,31H,NMOV,31H
       15F9 07310731
 3054                 
 3055                 
 3056                 
 3057                 ;=====  EMON TOOLS  =====
 3058                 
 3059                 
 3060  000D           CR        equ       0Dh
 3061  000A           LF        equ       0Ah
 3062  0006           ACK       EQU       06H
 3063  0015           NACK      EQU       15H
 3064                 ;
 3065                 ;
 3066                 ; RAM Definitions
 3067                 ;          
 3068  0000                     STACK     datasim
 3069                 ;offset for this segment must be 7F for simcad
 3070                 ;user internal ram is then 30h -> 65h (53 bytes)   7F-(18D+16D)
 3071                 ;if 3 bank register and bit segment not used 8 ->  (   bytes)
 3072                 ;
 3073  0000           HEXLEN  DS   1  ;for hex load                                  
 3074  0001           HEXSUM  DS   2
 3075                 ;
 3076  0003           op1     equ  $  ;arithmetic storage
 3077  0003           quot    equ  $
 3078  0003           acc_b   DS   5
 3079  0005           op2     equ  op1+2
 3080  0005           divi    equ  op2
 3081                 ;
 3082  0008           prod    equ  $
 3083  0008           acc_a   ds   5
 3084                 ;
 3085  000D           divcnt  ds   1
 3086                 ;
 3087                 ; used for snapshot and MON
 3088  000E           PSWSAV  DS   1
 3089  000F           ACCSAV  DS   1
 3090  0010           DPHSAV  DS   1
 3091  0011           DPLSAV  DS   1
 3092  0012           stk     ds   16
 3093                 
 3094  15FD                   RSEG    code
 3095                 
 3096                 ;____________________________________________________________________
 3097                 ;____________________________________________________________________
 3098                 ; utilitaires emon
 3099                 ;____________________________________________________________________
 3100                 ;____________________________________________________________________
 3101                 ;
 3102                 ;
 3103                 ;______________________________________
 3104                 ;user vectors linker
 3105                 ;appel :link
 3106                 ;fonction :transfert de l'adresse d'une procédure d'interruption
 3107                 ;entrées  :(a)=index;  1=IE0, 2=TF0, 3=IE1, 4=TF1, 5=RI+TI,15=T2B0
 3108                 ;6=SI, 7=CT0, 8=CT1, 9=CT2, 10=CT3, 11=ADCI, 12=CM0, 13=CM1, 14=CM2                                                                        
 3109                 ;          (dptr)=vecteur
 3110                 ;sortie   :néant
 3111                 ;
 3112  15FD AF82      link   MOV   R7,DPL          ; target adr in DPTR , table offset in A
 3113  15FF AE83             MOV   R6,DPH
 3114  1601 900000           MOV   DPTR,#rstvec
 3115  1604 C3               CLR   C
 3116  1605 9401             SUBB  A,#1
 3117  1607 4011             JC    oct1
 3118                 ;      JC    intb0
 3119                 ;      JNZ   oct
 3120  1609 902003           MOV   DPTR,#2003h
 3121                 ;      SJMP  ret_link
 3122                 ;intb0  MOV   DPTR,#2000h
 3123                 ;      SJMP  ret_link
 3124  160C 75F008    oct    MOV   B,#8
 3125  160F A4               MUL   AB
 3126  1610 2582             ADD   A,DPL
 3127  1612 F582             MOV   DPL,A
 3128  1614 E5F0             MOV   A,B
 3129  1616 3583             ADDC  A,DPH
 3130  1618 F583             MOV   DPH,A
 3131  161A 7402      oct1:  MOV   A,#2            ; LJMP instruction
 3132  161C F0               MOVX  @DPTR,A
 3133  161D A3               INC   DPTR
 3134  161E EE               MOV   A,R6
 3135  161F F0               MOVX  @DPTR,A
 3136  1620 A3               INC   DPTR
 3137  1621 EF               MOV   A,R7
 3138  1622 F0               MOVX  @DPTR,A
 3139  1623           ret_link:
 3140  1623 22               RET
 3141                 ;______________________________________
 3142                 ;addition de deux nombres de 16 bits
 3143                 ;appel :add16s
 3144                 ;entrées  :((R0)) sur 16 bits 
 3145                 ;         :((R1)) sur 16 bits
 3146                 ;résultat :((R0))+CY
 3147                 ;RO pointeurs avec @RX=lsb 
 3148                 ;R0,R1 inchangés
 3149                 ;
 3150  1624 E6        add16s MOV   A,@R0      ; start at low digits
 3151  1625 27               ADD   A,@R1
 3152  1626 F6               MOV   @R0,A
 3153  1627 08               INC   R0         ; advance pointers
 3154  1628 09               INC   R1
 3155  1629 E6               MOV   A,@R0
 3156  162A 37               ADDC  A,@R1      ; with CY from last ADD
 3157  162B F6               MOV   @R0,A
 3158  162C 18               DEC   R0         ; restore pointers
 3159  162D 19               DEC   R1
 3160  162E 22               RET
 3161                 ;______________________________________
 3162                 ;16 bits <- 0
 3163                 ;appel :clr16
 3164                 ;entrées  :((R0)) sur 16 bits 
 3165                 ;sortie   :((R0)) = 0
 3166                 ;R0 inchangé
 3167                 ;
 3168  162F 7600      clr16  MOV   @R0,#0
 3169  1631 08               INC   R0
 3170  1632 7600             MOV   @R0,#0
 3171  1634 18               DEC   R0
 3172  1635 22               RET
 3173                 ;______________________________________
 3174                 ;shift à gauche un nombre de 16 bits
 3175                 ;appel :shl16
 3176                 ;entrées  :((R0)) sur 16 bits 
 3177                 ;sortie   :((R0)) = 2*((R0))+CY
 3178                 ;R0 inchangé
 3179                 ;
 3180  1636 E6        shl16  MOV   A,@R0      ; shift left 16 bit value
 3181  1637 26               ADD   A,@R0
 3182  1638 F6               MOV   @R0,A
 3183  1639 08               INC   R0
 3184  163A E6               MOV   A,@R0
 3185  163B 36               ADDC  A,@R0
 3186  163C F6               MOV   @R0,A
 3187  163D 18               DEC   R0
 3188  163E 22               RET
 3189                 ;______________________________________
 3190                 ;lire, sans echo, des caractères hexa jusqu'à ce que le car. ne soit pas hexa
 3191                 ;appel :get16
 3192                 ;sortie : ((R0)) = resultat, (R0)=acc_a 
 3193                 ;Procédures utilisées: clr16, get1h,shl16
 3194                 ;
 3195  163F 7808      get16  MOV   R0,#acc_a  ;
 3196  1641 12162F           LCALL clr16      ; ((R0)) et ((R0+1)) =0
 3197  1644 12171A    get16l LCALL get1h     ; (A) = bin
 3198  1647 5003             JNC   OK16
 3199  1649 7808             MOV   R0,#acc_a
 3200  164B 22               RET
 3201  164C FF        OK16:  MOV   R7,A
 3202  164D 121636           LCALL shl16      ; *16
 3203  1650 121636           LCALL shl16
 3204  1653 121636           LCALL shl16
 3205  1656 121636           LCALL shl16
 3206  1659 EF               MOV   A,R7
 3207  165A 26               ADD   A,@R0
 3208  165B F6               MOV   @R0,A
 3209  165C 80E6             SJMP  get16l
 3210                 ;______________________________________
 3211                 ;lire deux caractères ASCII sur l'interface V24 et convertir en 1 octet binaire
 3212                 ;sans echo
 3213                 ;appel :get2h
 3214                 ;résultat : ((R0)), (R0)=acc_a
 3215                 ;si caractère non [0..F] CY = 1 et arrêt
 3216                 ;procedure utilisée : get1h
 3217                 ;
 3218  165E 7808      get2h   MOV   R0,#acc_a  ;
 3219  1660 12171A           LCALL get1h     ; (A) = 0000BBBB
 3220  1663 400C             JC    finh
 3221  1665 23               rl    a           ;*16
 3222  1666 23               rl    a
 3223  1667 23               rl    a
 3224  1668 23               rl    a
 3225  1669 F6               mov   @R0,A
 3226  166A 12171A           lcall get1h
 3227  166D 4002             jc    finh
 3228  166F 26               ADD   A,@R0
 3229  1670 F6               MOV   @R0,A
 3230  1671 7808      finh   mov   R0,#acc_a
 3231  1673 22               ret
 3232                 ;______________________________________
 3233                 ;lire deux caractères ASCII sur l'interface V24 et convertir en 1 octet binaire
 3234                 ;avec echo
 3235                 ;appel :get2he
 3236                 ;résultat : ((R0))
 3237                 ;si caractère non [0..F] CY = 1 et arrêt
 3238                 ;procedure utilisée : get1he
 3239                 ;
 3240  1674 7808      get2he  mov   R0,#acc_a
 3241  1676 12171F           lcall get1he      ; (A) = 0000BBBB
 3242  1679 400C             JC    finhe
 3243  167B 23               rl    a           ;*16
 3244  167C 23               rl    a
 3245  167D 23               rl    a
 3246  167E 23               rl    a
 3247  167F F6               mov   @R0,A
 3248  1680 12171F           lcall get1he
 3249  1683 4002             jc    finhe
 3250  1685 26               ADD   A,@R0
 3251  1686 F6               MOV   @R0,A
 3252  1687 7808      finhe   mov   R0,#acc_a
 3253  1689 22               ret
 3254                 
 3255                 ;______________________________________
 3256                 ;echo sur la ligne V24. Si lf ajouter un cr
 3257                 ;appel : echo
 3258                 ;procédures utilisées : snd
 3259                 ;
 3260  168A B40D05    echo   CJNE  A,#CR,EC1  ;
 3261  168D 121796           LCALL snd
 3262  1690 740A             MOV A,#LF  
 3263  1692 021796    EC1    LJMP snd
 3264                 ;______________________________________
 3265                 ;lire,avec echo, un nombre hexa sur l'interface V24 par l'invitation : 'H>'
 3266                 ;jusqu'à ce que le caractère ne soit pas hexa
 3267                 ;appel : get16i
 3268                 ;registres modifiés : A,B,PSW,R0..R7
 3269                 ;résultat : ((R0)) = le nombre (sans le caractère de fin),(R0)=acc_a
 3270                 ;         : (R6)=digit count
 3271                 ;procédures utilisées :clr16,snd,get1he,shl16
 3272                 ;
 3273  1695 7808      get16i  MOV   R0,#acc_a  ; get hex value int acc_a , count digits in R6
 3274  1697 12162F           LCALL clr16      ; value:=0
 3275  169A 7448             MOV   A,#'H'     ; send prompt
 3276  169C 121796           LCALL snd
 3277  169F 743E             MOV   A,#'>'
 3278  16A1 121796           LCALL snd
 3279  16A4 7E00             MOV   R6,#0      ; count significant hex digits
 3280  16A6 12171F    get16il LCALL get1he     ; get input character
 3281  16A9 5003             JNC   OK1        ; go on if hexadecimal
 3282  16AB 7808             MOV   R0,#acc_a  ; return address of accu also
 3283  16AD 22               RET
 3284  16AE 0E        OK1:   INC   R6         ; update number of digits
 3285  16AF FF               MOV   R7,A       ; save input value
 3286  16B0 121636           LCALL shl16      ; acc_a:=acc_a * 16
 3287  16B3 121636           LCALL shl16
 3288  16B6 121636           LCALL shl16
 3289  16B9 121636           LCALL shl16
 3290  16BC EF               MOV   A,R7
 3291  16BD 26               ADD   A,@R0      ; add input value ( no CY )
 3292  16BE F6               MOV   @R0,A
 3293  16BF 80E5             SJMP  get16il
 3294                 ;______________________________________
 3295                 ;Lire,avec echo, un nombre décimal sur l'interface V24 par l'invitation : 'D>'
 3296                 ;jusqu'à ce que le caractère ne soit pas décimal
 3297                 ;appel : get10i
 3298                 ;registres modifiés : A,B,PSW,R0..R7
 3299                 ;résultat : ((R0) = le nombre (sans le caractère de fin)
 3300                 ;       : (R0) = acc_a
 3301                 ;         : (R6) = digit number
 3302                 ;procédures utilisées :clr16,snd,get1d
 3303                 ;
 3304  16C1 7808      get10i  MOV   R0,#acc_a  ; get decimal value int ACCU0 , digits in R6
 3305  16C3 12162F           LCALL clr16      ; value:=0
 3306  16C6 7444             MOV   A,#'D'     ; prompt
 3307  16C8 121796           LCALL snd
 3308  16CB 743E             MOV   A,#'>'
 3309  16CD 121796           LCALL snd
 3310  16D0 7E00             MOV   R6,#0      ; significant hex digits
 3311  16D2 121705    get10il LCALL get1de
 3312  16D5 5003             JNC   OK1d       ; go on if ok
 3313  16D7 7808             MOV   R0,#acc_a  ; return address of accu also
 3314  16D9 22               RET
 3315  16DA 0E        OK1d   INC   R6         ; update digit count
 3316  16DB FF               MOV   R7,A       ; saves chr value
 3317  16DC AA08             MOV   R2,acc_a   ; LSB
 3318  16DE AB09             MOV   R3,acc_a+1 ; MSB
 3319  16E0 EA               MOV   A,R2       ; multiply by 10 this value
 3320  16E1 75F00A           MOV   B,#10
 3321  16E4 A4               MUL   AB
 3322  16E5 F508             MOV   acc_a,A
 3323  16E7 85F009           MOV   acc_a+1,B
 3324  16EA EB               MOV   A,R3
 3325  16EB 75F00A           MOV   B,#10
 3326  16EE A4               MUL   AB
 3327  16EF 2509             ADD   A,acc_a+1  ; add to old MSB
 3328  16F1 F509             MOV   acc_a+1,A
 3329  16F3 EF               MOV   A,R7       ; char value
 3330  16F4 2508             ADD   A,acc_a    ; add input value
 3331  16F6 F508             MOV   acc_a,A
 3332  16F8 E509             MOV   A,acc_a+1
 3333  16FA 3400             ADDC  A,#0       ; account for CY
 3334  16FC F509             MOV   acc_a+1,A
 3335  16FE 80D2             SJMP  get10il
 3336                 ;______________________________________
 3337                 ;Lire,avec ou sans echo, un caractère décimal sur l'interface V24
 3338                 ;appel : get1d sans echo
 3339                 ;      : get1de avec echo
 3340                 ;résultat : (A) = le chiffre convert en binaire
 3341                 ;            CY=1 si pas décimal
 3342                 ;procédures utilisées : getupc,echo
 3343                 ;
 3344  1700 12177D    get1d LCALL getupc     ; get decimal character, set CY if not
 3345  1703 8006             sjmp  skip
 3346  1705 12177D    get1de lcall getupc     
 3347  1708 12168A           LCALL echo
 3348  170B C3        skip   CLR   C
 3349  170C 9430             SUBB  A,#'0'
 3350  170E 4008             JC    nodec
 3351  1710 940A             SUBB  A,#10
 3352  1712 5004             JNC   nodec
 3353  1714 240A             ADD   A,#10
 3354  1716 C3               CLR   C
 3355  1717 22               RET
 3356  1718 D3        nodec  SETB   C
 3357  1719 22               RET
 3358                 ;______________________________________
 3359                 ;lecture d'un caractère hexa avec ou sans echo sur l'interface V24
 3360                 ;appel : get1h sans echo
 3361                 ;      : get1he avec echo
 3362                 ;résultat : (A) = le caractère hexa convert en binaire
 3363                 ;            CY=1 si pas hexa
 3364                 ;procédures utilisées : getupc,echo
 3365                 ;
 3366  171A 12177D    get1h LCALL getupc
 3367  171D 8006             SJMP  GOON2
 3368  171F 12177D    get1he LCALL getupc
 3369  1722 12168A           LCALL echo
 3370  1725 C3        GOON2  CLR   C
 3371  1726 9430             SUBB  A,#'0'
 3372  1728 4016             JC    hcor1
 3373  172A 940A             SUBB  A,#10
 3374  172C 5004             JNC   nohex1
 3375  172E 240A             ADD   A,#10
 3376  1730 C3        ISHEX  CLR   C
 3377  1731 22               RET
 3378  1732 9407      nohex1 SUBB  A,#7
 3379  1734 400E             JC    hcor2
 3380  1736 9406             SUBB  A,#6
 3381  1738 500E             JNC   hcor3
 3382  173A 2410             ADD   A,#16
 3383  173C 80F2             SJMP  ISHEX
 3384  173E D3        nohex: SETB   C
 3385  173F 22               RET
 3386  1740 2430      hcor1  ADD    A,#'0'
 3387  1742 80FA             SJMP nohex
 3388  1744 2441      hcor2  ADD    A,#'0'+17
 3389  1746 80F6             SJMP nohex
 3390  1748 2448      hcor3  ADD    A,#'0'+17+7
 3391  174A 80F2             SJMP nohex
 3392                 ;
 3393                 ;______________________________________
 3394                 ;envoyer un texte sur l'interface V24
 3395                 ;appel : stxt
 3396                 ;données  : (dptr) = texte terminé par 0
 3397                 ;registres modifiés : A,DPTR
 3398                 ;procédure utilisée : snd
 3399                 ;
 3400  174C           stxt   EQU   $
 3401  174C 7400             MOV   A,#0
 3402  174E 93               MOVC  A,@A+DPTR
 3403  174F 6006             JZ    ETXT
 3404  1751 121796           LCALL snd
 3405  1754 A3               INC   DPTR
 3406  1755 80F5             SJMP  stxt
 3407  1757 22        ETXT   RET
 3408                 ;______________________________________
 3409                 ;envoyer un espace sur l'interface V24
 3410                 ;appel : blank
 3411                 ;registres modifiés : A,DPTR
 3412                 ;procédure utilisée : snd
 3413                 ;
 3414  1758 7420      blank  MOV   A,#' '     ; send blank
 3415  175A 803A             SJMP  snd
 3416                 ;______________________________________
 3417                 ;envoyer deux caractères hexa pour un octet binaire, sur l'interface V24
 3418                 ;appel : byte
 3419                 ;entrée   :(A) en binaire
 3420                 ;registres modifiés : A
 3421                 ;procédure utilisée : snd
 3422                 ;
 3423  175C C0E0      byte   PUSH  ACC        ; send byte hexadecimal , destroy ACC only
 3424  175E C4               SWAP  A
 3425  175F 121764           LCALL NIBBLE
 3426  1762 D0E0             POP   ACC
 3427  1764 540F      NIBBLE ANL   A,#0FH
 3428  1766 24F6             ADD   A,#246
 3429  1768 4004             JC    HEXOUT
 3430  176A 243A             ADD   A,#58
 3431  176C 8028             SJMP  snd
 3432  176E 2441      HEXOUT ADD   A,#65
 3433  1770 8024             SJMP  snd
 3434                 ;______________________________________
 3435                 ;envoyer un crlf sur l'interface V24
 3436                 ;appel : crlf
 3437                 ;registres modifiés : A
 3438                 ;procédure utilisée : snd
 3439                 ;
 3440  1772 740D      crlf   MOV   A,#CR
 3441  1774 121796           LCALL snd
 3442  1777 740A             MOV   A,#LF
 3443  1779 121796           LCALL snd
 3444  177C 22               RET
 3445                 ;______________________________________
 3446                 ;lire un caractère majuscule sur l'interface V24
 3447                 ;appel : getupc
 3448                 ;résultat : (A) avec miniscules transformées en majuscules
 3449                 ;registres modifiés : A,PSW
 3450                 ;procédure utilisée : getchr,upcase
 3451                 ;
 3452  177D 1217A9    getupc LCALL getchr     ; get upper case character from serial port
 3453  1780 121784           LCALL upcase
 3454  1783 22               RET
 3455                 ;______________________________________
 3456                 ;conversion miniscule en majuscule
 3457                 ;appel : upcase
 3458                 ;donnée et résultat : (A)
 3459                 ;registres modifiés : néant
 3460                 ;
 3461  1784 C3        upcase CLR   C          ; convert character to upper case letter
 3462  1785 9461             SUBB  A,#'a'
 3463  1787 400A             JC    UPC1       ; char <97  a-> 0    z->25
 3464  1789 941A             SUBB  A,#26
 3465  178B 4003             JC    UPC2       ; (char-a)<26  , do upcase translation
 3466  178D 247B             ADD   A,#26+'a'
 3467  178F 22               RET
 3468  1790 245B      UPC2   ADD   A,#26+'A'
 3469  1792 22               RET
 3470  1793 2461      UPC1   ADD  A,#'a'
 3471  1795 22               RET
 3472                 ;______________________________________
 3473                 ;envoyer un caractère sur l'interface V24
 3474                 ;appel : snd
 3475                 ;registres modifié : aucun
 3476                 ;
 3477  1796           snd:
 3478  1796 C0A8             PUSH  IE
 3479  1798 C2AC             CLR   ES
 3480  179A C2AA             CLR   EX0+DBGINT+DBGINT
 3481  179C 3099FD           JNB   SCON.1,$  ; must not destroy any reg
 3482  179F C299             CLR   SCON.1
 3483  17A1 F599             MOV   SBUF,A
 3484  17A3 D0A8             pop   IE
 3485  17A5 22               RET
 3486                 ;______________________________________
 3487                 ;lire un caractère ssur l'interface V24
 3488                 ;appel : getchr
 3489                 ;résultat :(A)
 3490                 ;registre modifié : PSW
 3491                 ;
 3492  17A6 1206C0    GETC0: CALL  INT                ; interrupt
 3493  17A9           getchr EQU $                    ; get character from serial port
 3494  17A9 1217D7    GETC1: CALL  GETCC
 3495  17AC B40427           CJNE  A,#04h,GETCX       ; interrupt if Ctrl-D hit
 3496  17AF E8               MOV   A,R0
 3497  17B0 C0E0             PUSH  ACC
 3498  17B2 78E8             MOV   R0,#MODE
 3499  17B4 E6               MOV   A,@R0
 3500  17B5 764E             MOV   @R0,#'N'
 3501  17B7 C2E5             CLR   ACC.5              ; to upper case
 3502  17B9 B44315           CJNE  A,#'C',GETC2
 3503  17BC 78EE             MOV   R0,#SAVERET
 3504  17BE E6               MOV   A,@R0
 3505  17BF C0E0             PUSH  ACC
 3506  17C1 08               INC   R0
 3507  17C2 E6               MOV   A,@R0
 3508  17C3 C0E0             PUSH  ACC
 3509  17C5 78ED             MOV   R0,#SAVESP
 3510  17C7 E6               MOV   A,@R0
 3511  17C8 14               DEC   A
 3512  17C9 F8               MOV   R0,A
 3513  17CA D0E0             POP   ACC
 3514  17CC F6               MOV   @R0,A
 3515  17CD 08               INC   R0
 3516  17CE D0E0             POP   ACC
 3517  17D0 F6               MOV   @R0,A
 3518  17D1 D0E0      GETC2: POP   ACC
 3519  17D3 F8               MOV   R0,A
 3520  17D4 80D0             SJMP  GETC0
 3521  17D6 22        GETCX: RET
 3522                 
 3523  17D7 C0A8      GETCC: PUSH  IE
 3524  17D9 C2AA             CLR   EX0+DBGINT+DBGINT
 3525  17DB 301D02           JNB   SINTDBG,GETCC1
 3526  17DE C2AC             CLR   ES
 3527  17E0 3098FD    GETCC1:JNB   SCON.0,GETCC1
 3528  17E3 C298             CLR   SCON.0
 3529  17E5 E599             MOV   A,SBUF
 3530  17E7 D0A8             POP   IE
 3531  17E9 22               RET
 3532                 ;______________________________________
 3533                 ;
 3534                 ;Utilitaires utilisateur
 3535                 ;
 3536                 ;______________________________________
 3537                 ;______________________________________
 3538                 ;short time delay
 3539                 ;appel : stime
 3540                 ;fonction :
 3541                 ;entrée   :
 3542                 ;sortie   :
 3543                 ;
 3544  17EA E582      stime   MOV   A,DPL     ; 6+DPTR*15 microsec (MOV DPTR + CALL adds 4)
 3545  17EC 4583              ORL   A,DPH
 3546  17EE 6011              JZ    SRET1
 3547  17F0 D3                SETB  C
 3548  17F1 E582              MOV   A,DPL
 3549  17F3 9400              SUBB  A,#0
 3550  17F5 F582              MOV   DPL,A
 3551  17F7 E583              MOV   A,DPH
 3552  17F9 9400              SUBB  A,#0
 3553  17FB F583              MOV   DPH,A
 3554  17FD 00                NOP
 3555  17FE 00                NOP
 3556  17FF 80E9              SJMP  stime
 3557  1801 22        SRET1   RET
 3558                 ;______________________________________
 3559                 ;long Time delay
 3560                 ;appel :ltime
 3561                 ;fonction :
 3562                 ;entrée   :
 3563                 ;sortie   :
 3564                 ;
 3565  1802 E582      ltime   MOV   A,DPL     ; 6+DPTR*(15 + TIME0) micros (MOV DPTR + CALL add 4)
 3566  1804 4583              ORL   A,DPH     ; 6+DPTR*1000 micros
 3567  1806 6012              JZ    SRET2
 3568  1808 D3                SETB  C
 3569  1809 E582              MOV   A,DPL
 3570  180B 9400              SUBB  A,#0
 3571  180D F582              MOV   DPL,A
 3572  180F E583              MOV   A,DPH
 3573  1811 9400              SUBB  A,#0
 3574  1813 F583              MOV   DPH,A
 3575  1815 12181B            LCALL TIME0
 3576  1818 80E8              SJMP  ltime
 3577  181A 22        SRET2   RET
 3578                 ;
 3579  00C4           n1      EQU   196
 3580  181B 7511C4    TIME0   MOV   DPLSAV,#n1      ; (n1+1)*5 microsec=985 micros
 3581  181E 00                NOP
 3582  181F 00        TIME0L  NOP
 3583  1820 00                NOP
 3584  1821 00                NOP
 3585  1822 D511FA            DJNZ  DPLSAV,TIME0L
 3586  1825 22                RET
 3587                 ;______________________________________
 3588                 ;addition 16 bits+16 bits
 3589                 ;appel : add16
 3590                 ;entrées  :((R0)) et ((R1))
 3591                 ;sortie   :((R0)) + CY avec (R0)=op1
 3592                 ;R0 et R1 pointeurs avec @RX=lsb et @(RX+1)=msb
 3593                 ;(op1)=lsb (op1+1)=msb
 3594                 ;
 3595  1826           add16   EQU $              ; @R0 + @R1 goes to op1
 3596  1826 E6                MOV   A,@R0
 3597  1827 27                ADD   A,@R1
 3598  1828 F503              MOV   op1,A
 3599  182A 08                INC   R0
 3600  182B 09                INC    R1
 3601  182C E6                MOV   A,@R0
 3602  182D 37                ADDC  A,@R1
 3603  182E F504              MOV   op1+1,A
 3604  1830 7803              MOV   R0,#op1
 3605  1832 22                RET
 3606                 ;______________________________________
 3607                 ;soustraction 16 bits-16 bits
 3608                 ;appel : sub16
 3609                 ;entrées  :((R0)) et ((R1))
 3610                 ;sortie   :((R0)) avec (R0)=op1
 3611                 ;R0 et R1 pointeurs avec @RX=lsb et @(RX+1)=msb
 3612                 ;
 3613  1833           sub16   EQU $              ; @R0 - @R1 goes to op1
 3614  1833 C3                CLR   C
 3615  1834 E6                MOV   A,@R0
 3616  1835 97                SUBB  A,@R1
 3617  1836 F503              MOV   op1,A
 3618  1838 08                INC   R0
 3619  1839 09                INC   R1
 3620  183A E6                MOV   A,@R0
 3621  183B 97                SUBB  A,@R1
 3622  183C F504              MOV   op1+1,A
 3623  183E 7803              MOV   R0,#op1
 3624  1840 22                RET
 3625                 ;______________________________________
 3626                 ;multiplication 16 bits*16 bits=32 bits
 3627                 ;appel : mul16
 3628                 ;entrées  :((R0)) sur 16 bits 
 3629                 ;         :((R1)) sur 16 bits
 3630                 ;sortie   :((R0)) 32 bits avec (R0)=prod
 3631                 ;R0 et R1 pointeurs avec @RX=lsb 
 3632                 ;
 3633  1841           mul16   EQU $                 ; @R0 * @R1 goes to prod
 3634  1841 8603              MOV   op1+0,@R0
 3635  1843 8705              MOV   op2+0,@R1
 3636  1845 08                INC   R0
 3637  1846 09                INC   R1
 3638  1847 8604              MOV   op1+1,@R0
 3639  1849 8706              MOV   op2+1,@R1
 3640                 ;
 3641  184B E503      mul16b MOV  A,op1+0    ; 16*16 multply -> 32 bit  ( approx. 70 microsec )
 3642  184D 8505F0           MOV  B,op2+0
 3643  1850 A4               MUL  AB          ; low * low byte
 3644  1851 F508             MOV  prod+0,A
 3645  1853 85F009           MOV  prod+1,B
 3646  1856 E504             MOV  A,op1+1
 3647  1858 8506F0           MOV  B,op2+1
 3648  185B A4               MUL  AB          ; high * high byte
 3649  185C F50A             MOV  prod+2,A
 3650  185E 85F00B           MOV  prod+3,B
 3651  1861 E504             MOV  A,op1+1    ; mixed prod 1
 3652  1863 8505F0           MOV  B,op2+0
 3653  1866 A4               MUL  AB
 3654  1867 2509             ADD  A,prod+1    ; add 3 byte wide
 3655  1869 F509             MOV  prod+1,A
 3656  186B E50A             MOV  A,prod+2
 3657  186D 35F0             ADDC A,B
 3658  186F F50A             MOV  prod+2,A
 3659  1871 E50B             MOV  A,prod+3
 3660  1873 3400             ADDC A,#0
 3661  1875 F50B             MOV  prod+3,A
 3662  1877 E503             MOV  A,op1+0    ; mixed prod 2
 3663  1879 8506F0           MOV  B,op2+1
 3664  187C A4               MUL  AB
 3665  187D 2509             ADD  A,prod+1    ; add 3 byte wide
 3666  187F F509             MOV  prod+1,A
 3667  1881 E50A             MOV  A,prod+2
 3668  1883 35F0             ADDC A,B
 3669  1885 F50A             MOV  prod+2,A
 3670  1887 E50B             MOV  A,prod+3
 3671  1889 3400             ADDC A,#0
 3672  188B F50B             MOV  prod+3,A
 3673                 ;
 3674  188D 7808             MOV   R0,#prod       ; result pointer in R0
 3675  188F 22               RET
 3676                 ;______________________________________
 3677                 ;division 32 bits/16 bits=16 bits + reste sur 16 bits (sans signe!)
 3678                 ;appel : div16
 3679                 ;entrées  :((R0)) sur 32 bits 
 3680                 ;          ((R1)) sur 16 bits
 3681                 ;sortie   :((R0)) quotient sur 32 bits
 3682                 ;         :((R1)) reste sur 16 bits
 3683                 ;R0 et R1 pointeurs avec @RX=lsb 
 3684                 ;
 3685  1890 8608      div16   MOV   prod+0,@R0
 3686  1892 08                INC   R0
 3687  1893 8609              MOV   prod+1,@R0
 3688  1895 08                INC   R0
 3689  1896 860A              MOV   prod+2,@R0
 3690  1898 08                INC   R0
 3691  1899 860B              MOV   prod+3,@R0
 3692  189B 8705              MOV   divi,@R1
 3693  189D 09                INC   R1
 3694  189E 8706              MOV   divi+1,@R1
 3695                 ;        
 3696  18A0 750C00    div16b MOV   prod+4,#00H     ; clear extension  approx. 1000 microsec
 3697  18A3 750D10           MOV   divcnt,#16      ; 15 normal steps, last step: remainder !
 3698  18A6 1218E6    DIVLP  LCALL SHR5
 3699  18A9 1218B7           LCALL TRYSUB          ; try and perform subtraction, results in CY
 3700  18AC 1218DA           LCALL SHLQ            ; shift CY into quotIENT
 3701  18AF D50DF4           DJNZ  divcnt,DIVLP
 3702  18B2 7803             MOV   R0,#quot       ; quotient pointer
 3703  18B4 790A             MOV   R1,#prod+2    ; remainder pointer
 3704  18B6 22               RET
 3705                 ;
 3706  18B7           TRYSUB EQU $
 3707  18B7 C3               CLR  C           ; no borrow
 3708  18B8 E50A             MOV  A,prod+2
 3709  18BA 9505             SUBB A,divi+0
 3710  18BC E50B             MOV  A,prod+3
 3711  18BE 9506             SUBB A,divi+1
 3712  18C0 E50C             MOV  A,prod+4    ; is accu extension
 3713  18C2 9400             SUBB A,#0
 3714  18C4 5001             JNC  SUBIT
 3715  18C6 22               RET
 3716  18C7 E50A      SUBIT  MOV  A,prod+2    ; now really subtract  , we have no borrow from before
 3717  18C9 9505             SUBB A,divi+0
 3718  18CB F50A             MOV  prod+2,A
 3719  18CD E50B             MOV  A,prod+3
 3720  18CF 9506             SUBB A,divi+1
 3721  18D1 F50B             MOV  prod+3,A
 3722  18D3 E50C             MOV  A,prod+4    ; is accu extension
 3723  18D5 9400             SUBB A,#0
 3724  18D7 F50C             MOV  prod+4,A
 3725  18D9 22               RET
 3726                 ;
 3727  18DA B3        SHLQ   CPL C
 3728  18DB E503             MOV  A,quot+0    ; use carry from before and shift into quotient
 3729  18DD 33               RLC  A
 3730  18DE F503             MOV  quot+0,A
 3731  18E0 E504             MOV  A,quot+1
 3732  18E2 33               RLC  A
 3733  18E3 F504             MOV  quot+1,A
 3734  18E5 22               RET
 3735                 ;
 3736  18E6           SHR5   EQU $
 3737  18E6 C3               CLR  C           ; shift 5 bytes = product+ACC 17 bit extension
 3738  18E7 E508             MOV  A,prod+0
 3739  18E9 33               RLC  A
 3740  18EA F508             MOV  prod+0,A
 3741  18EC E509             MOV  A,prod+1
 3742  18EE 33               RLC  A
 3743  18EF F509             MOV  prod+1,A
 3744  18F1 E50A             MOV  A,prod+2
 3745  18F3 33               RLC  A
 3746  18F4 F50A             MOV  prod+2,A
 3747  18F6 E50B             MOV  A,prod+3
 3748  18F8 33               RLC  A
 3749  18F9 F50B             MOV  prod+3,A
 3750  18FB E50C             MOV  A,prod+4
 3751  18FD 33               RLC  A
 3752  18FE F50C             MOV  prod+4,A
 3753  1900 22               RET
 3754                 ;        
 3755                 ;______________________________________
 3756                 ;valeur absolue d'un nombre sur 16 bits
 3757                 ;appel : abs16
 3758                 ;entrées  :((R0)) sur 16 bits 
 3759                 ;sortie   :((R0)) sur 16 bits
 3760                 ;          cy=1 si le nb était < 0
 3761                 ;RO pointeurs avec @RX=lsb 
 3762                 ;R0 inchangé
 3763                 ;
 3764  1901 08        abs16  INC  R0              ; is ABS set CY if negative
 3765  1902 E6               MOV  A,@R0
 3766  1903 18               DEC  R0              ; mod mbe 2010-03-30: also restore r0 if positive
 3767  1904 30E702           JNB  ACC.7,noneg1
 3768                 ;      DEC  R0              ; mod mbe 2010-03-30
 3769  1907 8002             SJMP neg16
 3770  1909 C3        noneg1 CLR  C
 3771  190A 22               RET
 3772                 ;______________________________________
 3773                 ;valeur négative d'un nombre sur 16 bits
 3774                 ;appel : neg16
 3775                 ;entrées  :((R0)) sur 16 bits 
 3776                 ;sortie   :((R0)) sur 16 bits
 3777                 ;RO pointeurs avec @RX=lsb 
 3778                 ;R0 inchangé
 3779                 ;
 3780                 ;neg16  MOV  A,@R0           ; set negative @ R0
 3781                 ;       XRL  A,#0FFH
 3782                 ;       ADD  A,#1
 3783                 ;       MOV  @R0,A
 3784                 ;       INC  R0
 3785                 ;       MOV  A,@R0
 3786                 ;       XRL  A,#0FFH
 3787                 ;       ADDC A,#0
 3788                 ;       MOV  @R0,A
 3789                 ;       SETB C
 3790                 ;       RET
 3791                 
 3792                 ; mod mbe 2010-03-30: no constant + also restore r0 
 3793  190B E4        neg16   CLR     A
 3794  190C C3                CLR     C
 3795  190D 96                SUBB    A,@R0
 3796  190E F6                MOV     @R0,A
 3797  190F 08                INC     R0
 3798  1910 E4                CLR     A
 3799  1911 96                SUBB    A,@R0
 3800  1912 F6                MOV     @R0,A
 3801  1913 18                DEC     R0
 3802  1914 D3                SETB    C
 3803  1915 22                RET
 3804                 
 3805                 ;________________________________________
 3806                 ;afficher en hexa 4 digit le contenu de dptr
 3807                 ;appel : hex16
 3808                 ;entrée : (dptr)
 3809                 ;procedure utilisée : byte
 3810                 ;
 3811  1916           hex16   equ     $
 3812  1916 E583              mov     a,dph
 3813  1918 12175C            lcall   byte
 3814  191B E582              mov     a,dpl
 3815  191D 12175C            lcall   byte
 3816  1920 22                ret
 3817                 ;_______________________________________
 3818                 ;Afficher un nombre de 32 bits en décimal
 3819                 ;appel : dsp32d
 3820                 ;entrées  :((R0)) sur 32 bits 
 3821                 ;RO pointeurs avec @RX=lsb 
 3822                 ;Registres mofdifiés : A, PSW, R0..R7
 3823                 ;Procédures utilisées: iniacc, bindec, dspx
 3824                 ;
 3825  1921           dsp32d EQU $            ; long 32 bit dec display of value at R0
 3826  1921 12196B           LCALL iniacc      ; prepare conversion buffer
 3827  1924 121983           LCALL bindec      ; convert 4 bytes
 3828  1927 121983           LCALL bindec
 3829  192A 121983           LCALL bindec
 3830  192D 121983           LCALL bindec
 3831  1930 790D             MOV   R1,#acc_a+5
 3832  1932 7E05             MOV   R6,#5
 3833  1934 1219DE           LCALL dspx      ; display string
 3834  1937 22               RET
 3835                 ;______________________________________
 3836                 ;Afficher un nombre de 32 bits en hexadécimal
 3837                 ;appel : dsp32h
 3838                 ;entrées  :((R0)) sur 32 bits 
 3839                 ;RO pointeurs avec @RX=lsb 
 3840                 ;Registres mofdifiés : A, PSW, R0..R7
 3841                 ;Procédures utilisées: byte
 3842                 ;
 3843  1938           dsp32h EQU $            ; long 32 bit hex display of value at R0
 3844  1938 08               INC   R0
 3845  1939 08               INC   R0
 3846  193A 08               INC   R0
 3847  193B E6               MOV   A,@R0      ; point to most significant byte
 3848  193C 12175C           LCALL byte
 3849  193F 18               DEC   R0
 3850  1940 E6               MOV   A,@R0
 3851  1941 12175C           LCALL byte
 3852  1944 18               DEC   R0
 3853  1945 E6               MOV   A,@R0
 3854  1946 12175C           LCALL byte
 3855  1949 18               DEC   R0
 3856  194A E6               MOV   A,@R0
 3857  194B 12175C           LCALL byte
 3858  194E 22               RET
 3859                 ;______________________________________
 3860                 ;Afficher un nombre de 16 bits en hexadécimal
 3861                 ;appel : dsp16h
 3862                 ;entrées  :((R0)) sur 16 bits 
 3863                 ;RO pointeurs avec @RX=lsb 
 3864                 ;Registres mofdifiés : A, PSW, R0..R7
 3865                 ;Procédures utilisées: byte
 3866                 ;
 3867  194F           dsp16h EQU $            ; 16 bit display hexadecimal
 3868  194F 08               INC R0           ; point to higher byte
 3869  1950 E6               MOV   A,@R0
 3870  1951 12175C           LCALL byte       ; display
 3871  1954 18               DEC R0
 3872  1955 E6               MOV   A,@R0
 3873  1956 12175C           LCALL byte       ; display lower byte
 3874  1959 22               RET
 3875                 ;______________________________________
 3876                 ;Afficher un nombre de 16 bits en décimal
 3877                 ;appel : dsp16d
 3878                 ;entrées  :((R0)) sur 16 bits 
 3879                 ;RO pointeurs avec @RX=lsb 
 3880                 ;Registres mofdifiés : A, PSW, R0..R7
 3881                 ;Procédures utilisées: iniacc, bindec, dspx
 3882                 ;
 3883  195A           dsp16d EQU   $          ; word 16 bit dec display of value at R0
 3884  195A 12196B           LCALL iniacc      ; prepare conversion
 3885  195D 121983           LCALL bindec      ; convert two bytes
 3886  1960 121983           LCALL bindec
 3887  1963 790B             MOV   R1,#acc_a+3
 3888  1965 7E03             MOV   R6,#3
 3889  1967 1219DE           LCALL dspx      ; display 3 BCD bytes so 65535 fits
 3890  196A 22               RET
 3891                 ;______________________________________
 3892                 ;init conversion  bin -> déc 
 3893                 ;acc_a <- 0 et acc_b <- 1
 3894                 ;
 3895  196B 7400      iniacc  MOV   A,#0
 3896  196D F508             MOV   acc_a+0,A 
 3897  196F F509             MOV   acc_a+1,A
 3898  1971 F50A             MOV   acc_a+2,A
 3899  1973 F50B             MOV   acc_a+3,A
 3900  1975 F50C             MOV   acc_a+4,A
 3901  1977 750301           MOV   acc_b+0,#1
 3902  197A F504             MOV   acc_b+1,A
 3903  197C F505             MOV   acc_b+2,A
 3904  197E F506             MOV   acc_b+3,A
 3905  1980 F507             MOV   acc_b+4,A
 3906  1982 22               RET
 3907                 ;______________________________________
 3908                 ;Conversion bin -> déc
 3909                 ;entrées  :((R0)) sur 8 bits
 3910                 ;RO est incrémenté pour conversions en cascade
 3911                 ;Procédures utilisées: byte
 3912                 ;
 3913  1983 E6        bindec  MOV   A,@R0      ; convert Byte at R0 , inc R0
 3914  1984 08               INC   R0
 3915  1985 FA        DCNVb1 MOV   R2,A       ; convert Byte ACC
 3916  1986 7E08             MOV   R6,#8      ; convert R2 using acc_a and acc_b
 3917  1988 EA        dCNV1  MOV   A,R2       ; get bit from R2
 3918  1989 13               RRC   A
 3919  198A FA               MOV   R2,A
 3920  198B 5003             JNC   dCNV2
 3921  198D 1219BA           LCALL ADD1       ; if CY add acc_b to acc_a using BCD
 3922  1990 121996    dCNV2  LCALL DOUBL1     ; acc_b:=2*acc_b
 3923  1993 DEF3             DJNZ  R6,dCNV1   ; loop until all 8 bits done
 3924  1995 22               RET
 3925                 ;
 3926  1996 E503      DOUBL1 MOV   A,acc_b+0  ; acc_b:=2*acc_b , BCD coded 5 bytes
 3927  1998 2503             ADD   A,acc_b+0
 3928  199A D4               DA    A
 3929  199B F503             MOV   acc_b+0,A
 3930  199D E504             MOV   A,acc_b+1
 3931  199F 3504             ADDC  A,acc_b+1
 3932  19A1 D4               DA    A
 3933  19A2 F504             MOV   acc_b+1,A
 3934  19A4 E505             MOV   A,acc_b+2
 3935  19A6 3505             ADDC  A,acc_b+2
 3936  19A8 D4               DA    A
 3937  19A9 F505             MOV   acc_b+2,A
 3938  19AB E506             MOV   A,acc_b+3
 3939  19AD 3506             ADDC  A,acc_b+3
 3940  19AF D4               DA    A
 3941  19B0 F506             MOV   acc_b+3,A
 3942  19B2 E507             MOV   A,acc_b+4
 3943  19B4 3507             ADDC  A,acc_b+4
 3944  19B6 D4               DA    A
 3945  19B7 F507             MOV   acc_b+4,A
 3946  19B9 22               RET
 3947                 ;
 3948  19BA E508      ADD1   MOV   A,acc_a+0  ; acc_a:=acc_a+acc_b , bcd coded 5 bytes
 3949  19BC 2503             ADD   A,acc_b+0
 3950  19BE D4               DA    A
 3951  19BF F508             MOV   acc_a+0,A
 3952  19C1 E509             MOV   A,acc_a+1
 3953  19C3 3504             ADDC  A,acc_b+1
 3954  19C5 D4               DA    A
 3955  19C6 F509             MOV   acc_a+1,A
 3956  19C8 E50A             MOV   A,acc_a+2
 3957  19CA 3505             ADDC  A,acc_b+2
 3958  19CC D4               DA    A
 3959  19CD F50A             MOV   acc_a+2,A
 3960  19CF E50B             MOV   A,acc_a+3
 3961  19D1 3506             ADDC  A,acc_b+3
 3962  19D3 D4               DA    A
 3963  19D4 F50B             MOV   acc_a+3,A
 3964  19D6 E50C             MOV   A,acc_a+4
 3965  19D8 3507             ADDC  A,acc_b+4
 3966  19DA D4               DA    A
 3967  19DB F50C             MOV   acc_a+4,A
 3968  19DD 22               RET
 3969                 ;______________________________________
 3970                 ;Afficher un nombre de (R6) chiffres 
 3971                 ;appel : dspx
 3972                 ;entrées  :((R1)) nombre à afficher, R1 est décrémenté car on affiche d'abord le msb
 3973                 ;          Au départ R0 pointe une case au dessus du MSB
 3974                 ;          par exemple pour afficher 3 chiffres (R6)=3 et (R0)=(adr+3) 
 3975                 ;          pour afficher respectivement (adr+2), (adr+1) et (adr)
 3976                 ;         :(R6)=nb de chiffres
 3977                 ;Procédures utilisées: byte
 3978                 ;
 3979  19DE 00        dspx   NOP              ; display R6 bytes in decreasing order @R1
 3980  19DF 19        dDSPlp DEC   R1         ; used for decimal or hexadecimal output
 3981  19E0 E7               MOV   A,@R1
 3982  19E1 12175C           LCALL byte
 3983  19E4 DEF9             DJNZ  R6,dDSPlp
 3984  19E6 22               RET
 3985                 ;______________________________________
 3986                 ;snap resisters
 3987                 ;appel : snap
 3988                 ;fonction :afficher le contenu actuel des registres
 3989                 ;entrée   :néant
 3990                 ;sortie   :néant
 3991                 ;procedures : stxt,byte,blank
 3992                 ;
 3993  19E7           snap    EQU $                ; display snapshot
 3994  19E7 858211            MOV   DPLSAV,DPL     ; PSW and ACC have already been saved
 3995  19EA 858310            MOV   DPHSAV,DPH
 3996  19ED 900080            MOV   DPTR,#SNAPTXT
 3997  19F0 12174C            LCALL stxt
 3998                 ;
 3999  19F3 E50F              MOV   A,ACCSAV       ; display ACCUS
 4000  19F5 12175C            LCALL byte
 4001  19F8 121758            LCALL blank
 4002                 ;
 4003  19FB E5F0              MOV   A,B
 4004  19FD 12175C            LCALL byte
 4005  1A00 121758            LCALL blank
 4006                 ;
 4007  1A03 121758            LCALL blank          ; PSW comes from PSWSAV
 4008  1A06 E50E              MOV   A,PSWSAV
 4009  1A08 12175C            LCALL byte
 4010  1A0B 121758            LCALL blank
 4011                 ;
 4012  1A0E 121758            LCALL blank          ; display SP
 4013  1A11 E581              MOV   A,SP
 4014  1A13 12175C            LCALL byte
 4015  1A16 121758            LCALL blank
 4016                 ;
 4017  1A19 E510              MOV   A,DPHSAV       ; display DPH,DPL
 4018  1A1B 12175C            LCALL byte
 4019  1A1E E511              MOV   A,DPLSAV
 4020  1A20 12175C            LCALL byte
 4021                 ;
 4022  1A23 121758            LCALL blank          ; display R0 .. R7
 4023  1A26 E8                MOV   A,R0
 4024  1A27 12175C            LCALL byte
 4025  1A2A 121758            LCALL blank
 4026  1A2D E9                MOV   A,R1
 4027  1A2E 12175C            LCALL byte
 4028  1A31 121758            LCALL blank
 4029  1A34 EA                MOV   A,R2
 4030  1A35 12175C            LCALL byte
 4031  1A38 121758            LCALL blank
 4032  1A3B EB                MOV   A,R3
 4033  1A3C 12175C            LCALL byte
 4034  1A3F 121758            LCALL blank
 4035  1A42 EC                MOV   A,R4
 4036  1A43 12175C            LCALL byte
 4037  1A46 121758            LCALL blank
 4038  1A49 ED                MOV   A,R5
 4039  1A4A 12175C            LCALL byte
 4040  1A4D 121758            LCALL blank
 4041  1A50 EE                MOV   A,R6
 4042  1A51 12175C            LCALL byte
 4043  1A54 121758            LCALL blank
 4044  1A57 EF                MOV   A,R7
 4045  1A58 12175C            LCALL byte
 4046  1A5B 121772            LCALL crlf
 4047                 ;
 4048  1A5E 851083            MOV   DPH,DPHSAV
 4049  1A61 851182            MOV   DPL,DPLSAV
 4050  1A64 E50F              MOV   A,ACCSAV
 4051  1A66 850ED0            MOV   PSW,PSWSAV
 4052  1A69 22                RET
 4053                 ;______________________________________
 4054                 ;tester si un caractère est présent sur l'uart
 4055                 ;appel : testc
 4056                 ;sortie : (a)=0 pas de caract. (a)=1 caract présent
 4057                 ;
 4058  1A6A 209803    testc   jb      scon.0,isthere
 4059  1A6D 7400              mov     a,#0
 4060  1A6F 22                ret
 4061  1A70 7401      isthere mov     a,#1
 4062  1A72 22                ret
 4063                 ;_______________________________________
 4064                 ;
 4065                 ;_______________________________________
 4066                 ;
 4067  0000                     rseg      const
 4068                 ;
 4069  0000 4175746F  UPTXT  DB    'Auto-run usercode...',CR,LF,0
       0004 2D72756E
       0008 20757365
       000C 72636F64
       0010 652E2E2E
       0014 0D0A00
 4070  0017 494E5445  ITXT   DB    'INTERRUPT: ',0
       001B 52525550
       001F 543A2000
 4071  0023 4945300D  ITXT1  DB    'IE0',CR,LF,0
       0027 0A00
 4072  0029 4945310D  ITXT2  DB    'IE1',CR,LF,0
       002D 0A00
 4073  002F 5446300D  ITXT3  DB    'TF0',CR,LF,0
       0033 0A00
 4074  0035 5446310D  ITXT4  DB    'TF1',CR,LF,0
       0039 0A00
 4075  003B 52492F54  ITXT5  DB    'RI/TI',CR,LF,0
       003F 490D0A00
 4076  0043 53490D0A  ITXT6  DB    'SI',CR,LF,0
       0047 00
 4077  0048 4354300D  ITXT7  DB    'CT0',CR,LF,0
       004C 0A00
 4078  004E 4354310D  ITXT8  DB    'CT1',CR,LF,0
       0052 0A00
 4079  0054 4354320D  ITXT9  DB    'CT2',CR,LF,0
       0058 0A00
 4080  005A 4354330D  ITXT10 DB    'CT3',CR,LF,0
       005E 0A00
 4081  0060 41444349  ITXT11 DB    'ADCI',CR,LF,0
       0064 0D0A00
 4082  0067 434D300D  ITXT12 DB    'CM0',CR,LF,0
       006B 0A00
 4083  006D 434D310D  ITXT13 DB    'CM1',CR,LF,0
       0071 0A00
 4084  0073 434D320D  ITXT14 DB    'CM2',CR,LF,0
       0077 0A00
 4085  0079 54324230  ITXT15  DB   'T2B0',CR,LF,0
       007D 0D0A00
 4086  0080 0D0A2041  SNAPTXT DB    CR,LF,' A  B PSW  SP DPTR R0 R1 R2 R3 R4 R5 R6 R7'
       0084 20204220
       0088 50535720
       008C 20535020
       0090 44505452
       0094 20523020
       0098 52312052
       009C 32205233
       00A0 20523420
       00A4 52352052
       00A8 36205237
 4087  00AC 0D0A00            DB    CR,LF,0
 4088  00AF 0D0A6572  txterror db   CR,LF,'error',0
       00B3 726F7200
 4089                 
 4090                 
 4091  00B7 0D0A      TITLE:  db      0Dh,0Ah
 4092  00B9 2A2A2047          db      '** Gmon51 v2.0b3 - (c) 15-Mar-2015 GmEsoft **',0Dh,0Ah,22h
       00BD 6D6F6E35
       00C1 31207632
       00C5 2E306233
       00C9 202D2028
       00CD 63292031
       00D1 352D4D61
       00D5 722D3230
       00D9 31352047
       00DD 6D45736F
       00E1 6674202A
       00E5 2A0D0A22
 4093  00E9 0A        MSYSTEM:db      0Ah
 4094  00EA 53797374          db      'System: "'
       00EE 656D3A20
       00F2 22
 4095  00F3 38303531  M8052:  db      '8051/52"'
       00F7 2F353222
 4096  00FB 38304335  M80C552:db      '80C552"'
       00FF 353222
 4097  0102 202D2044  MUSING: db      ' - Debug using INT"'
       0106 65627567
       010A 20757369
       010E 6E672049
       0112 4E5422
 4098  0115 202B2053  MSERINT:db      ' + SERINT"'
       0119 4552494E
       011D 5422
 4099                 
 4100  011F                   end

    Errors:  None          #########
    Bytes:   7054          # gmon2 #
    CRC:     A0EF          #########

                  Symbol and Cross Reference Table
                  ================================

  Symbol    Value Type  Defline   Refline

                        Segment Definitions
                        ===================

  code      1A73  S01R    296     3094

  const     011F  S03R   4067   

  datasim   0022  S02S   3068   

  ramcoda   0100  S00R    227   


                        External Symbols
                        ================


                        Public Symbols
                        ==============

  inhexacc  0F44  R01E   2402     2401  2448  2452  2457  2462  2470  2477


                        Local Symbols
                        =============

  ACCSAV    000F  R02    3089     3999  4050

  ACK       0006  A      3062   

  ADD1      19BA  R01    3948     3921

  BREAK     0001  A      1794     2142  2271

  CLRSCR    0A17  R01    1846     1865

  CNEXT1    0AA4  R01    1927     1905

  CNEXT16   0AB2  R01    1939     1913

  CNOTA     0AD1  R01    1961     1958

  CNOTBREAK 
            0A9C  R01    1923     1920

  CNOTC     0A70  R01    1895     1892

  CNOTD     0A6B  R01    1891     1888

  CNOTESC   0A96  R01    1919     1896

  CNOTESC2  0A7C  R01    1901     1898

  CNOTESC3  0A87  R01    1907     1904

  CNOTESC4  0A8C  R01    1911     1908

  CNOTESC5  0A91  R01    1915     1912

  CNOTM     0ACB  R01    1957     1954

  CNOTMINUS 
            0AAF  R01    1937     1932

  CNOTPOINT 
            0ABA  R01    1945     1938

  CNOTSEMICOL
            0AA8  R01    1931     1926

  CNOTUS    0AC6  R01    1953     1924

  CNOTX     0A66  R01    1887     1883

  COMC      05AA  R01    1088     1003  1032

  COMC0     05C2  R01    1103     1101

  COMC1     05C7  R01    1106     1102

  COMC2     05C9  R01    1108     1105

  COMD      08FA  R01    1677     1053

  COMD0     08FE  R01    1679     1714

  COMD1     0910  R01    1687     1681  1696

  COMD2     0926  R01    1700     1712

  COMD3     0934  R01    1708     1703  1705

  COMD4     0936  R01    1709     1707

  COMG      05D7  R01    1120     1006  1044

  COMH      0899  R01    1625     1047

  COMHX     08B1  R01    1636     1628  1631

  COMI      05D5  R01    1118     1009  1029  1083

  COMM30    04F3  R01    1019     1017

  COMMAND   03DB  R01     865     1038  1377  1445  1513  1535  1553  1564
                                  1593  1622

  COMMAND2  0487  R01     948     1064  1596  1636  1715  2362

  COMMAND3  04E5  R01    1013      989   995  1008  1674  1755

  COMNOC    050E  R01    1033     1031

  COMNOD    0537  R01    1054     1052

  COMNOG    0525  R01    1045     1043

  COMNOH    052B  R01    1048     1046

  COMNOI    0508  R01    1030     1028

  COMNOR    051F  R01    1042     1040

  COMNOS    0531  R01    1051     1049

  COMNOSLASH
            0502  R01    1027     1025

  COMNOT    0513  R01    1036     1034

  COMNOV    053D  R01    1057     1055

  COMNOX    0519  R01    1039     1037

  COMNOZ    04FC  R01    1024     1022

  COMR      0867  R01    1599     1041

  COMR1     086F  R01    1603     1611

  COMR2     0889  R01    1615     1621

  COMS      08B4  R01    1639     1050

  COMS1     08D5  R01    1654     1646

  COMS2     08E5  R01    1664     1668

  COMSLASH  07E0  R01    1524     1026

  COMSX     08EF  R01    1669     1653

  COMT      058F  R01    1073     1035

  COMT1     05A7  R01    1084     1082

  COMV      0944  R01    1718     1056

  COMV0     094C  R01    1722     1754

  COMV1     095B  R01    1732     1730

  COMVD     09A6  R01    1773     1765  1768  1771

  COMVX     0971  R01    1746     1731  1734  1738  1744

  COMVY     0979  R01    1751     1777

  COMVZ     0983  R01    1756     1750

  CPREV1    0AAB  R01    1933     1909

  CPREV16   0ABD  R01    1947     1917

  CR        000D  A      3060     3260  3440  4069  4071  4072  4073  4074
                                  4075  4076  4077  4078  4079  4080  4081
                                  4082  4083  4084  4085  4086  4087  4088

  DADDR     1101  R01    2664     2582  2798

  DADDR0    110A  R01    2668     2684

  DASM0     1008  R01    2522     2520

  DASM1     100B  R01    2524      411   972  1652  1666

  DASM2     102A  R01    2539     2537

  DASM21    1051  R01    2563     2557  2561

  DASM22    1081  R01    2584     2575

  DASM23    108B  R01    2590     2586

  DASM24    1093  R01    2593     2589

  DASM25    109F  R01    2599     2595

  DASM3     10C2  R01    2618     2583  2592  2605  2613

  DASMLP    0FFC  R01    2514     2619

  DASMSK    1055  R01    2565   

  DBGHLP    0D9F  R01    2360     1059

  DBGINT    0001  A       192      223   553   567   813   838   839   851
                                  1092  1119  1188  1189  1293  1296  3480
                                  3524

  DBITAD    1111  R01    2676     2785  2824

  DCNVb1    1985  R01    3915   

  DDISA     024E  R01     564      412   576   580   593   595   607   636
                                   682   688   814  1020  1063  1075  1443
                                  1451  1511  1521  1526  1557  1578  1605
                                  1607  1609  1620  1709  1800  1802  1820
                                  1829  1833  1842  1856  1858  1877  1972
                                  1973  1975  1976  1985  1986  1996  2017
                                  2036  2325  2413  2447  2482  2485  2580
                                  2608  2615  2633  2643  2686  2690  2762
                                  2771  2776  2780  2790  2802  2822  2834

  DDISH     0262  R01     579     2598  2670  2793  2841  2861  2874

  DDISNL    026F  R01     591      413   823   867   873   949  1089  1121
                                  1600  1612  1644  1682  1719  1776  2021
                                  2618

  DDISSP    025E  R01     575      586  1685  1686  1693  1759

  DEBUGSP   00C0  A       214      866

  DHEXA     02AC  R01     646     2597  2669  2792

  DHEXB     02B0  R01     654      414   619   621   631   633   887   891
                                   895   899   910   929   932   935   938
                                   941   944  1618  1684  1689  1692  2548
                                  2721  2723

  DHEXD0    02A0  R01     633      648

  DHEXDP    0297  R01     628     1758  2529  2840  2860  2873

  DHEXN     02B8  R01     666      657

  DHEXN0    02C3  R01     673      668   669   670

  DHEXN1    02D9  R01     685      676   678   679

  DHEXOP    1132  R01    2693     2554  2558

  DHEXOP0   1180  R01    2724     2697  2698  2699  2700  2704  2705  2706
                                  2707  2709

  DHEXOP1   117A  R01    2722     2562  2701  2702  2703  2708  2712  2716
                                  2719

  DHEXOP2   1174  R01    2720     2710

  DHEXOP3   116A  R01    2714     2711

  DHEXW     028E  R01     617      415   883   907   914   918   922   926

  DHEXW1    02AB  R01     638      634

  DHITKI    021D  R01     529      417  2523

  DHITKI0   0235  R01     546      531   540   559

  DHITKI1   022C  R01     539      534

  DHITKI2   022F  R01     542      544

  DIVLP     18A6  R01    3698     3701

  DKYWR0    10CA  R01    2626     2652  2659

  DKYWR1    10DA  R01    2636     2645

  DKYWR2    10E6  R01    2643     2641

  DKYWR3    10EC  R01    2647     2630  2650

  DKYWR5    10F6  R01    2654     2628

  DKYWRD    10C8  R01    2625     2570  2666  2678  2683

  DKYWRX    1100  R01    2661     2640  2667  2679

  DOPA      11D4  R01    2760     2732

  DOPAD0    123B  R01    2835     2847  2850

  DOPADDR   124D  R01    2844     2745

  DOPATADPTR
            1213  R01    2805     2739

  DOPATAPC  1219  R01    2810     2740

  DOPATDPTR 
            1230  R01    2827     2743

  DOPATRX   11D9  R01    2765     2733

  DOPBITADDR
            11F4  R01    2783     2735

  DOPC      120E  R01    2801     2738

  DOPDATA   11FA  R01    2788     2736

  DOPDATAADDR
            1208  R01    2796     2578  2737

  DOPDATAW  1236  R01    2832     2744

  DOPDPTR   121F  R01    2815     2741

  DOPNONE   11D3  R01    2756     2731

  DOPNOTBITADDR
            1225  R01    2820     2742

  DOPRND    1181  R01    2727     2602  2610

  DOPRX     11E7  R01    2774     2734

  DOPSA1    1275  R01    2868     2866

  DOPSADDR  126D  R01    2864     2616  2746

  DOUBL1    1996  R01    3926     3922

  DPHSAV    0010  R02    3090     3995  4017  4048

  DPLSAV    0011  R02    3091     3580  3585  3994  4019  4049

  DSPC      07DB  R01    1519      884   888   892   896   900   908   911
                                   915   919   923   927   930   933   936
                                   939   942

  DTABS     0266  R01     583     2531  2566  2572

  DTABS0    0269  R01     586      587

  DTEXT     027E  R01     600      796   798   810   812   872  1015  1626
                                  1773  1873  2032  2361  2492  2591  2767
                                  2807  2812  2817  2829

  DTEXT0    0280  R01     601      608

  DTEXT1    0288  R01     606      603

  EC1       1692  R01    3263     3260

  ENTER     000D  A      1795     2145  2274

  ERRCOM    0543  R01    1061     1058  1081  1085

  ESC       001B  A      1789     1799  1896  1898  2049  2059  2177  2187

  ESCANSI   09D2  R01    1798     1825  1838  1854

  ETXT      1757  R01    3407     3403

  FETCH     0FEC  R01    2504     2532  2576  2720  2722  2784  2791  2797
                                  2823  2835  2837  2851  2865

  GETC0     17A6  R01    3492     3520

  GETC1     17A9  R01    3494   

  GETC2     17D1  R01    3518     3502

  GETCC     17D7  R01    3523     3494

  GETCC1    17E0  R01    3527     3525  3527

  GETCX     17D6  R01    3521     3495

  GOON2     1725  R01    3370     3367

  GOTOXY    09F4  R01    1824     1849  1880  1969  2047  2175  2305  2312
                                  2331

  HEXLEN    0000  R02    3073   

  HEXOUT    176E  R01    3432     3429

  HEXSUM    0001  R02    3074   

  HLPDBG    0DA8  R01    2364     2360

  INIT      03CE  R01     855      537   561  1899  1921

  INT       06C0  R01    1294     1218  1289  1432  3492

  INT0DBG   001E  A       210      223   302

  INT1DBG   001F  A       211      310

  INTBIT    001F  A       223      837  1187  1298

  ISHEX     1730  R01    3376     3383

  ITXT      0017  R03    4070      424   430   436   442   448   457   463
                                   469   475   481   487   493   499   505
                                   514

  ITXT1     0023  R03    4071      426

  ITXT10    005A  R03    4080      483

  ITXT11    0060  R03    4081      489

  ITXT12    0067  R03    4082      495

  ITXT13    006D  R03    4083      501

  ITXT14    0073  R03    4084      507

  ITXT15    0079  R03    4085      516

  ITXT2     0029  R03    4072      432

  ITXT3     002F  R03    4073      438

  ITXT4     0035  R03    4074      444

  ITXT5     003B  R03    4075      450

  ITXT6     0043  R03    4076      459

  ITXT7     0048  R03    4077      465

  ITXT8     004E  R03    4078      471

  ITXT9     0054  R03    4079      477

  LEFTBRA   005B  A      1790     1801

  LF        000A  A      3061     3262  3442  4069  4071  4072  4073  4074
                                  4075  4076  4077  4078  4079  4080  4081
                                  4082  4083  4084  4085  4086  4087  4088

  M8052     00F3  R03    4095   

  M80C552   00FB  R03    4096      802

  MAB       11D0  R01    2753     2590

  MATADP    11C2  R01    2751     2806

  MATAPC    11CA  R01    2752     2811

  MATDP     11B9  R01    2748     2828

  MATRX     11BF  R01    2750     2766

  MBADRAM   09B9  R01    1781     1766

  MCKERR    0FD8  R01    2500     2491

  MCOMMAND  058A  R01    1069     1014

  MDPTR     11BA  R01    2749     2816

  MEMODE    0D95  R01    2357     2031

  MINUS     002D  A      1793   

  MNORAM    09B2  R01    1779     1763

  MODE      00E8  A       216      833   861   987  1090  1109  1122  1230
                                  1242  1264  1357  1407  3498

  MRAMCODA  09C7  R01    1785     1772

  MRAMDATA  09C1  R01    1783     1769

  MREADY    0F39  R01    2394     1625

  MSERINT   0115  R03    4098   

  MSFR      054B  R01    1066      871

  MSYSTEM   00E9  R03    4093      797

  MUSING    0102  R03    4097      811

  MVMODE    0D8B  R01    2355     1872

  NACALL    000F  A      2950     2714  2994  3002  3010  3018  3026  3034
                                  3042  3050

  NACK      0015  A      3063   

  NADD      0002  A      2936     2999  3000  3001

  NADDC     0003  A      2937     3003  3004  3005

  NAJMP     000E  A      2949     2717  2990  2998  3006  3014  3022  3030
                                  3038  3046

  NANL      0005  A      2939     3010  3011  3012  3013  3022  3034

  NCJNE     000A  A      2944     2560  2612  3035  3036  3037

  NCLR      0020  A      2968     3038  3047

  NCPL      001F  A      2967     3034  3051

  NDA       002B  A      2980     3043

  NDB       0027  A      2975     2593  3031

  NDEC      0001  A      2935     2995  2996  2997

  NDIV      0025  A      2973     2587  3023

  NDJNZ     000C  A      2946     3043  3044  3045

  NIBBLE    1764  R01    3427     3425

  NINC      0000  A      2934     2991  2992  2993  3030

  NJB       0013  A      2954     2998

  NJBC      0012  A      2953     2994

  NJC       0015  A      2956     3006

  NJMP      002D  A      2982     3018

  NJNB      0014  A      2955     3002

  NJNC      0016  A      2957     3010

  NJNZ      0018  A      2959     3018

  NJZ       0017  A      2958     3014

  NLCALL    0011  A      2952     2845  2994

  NLJMP     0010  A      2951     2848  2990

  NMOV      0007  A      2941     3019  3020  3021  3023  3024  3025  3026
                                  3030  3031  3032  3033  3047  3048  3049
                                  3051  3052  3053

  NMOVC     001E  A      2966     3022  3026

  NMOVM     0008  A      2942     2573  3023

  NMOVX     0022  A      2970     3046  3050

  NMUL      0026  A      2974     2584  3031

  NNOP      000D  A      2948     2990

  NORI      0653  R01    1222     1210

  NORL      0004  A      2938     3006  3007  3008  3009  3018  3030

  NOSERINT  064F  R01    1219     1214

  NPOP      002A  A      2979     3042

  NPUSH     0028  A      2977     3038

  NRET      0023  A      2971     2998

  NRETI     0024  A      2972     3002

  NRL       001C  A      2964     2998

  NRLC      001D  A      2965     3002

  NRR       001A  A      2962     2990

  NRRC      001B  A      2963     2994

  NSETB     0021  A      2969     3042

  NSJMP     0019  A      2960     3022

  NSUBB     0009  A      2943     3027  3028  3029

  NSWAP     0029  A      2978     3039

  NXCH      000B  A      2945     3039  3040  3041

  NXCHD     002C  A      2981     3043

  NXRL      0006  A      2940     3014  3015  3016  3017

  OK1       16AE  R01    3284     3281

  OK16      164C  R01    3201     3198

  OK1d      16DA  R01    3315     3312

  OUTBCD    09DD  R01    1807     1827  1831  1840

  OUTBCD2   09E5  R01    1812     1810  2309

  OUTBCD3   09EA  R01    1815     1814

  OUTBCD4   09EE  R01    1818     1816

  OUTHEX    09DD  R01    1806     1980  1983  1990  1993

  P80C552   0001  A       195      242   323   454   745   800

  PAUTO     0091  A       193      712

  PCON      0087  A       200      702

  POINT     002E  A      1792     2009  2318

  PSWSAV    000E  R02    3088     4008  4051

  RCAP2H    00CB  A       203      924

  RCAP2L    00CA  A       204      925

  RDEBUG    03B9  R01     831   

  RESUME    05DD  R01    1124     1107  1115  1374

  RESUMEX   0638  R01    1205     1201

  RETIFLG   001C  A       208     1201  1202  1217  1248  1288  1292  1431

  RETURN    0731  R01    1379     1369

  RHEXW     0766  R01    1434     1532  1546  1561  1590  1643  1649

  RHEXW0    076D  R01    1441     1449  1465  1479  1504

  RHEXW1    0779  R01    1446     1444

  RHEXW2    0796  R01    1466     1447

  RHEXW4    079D  R01    1471     1467

  RHEXW5    07A2  R01    1474     1472

  RHEXW6    07A7  R01    1477     1475

  RHEXW7    07B4  R01    1486     1483

  RHEXW8    07AC  R01    1480     1478

  RHEXWX    0799  R01    1468     1473  1476

  SAVERAM   00D0  A       215      953   975

  SAVERAM1  0493  R01     956      961

  SAVERAM2  04B1  R01     978      983

  SAVEREG   00F0  A       219     1151  1174  1306  1382  1425  1585  1614

  SAVERET   00EE  A       218     1269  1363  1394  3503

  SAVESFR   00F8  A       220      824   858   876   964  1093  1125  1128
                                  1331  1347  1386  1416  1528  1538  1542
                                  1567  1571  1632  1655

  SAVESP    00ED  A       217     1275  1361  3509

  SEMICOL   003B  A      1791     1828

  SERINT    0000  A       194      816   841  1178  1191

  SFRNOTA   07F8  R01    1536     1527

  SFRNOTB   07FF  R01    1540     1537

  SFRNOTD   0815  R01    1554     1541

  SFRNOTP   083F  R01    1575     1555

  SFRNOTP1  082F  R01    1565     1558

  SFRNOTPC  0836  R01    1569     1566

  SFRNOTPS  083D  R01    1573     1570

  SFRNOTR   0864  R01    1594     1576

  SFRNOTX   0864  R01    1595     1574  1581  1583

  SHLQ      18DA  R01    3727     3700

  SHR5      18E6  R01    3736     3698

  SINTDBG   001D  A       209      319  1180  1299  3525

  SNAPTXT   0080  R03    4086     3996

  SRET1     1801  R01    3557     3546

  SRET2     181A  R01    3577     3567

  START     02DF  R01     699      297   522

  STOP1     021A  R01     522      428   434   440   446   452   461   467
                                   473   479   485   491   497   503   509
                                   518

  SUBIT     18C7  R01    3716     3714

  T2CON     00C8  A       205      934

  TBITS     12E8  R01    2911     2676

  TEXTATTR  0A0A  R01    1837     1851  1853  2043  2054  2056  2171  2182
                                  2184

  TH2       00CD  A       201      920

  THOVEC    113A  R01    2697     2693

  TIME0     181B  R01    3580     3575

  TIME0L    181F  R01    3582     3585

  TITLE     00B7  R03    4091      795

  TL2       00CC  A       202      921

  TMNEMO    1368  R01    2932     2569

  TOPCOD    13FD  R01    2989     2534

  TOPVEC    1189  R01    2731     2727

  TRACE1    04CD  R01     997      990   992

  TRACE2    04D3  R01    1001      999

  TRACE3    04D9  R01    1004     1002

  TRACE4    04DF  R01    1007     1005

  TRYSUB    18B7  R01    3706     3699

  TSFRS     1284  R01    2880     2664  2682

  UPC1      1793  R01    3470     3463

  UPC2      1790  R01    3468     3465

  UPDATEB   07EB  R01    1529     1539

  UPDATEW   0804  R01    1543     1568  1572

  UPTXT     0000  R03    4069      720

  VEC       0001  A       191      228

  VIEWHEXEND
            0B45  R01    2024     2020

  VIEWPAGE  0AD4  R01    1965     1869

  VLNOTD    0AED  R01    1978     1974

  VLOOP1    0AF2  R01    1981     1977

  VLOOPA    0B23  R01    2002     2018

  VLOOPA0   0B2B  R01    2006     2005

  VLOOPA1   0B2D  R01    2008     2015

  VLOOPA2   0B31  R01    2012     2007

  VLOOPA3   0B34  R01    2014     2013

  VLOOPA4   0B36  R01    2016     2010

  VLOOPH    0B02  R01    1988     1997

  VLOOPL    0ADA  R01    1970     2022

  WAITCHR   07C9  R01    1507     1531  1545  1560  1589

  WAITCHR0  07CB  R01    1509     1515

  WAITCHR1  07D7  R01    1514     1512

  WAITKI    0236  R01     550      416   543  1016  1074  1078  1442  1510
                                  1525  1556  1577  1882  1897  1903  1925
                                  2048  2050  2063  2176  2178  2191  2408
                                  2441  2481

  XINT0     06BC  R01    1291      307   315

  XINT0NOC  072E  R01    1376     1360

  XSERINT   063B  R01    1209      328

  ZAP       0A36  R01    1863     1023

  ZAP0      0A3E  R01    1867     1885  1902  1916  1929  1935  1943  1946
                                  1951  1962  2060  2143  2146  2188  2202
                                  2272  2275  2300

  ZAP1      0A5D  R01    1881   

  ZAPASC    0D30  R01    2299     1959

  ZAPHEX    0B46  R01    2028     1955

  ZAPHEXH   0B60  R01    2041     2073  2085  2089  2101  2106  2269

  ZAPHEXH0  0CF7  R01    2268     2252

  ZAPHEXH1  0BDB  R01    2105     2150  2154  2158

  ZAPHEXHDIS
            0D33  R01    2302     2044  2057  2166

  ZAPHEXL   0C46  R01    2169     2114  2132  2201  2214  2218  2230  2235

  ZAPHEXL1  0CC4  R01    2234     2279  2283  2288

  ZAPHEXLDIS
            0D61  R01    2328     2172  2185  2295

  ZHD0      0D40  R01    2308     2333

  ZHD1      0D52  R01    2315     2314

  ZHD2      0D54  R01    2317     2323

  ZHD3      0D58  R01    2320     2316

  ZHD4      0D5B  R01    2322     2321

  ZHD5      0D5D  R01    2324     2319

  ZHDOWN    0BC8  R01    2092     2071  2260

  ZHH1      0BAA  R01    2073   

  ZHHEX0    0C2B  R01    2155     2152

  ZHLEFT    0BEB  R01    2117     2065

  ZHLEFT0   0BFA  R01    2126     2123

  ZHNOTA    0BA5  R01    2070     2068

  ZHNOTB    0BAA  R01    2072     2070

  ZHNOTBREAK
            0C18  R01    2144     2142

  ZHNOTC    0B9F  R01    2068     2066

  ZHNOTD    0B9A  R01    2066     2064

  ZHNOTDOWN 
            0BDD  R01    2107     2091

  ZHNOTENTER
            0C1E  R01    2147     2145

  ZHNOTESC  0BAD  R01    2074     2062

  ZHNOTESC0 
            0B78  R01    2051     2049

  ZHNOTESC1 
            0B8F  R01    2061     2059

  ZHNOTLEFT 
            0C12  R01    2141     2116

  ZHNOTRIGHT
            0BE8  R01    2115     2108

  ZHNOTUP   0BC5  R01    2090     2075

  ZHRIGHT   0BE0  R01    2109     2067  2167

  ZHUP      0BB0  R01    2076     2069

  ZLDOWN    0CB1  R01    2221     2199

  ZLH1      0C90  R01    2201   

  ZLHEX0    0D13  R01    2284     2281

  ZLHEX1    0D1C  R01    2289     2287

  ZLLEFT    0CF2  R01    2263     2193

  ZLNOTA    0C8B  R01    2198     2196

  ZLNOTB    0C90  R01    2200     2198

  ZLNOTBREAK
            0D00  R01    2273     2271

  ZLNOTC    0C85  R01    2196     2194

  ZLNOTD    0C80  R01    2194     2192

  ZLNOTDOWN 
            0CC6  R01    2236     2220

  ZLNOTENTER
            0D06  R01    2276     2274

  ZLNOTESC  0C96  R01    2203     2190

  ZLNOTESC0 
            0C5E  R01    2179     2177

  ZLNOTESC1 
            0C75  R01    2189     2187

  ZLNOTLEFT 
            0CFA  R01    2270     2262

  ZLNOTRIGHT
            0CEF  R01    2261     2237

  ZLNOTUP   0CAE  R01    2219     2204

  ZLRIGHT   0CC9  R01    2238     2195  2296

  ZLRIGHT0  0CD6  R01    2245     2243

  ZLUP      0C99  R01    2205     2140  2197

  ZMODE     0A63  R01    1884     1889  1893

  ZREAD     0D6F  R01    2335     1989  1992  2003  2162  2291  2306  2313
                                  2332

  ZRNOTD    0D7C  R01    2343     2339

  ZRNOTX    0D75  R01    2339     2335

  ZWNOTD    0D89  R01    2352     2348

  ZWNOTX    0D82  R01    2348     2346

  ZWRITE    0D7E  R01    2346     2165  2294

  aa        00DA  A#      108   

  abs16     1901  R01    3764      375

  acc_a     0008  R02    3083     3195  3199  3218  3230  3240  3252  3273
                                  3282  3304  3313  3317  3318  3322  3323
                                  3327  3328  3330  3331  3332  3334  3831
                                  3887  3896  3897  3898  3899  3900  3948
                                  3951  3952  3955  3956  3959  3960  3963
                                  3964  3967

  acc_b     0003  R02    3078     3901  3902  3903  3904  3905  3926  3927
                                  3929  3930  3931  3933  3934  3935  3937
                                  3938  3939  3941  3942  3943  3945  3949
                                  3953  3957  3961  3965

  adccomvec 
            0053  R00     253      343

  adch      00C6  A#      131   

  adcint    0053  R01     343   

  adcon     00C5  A#      132   

  add16     1826  R01    3595      371

  add16s    1624  R01    3150      386

  bindec    1983  R01    3913      383  3827  3828  3829  3830  3885  3886

  blank     1758  R01    3414      400  4001  4005  4007  4010  4012  4015
                                  4022  4025  4028  4031  4034  4037  4040
                                  4043

  byte      175C  R01    3423      401  3813  3815  3848  3851  3854  3857
                                  3870  3873  3982  4000  4004  4009  4014
                                  4018  4020  4024  4027  4030  4033  4036
                                  4039  4042  4045

  cap0int   0033  R01     331   

  cap1int   003B  R01     334   

  cap2int   0043  R01     337   

  cap3int   004B  R01     340   

  chksig    00FE  R00     290      713

  clr16     162F  R01    3168      387  3196  3274  3305

  cmh0      00C9  A#      120   

  cmh1      00CA  A#      119      204

  cmh2      00CB  A#      118      203

  cmi0      00CC  A#      126   

  cmi1      00CD  A#      127   

  cmi2      00CE  A#      128   

  cml0      00A9  A#      154   

  cml1      00AA  A#      153   

  cml2      00AB  A#      152   

  cmsr0     00C0  A#      139   

  cmsr1     00C1  A#      140   

  cmsr2     00C2  A#      141   

  cmsr3     00C3  A#      142   

  cmsr4     00C4  A#      143   

  cmsr5     00C5  A#      144   

  cmt0      00C6  A#      145   

  cmt1      00C7  A#      146   

  com0int   005B  R01     346   

  com1int   0063  R01     349   

  com2int   006B  R01     352   

  cr0       00D8  A#      106   

  cr1       00D9  A#      107   

  crlf      1772  R01    3440      402  4046

  ct0i      0090  A#      158   

  ct1i      0091  A#      159   

  ct2i      0092  A#      160   

  ct3i      0093  A#      161   

  ctcon     00EB  A#       74   

  cth0      00CC  A#      117      202

  cth1      00CD  A#      116      201

  cth2      00CE  A#      115   

  cth3      00CF  A#      114   

  cti0      00C8  A#      122   

  cti1      00C9  A#      123   

  cti2      00CA  A#      124   

  cti3      00CB  A#      125   

  ctl0      00AC  A#      151   

  ctl1      00AD  A#      150   

  ctl2      00AE  A#      149   

  ctl3      00AF  A#      148   

  dCNV1     1988  R01    3917     3923

  dCNV2     1990  R01    3922     3920

  dDSPlp    19DF  R01    3980     3983

  dbg0      069C  R01    1269     1235  1255

  dbg1      06B1  R01    1284     1234  1249  1257  1268

  dbgbrk    068B  R01    1259      408

  dbgcont   0654  R01    1225      410

  dbgs0     0678  R01    1247     1245

  dbgs1     0687  R01    1256     1246

  dbgsnap   0667  R01    1237      409

  div16     1890  R01    3685      374

  div16b    18A0  R01    3696   

  divcnt    000D  R02    3085     3697  3701

  divi      0005  R02    3080     3692  3694  3709  3711  3717  3720

  dsp16d    195A  R01    3883      380

  dsp16h    194F  R01    3867      381

  dsp32d    1921  R01    3825      378

  dsp32h    1938  R01    3843      379

  dspx      19DE  R01    3979      384  3833  3889

  ead       00AE  A#       84   

  echo      168A  R01    3260      392  3347  3369

  ecm0      00EC  A#       93   

  ecm1      00ED  A#       94   

  ecm2      00EE  A#       95   

  ect0      00E8  A#       89   

  ect1      00E9  A#       90   

  ect2      00EA  A#       91   

  ect3      00EB  A#       92   

  ens1      00DE  A#      112   

  es0       00AC  A#       86   

  es1       00AD  A#       85   

  et2       00EF  A#       96   

  finh      1671  R01    3230     3220  3227

  finhe     1687  R01    3252     3242  3249

  gc        00DB  A#       99   

  get10i    16C1  R01    3304      394

  get10il   16D2  R01    3311     3335

  get16     163F  R01    3195      389

  get16i    1695  R01    3273      393

  get16il   16A6  R01    3280     3293

  get16l    1644  R01    3197     3209

  get1d     1700  R01    3344      395

  get1de    1705  R01    3346      396  3311

  get1h     171A  R01    3366      397  3197  3219  3226

  get1he    171F  R01    3368      398  3241  3248  3280

  get2h     165E  R01    3218      390

  get2he    1674  R01    3240      391

  getchr    17A9  R01    3493      406  3452

  getupc    177D  R01    3452      403  3344  3346  3366  3368

  hcor1     1740  R01    3386     3372

  hcor2     1744  R01    3388     3379

  hcor3     1748  R01    3390     3381

  hex16     1916  R01    3811      377

  ien0      00A8  A#       80       84    85    86   423   429   435   441
                                   447   456   486

  ien1      00E8  A#       88       89    90    91    92    93    94    95
                                    96   462   468   474   480   492   498
                                   504   513

  inhexacc0 
            0F47  R01    2405     2430

  inhexacc00
            0F53  R01    2412     2409

  inhexacc1 
            0F69  R01    2424     2418

  inhexacc2 
            0F71  R01    2431     2416  2420  2422

  inhexacc_end
            0F72  R01    2433     2411

  iniacc    196B  R01    3895      382  3826  3884

  int0vec   0003  R00     232      303

  int1vec   0013  R00     236      311

  intadc    01C0  R01     486      253   765

  intc0     0178  R01     462      245   753

  intc1     018A  R01     468      247   756

  intc2     019C  R01     474      249   759

  intc3     01AE  R01     480      251   762

  intcm0    01D2  R01     492      255   768

  intcm1    01E4  R01     498      257   771

  intcm2    01F6  R01     504      259   774

  inte0     010C  R01     423      232   730

  inte1     011E  R01     429      236   736

  intf0     0130  R01     435      234   733

  intf1     0142  R01     441      238   739

  intf2     0208  R01     513      262   777

  intrt     0154  R01     447      240   742

  intrt1    0166  R01     456      243   750

  ip0       00B8  A#       47       52    53    54

  ip1       00F8  A#       56       57    58    59    60    61    62    63
                                    64

  isthere   1A70  R01    4061     4058

  link      15FD  R01    3112      385   728   731   734   737   740   743
                                   751   754   757   760   763   766   769
                                   772   775   778

  lnk       030F  R01     726      712   715   718

  ltime     1802  R01    3565      369  3576

  mul16     1841  R01    3633      373

  mul16b    184B  R01    3641   

  n1        00C4  A      3579     3580

  neg16     190B  R01    3793      376  3769

  nodec     1718  R01    3356     3350  3352

  nohex     173E  R01    3384     3387  3389  3391

  nohex1    1732  R01    3378     3374

  noneg1    1909  R01    3770     3767

  oct       160C  R01    3124   

  oct1      161A  R01    3131     3117

  op1       0003  R02    3076     3079  3598  3603  3604  3617  3622  3623
                                  3634  3638  3641  3646  3651  3662

  op2       0005  R02    3079     3080  3635  3639  3642  3647  3652  3663

  p4        00C0  A#      138      139   140   141   142   143   144   145
                                   146

  p5        00C4  A#      135   

  pad       00BE  A#       54   

  pcm0      00FC  A#       61   

  pcm1      00FD  A#       62   

  pcm2      00FE  A#       63   

  pcon      0087  A#      167   

  pct0      00F8  A#       57   

  pct1      00F9  A#       58   

  pct2      00FA  A#       59   

  pct3      00FB  A#       60   

  prod      0008  R02    3082     3644  3645  3649  3650  3654  3655  3656
                                  3658  3659  3661  3665  3666  3667  3669
                                  3670  3672  3674  3685  3687  3689  3691
                                  3696  3703  3708  3710  3712  3716  3718
                                  3719  3721  3722  3724  3738  3740  3741
                                  3743  3744  3746  3747  3749  3750  3752

  ps0       00BC  A#       52   

  ps1       00BD  A#       53   

  pt2       00FF  A#       64   

  pwm0      00FC  A#       45   

  pwm1      00FD  A#       44   

  pwmp      00FE  A#       43   

  quot      0003  R02    3077     3702  3728  3730  3731  3733

  ramcodastart
            0000  R00     230      289   291

  recvhex   0F74  R01    2440     1627  2446  2487

  recvhex0  0F7D  R01    2445     2442

  recvhex2  0FA9  R01    2469     2475

  recvhex3  0FB3  R01    2476     2468

  recvhex4  0FB9  R01    2480     2483

  recvhex5  0FCE  R01    2490     2479

  recvhex_end
            0FD5  R01    2495     2444  2449  2453  2458  2463  2489

  ret_link  1623  R01    3139   

  rstvec    0000  R00     231      722  3114

  rt2       0095  A#      163   

  rte       00EF  A#       66   

  s0buf     0099  A#      156   

  s1adr     00DB  A#       98       99

  s1con     00D8  A#      105      106   107   108   109   110   111   112

  s1dat     00DA  A#      101   

  s1sta     00D9  A#      102   

  scl       0096  A#      164   

  sda       0097  A#      165   

  serintvec 
            0023  R00     240      320

  shl16     1636  R01    3180      388  3202  3203  3204  3205  3286  3287
                                  3288  3289

  si        00DB  A#      109   

  sio1vec   002B  R00     243      327

  skip      170B  R01    3348     3345

  snap      19E7  R01    3993      370

  snd       1796  R01    3477      405  3261  3263  3276  3278  3307  3309
                                  3404  3415  3431  3433  3441  3443

  sta       00DD  A#      111   

  ste       00EE  A#       69   

  stime     17EA  R01    3544      368  3556

  stk       0012  R02    3092      700   857

  sto       00DC  A#      110   

  stxt      174C  R01    3400      399   425   427   431   433   437   439
                                   443   445   449   451   458   460   464
                                   466   470   472   476   478   482   484
                                   488   490   494   496   500   502   506
                                   508   515   517   721  3406  3997

  sub16     1833  R01    3613      372

  t2        0094  A#      162   

  t2cap0vec 
            0033  R00     245      331

  t2cap1vec 
            003B  R00     247      334

  t2cap2vec 
            0043  R00     249      337

  t2cap3vec 
            004B  R00     251      340

  t2com0vec 
            005B  R00     255      346

  t2com1vec 
            0063  R00     257      349

  t2com2vec 
            006B  R00     259      352

  t2ov      00CF  A#      129   

  t3        00FF  A#       42   

  testc     1A6A  R01    4058      407

  tm2con    00EA  A#       77   

  tm2ir     00C8  A#      121      122   123   124   125   126   127   128
                                   129   205

  tmh2      00ED  A#       72   

  tml2      00EC  A#       73   

  tmr0vec   000B  R00     234      306

  tmr1vec   001B  R00     238      314

  tmr2vec   0073  R00     262      354

  txterror  00AF  R03    4088   

  upcase    1784  R01    3461      404  3453

  usercode  0100  R00     292      231   727   825   853

  veci00    000E  R01     307      302

  veci10    001E  R01     315      310

  veci2cint 
            002B  R01     326   

  vecint0   0003  R01     302   

  vecint1   0013  R01     310   

  vecint2   002B  R01     325   

  vecs00    002E  R01     328      319

  vecserint 
            0023  R01     318   

  vectmr0   000B  R01     306   

  vectmr1   001B  R01     314   

  vectmr2   0073  R01     354   


                        Macro Definitions
                        =================

