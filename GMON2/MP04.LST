################################################################################
#                                                                              #
#    Micro Series 8051 Assembler V2.02/DOS              20/Dec/19  17:34:33    #
#                                                                              #
#       Source   =   mp04.s03                                                  #
#       List     =   mp04.lst                                                  #
#       Object   =   mp04.r03                                                  #
#       Options  =                                                             #
#                                                                              #
#                                               (c) Copyright IAR Systems 1990 #
################################################################################


    1                 ;___________________________________________________
    2                 ; Version       : 
    3                 ; Date          : 03 fevrier 1991
    4                 ; Auteur        : Jean Morren
    5                 ; Objet         : Exemple d'utilisation des utilitaires emon16
    6                 ;___________________________________________________
    7                 ;
    8                 
    9                 ;Options pour l'asembleur
   10  0000                   lstxrf
   11  0000                   locsym+
   12                 ;___________________________________________________________________________;
   13                 
   14                 $gmon2vec.inc
   15                 ;=====  Vectors definition for GMON2 =====
   16                 
   17                 ;----- User interrupt handlers and user code entry point
   18  2000           ramcodastart    equ     2000H 
   19  2000           rstvec  equ     2000H 
   20  2003           int0vec equ     2003H 
   21  200B           tmr0vec equ     200BH 
   22  2013           int1vec equ     2013H 
   23  201B           tmr1vec equ     201BH 
   24  2023           serintvec       equ     2023H 
   25  202B           sio1vec equ     202BH 
   26  2033           t2cap0vec       equ     2033H 
   27  203B           t2cap1vec       equ     203BH 
   28  2043           t2cap2vec       equ     2043H 
   29  204B           t2cap3vec       equ     204BH 
   30  2053           adccomvec       equ     2053H 
   31  205B           t2com0vec       equ     205BH 
   32  2063           t2com1vec       equ     2063H 
   33  206B           t2com2vec       equ     206BH 
   34  2073           tmr2vec equ     2073H 
   35  20FE           chksig  equ     20FEH 
   36  2100           usercode        equ     2100H 
   37                 
   38                 ;----- GMON2 Utilities vectors
   39  0076           stime   equ     0076h           ;write time to RTC OKI MSM6242
   40  0079           ltime   equ     0079h           ;read time from RTC OKI MSM6242
   41  007C           snap    equ     007Ch           ;snap registers
   42  007F           add16   equ     007Fh           ;op1(16b) = word@r0 + word@r1 ; r0 = #op1
   43  0082           sub16   equ     0082h           ;op1(16b) = word@r0 - word@r1 ; r0 = #op1
   44  0085           mul16   equ     0085h           ;prod(16b) = word@r0 * word@r1 ; r0 = #prod
   45  0088           div16   equ     0088h           ;word@r0 = dword@r0 / word@r1 ; word@r1 = dword@r0 mod word@r1 
   46  008B           abs16   equ     008Bh           ;word@r0 = abs( word@r0 )
   47  008E           neg16   equ     008Eh           ;word@r0 = -word@r0
   48  0091           hex16   equ     0091h           ;hex disp dptr
   49  0094           dsp32d  equ     0094h           ;dec disp dword@r0
   50  0097           dsp32h  equ     0097h           ;hex disp dword@r0
   51  009A           dsp16d  equ     009Ah           ;dec disp word@r0
   52  009D           dsp16h  equ     009Dh           ;hex disp word@r0
   53  00A0           iniacc  equ     00A0h           ;init buffer for bin to bcd conversion
   54  00A3           bindec  equ     00A3h           ;convert byte@r0 to bcd in buffer; ++r0
   55  00A6           dspx    equ     00A6h           ;disp bcd value in buffer
   56  00A9           link    equ     00A9h           ;link interrupt vector
   57  00AC           add16s  equ     00ACh           ;add word @r1 to word @r0
   58  00AF           clr16   equ     00AFh           ;clear word@r0
   59  00B2           shl16   equ     00B2h           ;left shift word@r0
   60  00B5           get16   equ     00B5h           ;hex read word@r0 without echo until non-hex char
   61  00B8           get2h   equ     00B8h           ;hex read byte@r0 without echo until non-hex char
   62  00BB           get2he  equ     00BBh           ;hex read byte@r0 with echo until non-hex char
   63  00BE           echo    equ     00BEh           ;echo byte, add <lf> to <cr>
   64  00C1           get16i  equ     00C1h           ;hex read word@r0 with prompt 'H>' and echo until non-hex char
   65  00C4           get10i  equ     00C4h           ;dec read word@r0 with prompt 'D>' and echo until non-hex char
   66  00C7           get1d   equ     00C7h           ;dec read 1 digit without echo
   67  00CA           get1de  equ     00CAh           ;dec read 1 digit with echo
   68  00CD           get1h   equ     00CDh           ;hex read 1 digit without echo
   69  00D0           get1he  equ     00D0h           ;hex read 1 digit with echo
   70  00D3           stxt    equ     00D3h           ;disp null terminated text @dptr
   71  00D6           blank   equ     00D6h           ;disp blank
   72  00D9           byte    equ     00D9h           ;hex disp byte in A
   73  00DC           crlf    equ     00DCh           ;disp CR/LF
   74  00DF           getupc  equ     00DFh           ;read char to A and convert to upper case
   75  00E2           upcase  equ     00E2h           ;convert char in A to upper case
   76  00E5           snd     equ     00E5h           ;disp char in A
   77  00E8           getchr  equ     00E8h           ;read char to A; Ctrl-D invokes debugger
   78  00EB           testc   equ     00EBh           ;test if char received (A = 0 if true)
   79  00EE           dbgbrk  equ     00EEh           ;break into debugger
   80  00F1           dbgsnap equ     00F1h           ;snapshot SFRs via debugger
   81  00F4           dbgcont equ     00F4h           ;continue from debugger
   82  00F7           DASM1   equ     00F7h           ;disasemble code from 18:19 to 1A:1B
   83  00FA           DDISA   equ     00FAh           ;disp char in A
   84  00FD           DDISNL  equ     00FDh           ;disp new line (A saved)
   85  0100           DHEXB   equ     0100h           ;hex disp byte in A
   86  0103           DHEXW   equ     0103h           ;hex disp word in R2:R3
   87  0106           WAITKI  equ     0106h           ;wait char from serial line; Ctrl-C aborts
   88  0109           DHITKI  equ     0109h           ;get char from serial line with XON/XOFF; Ctrl-C aborts
   89                 ;
   90  000D           cr      equ     0dh
   91  000A           lf      equ     0ah
   92                 ;
   93                 ; Variables 
   94  0000                   rseg    data
   95  0000           x       ds      4
   96  0004           y       ds      2
   97                 ;
   98  0000                   aseg
   99  20FE                   org     chksig  ;signature pour autorun: AA5A doit etre present
  100  20FE AA5A              DB      0AAH,5AH
  101                         
  102  2100                   org     usercode
  103  2100 E4        debut   clr     a
  104  2101 F502              mov     x+2,a   ;clear 16 bits msb
  105  2103 F503              mov     x+3,a
  106  2105 90215A            mov     dptr,#txt0
  107  2108 1200D3            lcall   stxt
  108  210B 1200C4            lcall   get10i  ;lire nb1       
  109  210E 8600              mov     x,@r0   ;sauver en x le nb1
  110  2110 08                inc     r0
  111  2111 8601              mov     x+1,@r0
  112  2113 9021B7            mov     dptr,#txt1
  113  2116 1200D3            lcall   stxt
  114  2119 1200C4            lcall   get10i  ;lire nb2
  115  211C 8604              mov     y,@r0   ;sauver en y le nb2
  116  211E 08                inc     r0
  117  211F 8605              mov     y+1,@r0
  118  2121 7800              mov     r0,#x
  119  2123 7904              mov     r1,#y
  120  2125 120088            lcall   div16   ;((r0))=quotient et ((r1))=reste
  121  2128 8704              mov     y,@r1   ;sauver le reste en y
  122  212A 09                inc     r1
  123  212B 8705              mov     y+1,@r1
  124  212D 8600              mov     x,@r0   ;sauver le quotient en x
  125  212F 08                inc     r0
  126  2130 8601              mov     x+1,@r0
  127  2132 9021E6            mov     dptr,#txt2
  128  2135 1200D3            lcall   stxt
  129  2138 7800              mov     r0,#x   ;pointer le quotient
  130  213A 12009A            lcall   dsp16d
  131  213D 1200DC            lcall   crlf
  132  2140 9021F5            mov     dptr,#txt3
  133  2143 1200D3            lcall   stxt
  134  2146 7804              mov     r0,#y   ;pointer le reste
  135  2148 12009A            lcall   dsp16d
  136  214B 1200DC            lcall   crlf
  137  214E 1200DC            lcall   crlf
  138  2151 1200DC            lcall   crlf
  139  2154 12007C            lcall   snap
  140                 ;       lcall   dbgbrk
  141  2157 022100    fin     ljmp    debut   ;recommencer
  142                 ;
  143                 ;
  144  215A 4578656D  txt0    db      'Exemple d''utilisation des utilitaires emon16',cr,lf
       215E 706C6520
       2162 64277574
       2166 696C6973
       216A 6174696F
       216E 6E206465
       2172 73207574
       2176 696C6974
       217A 61697265
       217E 7320656D
       2182 6F6E3136
       2186 0D0A
  145  2188 696E7472          db      'introduisez un premier nombre entre 0..64000',cr,lf,0
       218C 6F647569
       2190 73657A20
       2194 756E2070
       2198 72656D69
       219C 6572206E
       21A0 6F6D6272
       21A4 6520656E
       21A8 74726520
       21AC 302E2E36
       21B0 34303030
       21B4 0D0A00
  146  21B7 696E7472  txt1    db      'introduisez un second  nombre entre 0..64000',cr,lf,0
       21BB 6F647569
       21BF 73657A20
       21C3 756E2073
       21C7 65636F6E
       21CB 6420206E
       21CF 6F6D6272
       21D3 6520656E
       21D7 74726520
       21DB 302E2E36
       21DF 34303030
       21E3 0D0A00
  147  21E6 6C652071  txt2    db      'le quotient = ',0
       21EA 756F7469
       21EE 656E7420
       21F2 3D2000
  148  21F5 6C652072  txt3    db      'le reste    = ',0
       21F9 65737465
       21FD 20202020
       2201 3D2000
  149                 
  150  2204                   end     debut

    Errors:  None           ########
    Bytes:   262            # mp04 #
    CRC:     6D74           ########

                  Symbol and Cross Reference Table
                  ================================

  Symbol    Value Type  Defline   Refline

                        Segment Definitions
                        ===================

  data      0006  S00R     94   


                        External Symbols
                        ================


                        Public Symbols
                        ==============


                        Local Symbols
                        =============

  DASM1     00F7  A        82   

  DDISA     00FA  A        83   

  DDISNL    00FD  A        84   

  DHEXB     0100  A        85   

  DHEXW     0103  A        86   

  DHITKI    0109  A        88   

  WAITKI    0106  A        87   

  abs16     008B  A        46   

  adccomvec 
            2053  A        30   

  add16     007F  A        42   

  add16s    00AC  A        57   

  bindec    00A3  A        54   

  blank     00D6  A        71   

  byte      00D9  A        72   

  chksig    20FE  A        35       99

  clr16     00AF  A        58   

  cr        000D  A        90      144   145   146

  crlf      00DC  A        73      131   136   137   138

  dbgbrk    00EE  A        79   

  dbgcont   00F4  A        81   

  dbgsnap   00F1  A        80   

  debut     2100  A       103      141   150

  div16     0088  A        45      120

  dsp16d    009A  A        51      130   135

  dsp16h    009D  A        52   

  dsp32d    0094  A        49   

  dsp32h    0097  A        50   

  dspx      00A6  A        55   

  echo      00BE  A        63   

  fin       2157  A       141   

  get10i    00C4  A        65      108   114

  get16     00B5  A        60   

  get16i    00C1  A        64   

  get1d     00C7  A        66   

  get1de    00CA  A        67   

  get1h     00CD  A        68   

  get1he    00D0  A        69   

  get2h     00B8  A        61   

  get2he    00BB  A        62   

  getchr    00E8  A        77   

  getupc    00DF  A        74   

  hex16     0091  A        48   

  iniacc    00A0  A        53   

  int0vec   2003  A        20   

  int1vec   2013  A        22   

  lf        000A  A        91      144   145   146

  link      00A9  A        56   

  ltime     0079  A        40   

  mul16     0085  A        44   

  neg16     008E  A        47   

  ramcodastart
            2000  A        18   

  rstvec    2000  A        19   

  serintvec 
            2023  A        24   

  shl16     00B2  A        59   

  sio1vec   202B  A        25   

  snap      007C  A        41      139

  snd       00E5  A        76   

  stime     0076  A        39   

  stxt      00D3  A        70      107   113   128   133

  sub16     0082  A        43   

  t2cap0vec 
            2033  A        26   

  t2cap1vec 
            203B  A        27   

  t2cap2vec 
            2043  A        28   

  t2cap3vec 
            204B  A        29   

  t2com0vec 
            205B  A        31   

  t2com1vec 
            2063  A        32   

  t2com2vec 
            206B  A        33   

  testc     00EB  A        78   

  tmr0vec   200B  A        21   

  tmr1vec   201B  A        23   

  tmr2vec   2073  A        34   

  txt0      215A  A       144      106

  txt1      21B7  A       146      112

  txt2      21E6  A       147      127

  txt3      21F5  A       148      132

  upcase    00E2  A        75   

  usercode  2100  A        36      102

  x         0000  R00      95      104   105   109   111   118   124   126
                                   129

  y         0004  R00      96      115   117   119   121   123   134


                        Macro Definitions
                        =================

